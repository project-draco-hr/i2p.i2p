{
  boolean inI2P=ConfigurationManager.getInstance().getBooleanConfiguration("startWithI2P",false);
  PopupMenu popup=new PopupMenu();
  MenuItem browserLauncher=new MenuItem("Launch I2P Browser");
  browserLauncher.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent arg0){
      new SwingWorker<Object,Object>(){
        @Override protected Object doInBackground() throws Exception {
          return null;
        }
        @Override protected void done(){
          if (Desktop.isDesktopSupported()) {
            Desktop desktop=Desktop.getDesktop();
            if (desktop.isSupported(Action.BROWSE)) {
              try {
                desktop.browse(new URI("http://localhost:7657"));
              }
 catch (              IOException e) {
                e.printStackTrace();
              }
catch (              URISyntaxException e) {
                e.printStackTrace();
              }
            }
 else {
              trayIcon.displayMessage("Browser not found","The default browser for your system was not found.",TrayIcon.MessageType.WARNING);
            }
          }
        }
      }
.execute();
    }
  }
);
  popup.add(browserLauncher);
  popup.addSeparator();
  MenuItem startItem=new MenuItem("Start I2P");
  startItem.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent arg0){
      new SwingWorker<Object,Object>(){
        @Override protected Object doInBackground() throws Exception {
          RouterManager.start();
          return null;
        }
        @Override protected void done(){
          trayIcon.displayMessage("Starting","I2P is starting!",TrayIcon.MessageType.INFO);
          tray.remove(trayIcon);
        }
      }
.execute();
    }
  }
);
  if (!inI2P) {
    popup.add(startItem);
  }
  MenuItem restartItem=new MenuItem("Restart I2P");
  restartItem.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent arg0){
      new SwingWorker<Object,Object>(){
        @Override protected Object doInBackground() throws Exception {
          RouterManager.restart();
          return null;
        }
      }
.execute();
    }
  }
);
  if (inI2P) {
    popup.add(restartItem);
  }
  MenuItem stopItem=new MenuItem("Stop I2P");
  stopItem.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent arg0){
      new SwingWorker<Object,Object>(){
        @Override protected Object doInBackground() throws Exception {
          RouterManager.shutDown();
          return null;
        }
      }
.execute();
    }
  }
);
  if (inI2P) {
    popup.add(stopItem);
  }
  return popup;
}
