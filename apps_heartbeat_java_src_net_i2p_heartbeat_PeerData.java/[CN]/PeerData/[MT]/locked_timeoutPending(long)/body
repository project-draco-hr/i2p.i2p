{
  Set toDrop=new HashSet(4);
  for (Iterator iter=_pendingPings.keySet().iterator(); iter.hasNext(); ) {
    Long pingTime=(Long)iter.next();
    if (pingTime.longValue() < when) {
      toDrop.add(pingTime);
      EventDataPoint point=(EventDataPoint)_pendingPings.get(pingTime);
      point.setWasPonged(false);
      locked_addDataPoint(point);
    }
  }
  for (Iterator iter=toDrop.iterator(); iter.hasNext(); ) {
    _pendingPings.remove(iter.next());
  }
  return toDrop.size();
}
