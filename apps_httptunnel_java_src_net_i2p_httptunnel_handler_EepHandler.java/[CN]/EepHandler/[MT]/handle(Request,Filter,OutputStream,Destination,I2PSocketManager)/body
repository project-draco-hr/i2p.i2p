{
  I2PSocket s=null;
  boolean written=false;
  try {
synchronized (sm) {
      s=sm.connect(dest,new I2PSocketOptions());
    }
    InputStream in=new BufferedInputStream(s.getInputStream());
    OutputStream sout=new BufferedOutputStream(s.getOutputStream());
    sout.write(req.toByteArray());
    sout.flush();
    byte[] buffer=new byte[16384], filtered;
    int len;
    while ((len=in.read(buffer)) != -1) {
      if (len != buffer.length) {
        byte[] b2=new byte[len];
        System.arraycopy(buffer,0,b2,0,len);
        filtered=f.filter(b2);
      }
 else {
        filtered=f.filter(buffer);
      }
      written=true;
      out.write(filtered);
    }
    filtered=f.finish();
    written=true;
    out.write(filtered);
    out.flush();
  }
 catch (  SocketException ex) {
    _log.error("Error while handling eepsite request");
    return written;
  }
catch (  IOException ex) {
    _log.error("Error while handling eepsite request");
    return written;
  }
catch (  I2PException ex) {
    _log.error("Error while handling eepsite request");
    return written;
  }
 finally {
    if (s != null)     s.close();
  }
  return true;
}
