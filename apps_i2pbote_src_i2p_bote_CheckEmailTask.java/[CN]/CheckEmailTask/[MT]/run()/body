{
  Collection<Hash> emailPacketKeys=findEmailPacketKeys();
  executor=Executors.newFixedThreadPool(MAX_THREADS,EMAIL_PACKET_TASK_THREAD_FACTORY);
  for (  Hash dhtKey : emailPacketKeys)   executor.submit(new EmailPacketTask(dhtKey));
  executor.shutdown();
  try {
    executor.awaitTermination(1,TimeUnit.DAYS);
  }
 catch (  InterruptedException e) {
    log.error("Interrupted while checking for mail.",e);
    executor.shutdownNow();
  }
}
