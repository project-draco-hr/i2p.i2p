{
  I2PPacketDispatcher dispatcher=new I2PPacketDispatcher();
  i2pSession.addSessionListener(dispatcher,I2PSession.PROTO_ANY,I2PSession.PORT_ANY);
  smtpService=new SMTPService();
  pop3Service=new POP3Service();
  outboxProcessor=new OutboxProcessor(i2pSession,outbox,configuration,peerManager);
  relayPacketSender=new RelayPacketSender(sendQueue,relayPacketFolder);
  sendQueue=new I2PSendQueue(i2pSession,dispatcher);
  dht=new KademliaDHT(i2pSession.getMyDestination(),sendQueue,dispatcher,configuration.getPeerFile());
  dht.setStorageHandler(EmailPacket.class,emailDhtStorageFolder);
  dht.setStorageHandler(IndexPacket.class,indexPacketDhtStorageFolder);
  peerManager=new PeerManager();
}
