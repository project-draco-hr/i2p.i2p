{
  ScheduledPacket scheduledPacket=new ScheduledPacket(packet,destination,0);
  long scheduleTime=System.currentTimeMillis();
  packetQueue.add(scheduledPacket);
  scheduledPacket.awaitSending();
  outstandingRequests.put(packet.getPacketId(),scheduledPacket);
  scheduledPacket.awaitResponse(timeoutMilliSeconds,TimeUnit.MILLISECONDS);
  if (log.shouldLog(Log.DEBUG)) {
    long responseTime=scheduledPacket.getResponseTime();
    String responseInfo=responseTime < 0 ? "timed out" : "took " + (responseTime - scheduledPacket.getSentTime()) + "ms.";
    log.debug("Packet with id " + packet.getPacketId() + " was queued for "+ (scheduledPacket.getSentTime() - scheduleTime)+ " ms, response "+ responseInfo);
  }
  return scheduledPacket.getResponse();
}
