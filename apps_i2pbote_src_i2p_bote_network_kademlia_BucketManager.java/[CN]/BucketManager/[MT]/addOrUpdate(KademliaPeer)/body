{
  Hash peerHash=peer.getDestinationHash();
  log.debug("Adding/updating peer: Hash = " + peerHash);
  peer.resetStaleCounter();
synchronized (this) {
    if (!siblingBucket.isFull() || siblingBucket.contains(peer)) {
      siblingBucket.addOrUpdate(peer);
      getBucket(peerHash).remove(peer);
    }
 else     if (isCloserSibling(peer)) {
      KademliaPeer ejectedPeer=siblingBucket.getMostDistantPeer(localDestinationHash);
      addToBucket(ejectedPeer);
      siblingBucket.remove(ejectedPeer);
      siblingBucket.addOrUpdate(peer);
      getBucket(peerHash).remove(peer);
    }
 else     addToBucket(peer);
  }
  logBucketStats();
}
