{
  if (packet instanceof FindClosePeersPacket)   sendPeerList((FindClosePeersPacket)packet,sender);
 else   if (packet instanceof StoreRequest) {
    DhtStorablePacket packetToStore=((StoreRequest)packet).getPacketToStore();
    if (packetToStore != null) {
      DhtStorageHandler storageHandler=storageHandlers.get(packetToStore.getClass());
      if (storageHandler != null)       storageHandler.store(packetToStore);
 else       log.warn("No storage handler found for type " + packetToStore.getClass().getSimpleName() + ".");
    }
  }
 else   if (packet instanceof RetrieveRequest) {
    RetrieveRequest retrieveRequest=(RetrieveRequest)packet;
    DhtStorageHandler storageHandler=storageHandlers.get(retrieveRequest.getDataType());
    if (storageHandler != null) {
      DhtStorablePacket storedPacket=storageHandler.retrieve(retrieveRequest.getKey());
      if (storedPacket != null) {
        log.debug("Packet found for retrieve request: [" + retrieveRequest + "], replying to sender: ["+ sender+ "]");
        ResponsePacket response=new ResponsePacket(storedPacket,StatusCode.OK,retrieveRequest.getPacketId());
        sendQueue.send(response,sender);
      }
 else       log.debug("No matching packet found for retrieve request: [" + retrieveRequest + "]");
    }
 else     log.warn("No storage handler found for type " + packet.getClass().getSimpleName() + ".");
  }
  bucketManager.packetReceived(packet,sender,receiveTime);
}
