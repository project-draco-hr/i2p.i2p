{
  ByteArrayOutputStream byteStream=new ByteArrayOutputStream();
  DataOutputStream dataStream=new DataOutputStream(byteStream);
  try {
    writeHeader(dataStream);
    dataStream.write(statusCode.ordinal());
    byte[] payloadBytes=payload.toByteArray();
    dataStream.writeShort(payloadBytes.length);
    dataStream.write(payloadBytes);
  }
 catch (  IOException e) {
    log.error("Can't write to ByteArrayOutputStream.",e);
  }
  return byteStream.toByteArray();
}
