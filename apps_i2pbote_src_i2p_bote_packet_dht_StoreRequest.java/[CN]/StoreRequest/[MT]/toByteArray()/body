{
  ByteArrayOutputStream byteArrayStream=new ByteArrayOutputStream();
  DataOutputStream dataStream=new DataOutputStream(byteArrayStream);
  try {
    writeHeader(dataStream);
    String hashCashString=hashCash.toString();
    dataStream.writeShort(hashCashString.length());
    dataStream.write(hashCashString.getBytes());
    byte[] dataToStore=packetToStore.toByteArray();
    dataStream.writeShort(dataToStore.length);
    dataStream.write(dataToStore);
  }
 catch (  IOException e) {
    log.error("Can't write to ByteArrayOutputStream.",e);
  }
  return byteArrayStream.toByteArray();
}
