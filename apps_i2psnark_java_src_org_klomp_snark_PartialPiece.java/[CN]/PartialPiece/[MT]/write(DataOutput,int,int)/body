{
  if (bs != null) {
    out.write(bs,offset,len);
  }
 else {
    int read=0;
    byte[] buf=new byte[Math.min(len,16384)];
synchronized (this) {
      if (raf == null)       throw new IOException();
      raf.seek(offset);
      while (read < len) {
        int rd=Math.min(buf.length,len - read);
        raf.readFully(buf,0,rd);
        read+=rd;
        out.write(buf,0,rd);
      }
    }
  }
}
