{
  if (halted) {
    peer.disconnect(false);
    return false;
  }
  boolean need_more;
synchronized (peers) {
    need_more=!peer.isConnected() && peers.size() < MAX_CONNECTIONS;
  }
  if (need_more) {
    _log.debug("Adding a peer " + peer.getPeerID().getAddress().calculateHash().toBase64() + " for "+ metainfo.getName(),new Exception("add/run"));
    final PeerListener listener=this;
    final BitField bitfield=storage.getBitField();
    Runnable r=new Runnable(){
      public void run(){
        peer.runConnection(listener,bitfield);
      }
    }
;
    String threadName=peer.toString();
    new I2PThread(r,threadName).start();
    return true;
  }
 else   if (_log.shouldLog(Log.DEBUG)) {
    if (peer.isConnected())     _log.info("Add peer already connected: " + peer);
 else     _log.info("MAX_CONNECTIONS = " + MAX_CONNECTIONS + " not accepting extra peer: "+ peer);
  }
  return false;
}
