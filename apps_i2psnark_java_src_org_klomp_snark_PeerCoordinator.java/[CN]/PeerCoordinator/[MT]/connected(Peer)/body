{
  if (halted) {
    peer.disconnect(false);
    return;
  }
  Peer toDisconnect=null;
synchronized (peers) {
    Peer old=peerIDInList(peer.getPeerID(),peers);
    if ((old != null) && (old.getInactiveTime() > 2 * 60 * 1000)) {
      peers.remove(old);
      toDisconnect=old;
      old=null;
    }
    if (old != null) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Already connected to: " + peer + ": "+ old+ ", inactive for "+ old.getInactiveTime());
      peer.disconnect(false);
    }
 else {
      if (_log.shouldLog(Log.INFO))       _log.info("New connection to peer: " + peer + " for "+ metainfo.getName());
      peers.add(0,peer);
      peerCount=peers.size();
      unchokePeer();
      if (listener != null)       listener.peerChange(this,peer);
    }
  }
  if (toDisconnect != null) {
    toDisconnect.disconnect(false);
    removePeerFromPieces(toDisconnect);
  }
}
