{
  if (halted)   return;
  if (_log.shouldLog(Log.INFO))   _log.info("Partials received from " + peer + ": "+ partials);
synchronized (wantedPieces) {
    for (    PartialPiece pp : partials) {
      if (pp.getDownloaded() > 0) {
        int idx=partialPieces.indexOf(pp);
        if (idx < 0) {
          partialPieces.add(pp);
          if (_log.shouldLog(Log.INFO))           _log.info("Saving orphaned partial piece (new) " + pp);
        }
 else         if (idx >= 0 && pp.getDownloaded() > partialPieces.get(idx).getDownloaded()) {
          partialPieces.set(idx,pp);
          if (_log.shouldLog(Log.INFO))           _log.info("Saving orphaned partial piece (bigger) " + pp);
        }
 else {
          if (_log.shouldLog(Log.INFO))           _log.info("Discarding partial piece (not bigger)" + pp);
        }
        int max=getMaxConnections();
        if (partialPieces.size() > max) {
          Collections.sort(partialPieces);
          PartialPiece gone=partialPieces.remove(max);
          if (_log.shouldLog(Log.INFO))           _log.info("Discarding orphaned partial piece (list full)" + gone);
        }
      }
      markUnrequested(peer,pp.getPiece());
    }
    if (_log.shouldLog(Log.INFO))     _log.info("Partial list size now: " + partialPieces.size());
  }
}
