{
  if (metainfo == null || storage == null)   return;
synchronized (wantedPieces) {
    wantedPieces.clear();
    BitField bitfield=storage.getBitField();
    int[] pri=storage.getPiecePriorities();
    for (int i=0; i < metainfo.getPieces(); i++) {
      if ((!bitfield.get(i)) && (pri == null || pri[i] >= 0)) {
        Piece p=new Piece(i);
        if (pri != null)         p.setPriority(pri[i]);
        wantedPieces.add(p);
      }
    }
    Collections.shuffle(wantedPieces,_random);
  }
}
