{
  if (complete() || metainfo.getFiles() == null || priorities == null)   return null;
  int[] rv=new int[metainfo.getPieces()];
  int file=0;
  long pcEnd=-1;
  long fileEnd=lengths[0] - 1;
  int psz=piece_size;
  for (int i=0; i < rv.length; i++) {
    pcEnd+=psz;
    int pri=priorities[file];
    while (fileEnd <= pcEnd && file < lengths.length - 1) {
      file++;
      long oldFileEnd=fileEnd;
      fileEnd+=lengths[file];
      if (priorities[file] > pri && oldFileEnd < pcEnd)       pri=priorities[file];
    }
    rv[i]=pri;
  }
  return rv;
}
