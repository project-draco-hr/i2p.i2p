{
  if (args.length < 1 || args.length > 2) {
    System.err.println("Usage: Storage file-or-dir [announceURL]");
    System.exit(1);
  }
  File base=new File(args[0]);
  String announce=args.length == 2 ? args[1] : null;
  I2PAppContext ctx=I2PAppContext.getGlobalContext();
  I2PSnarkUtil util=new I2PSnarkUtil(ctx);
  File file=null;
  FileOutputStream out=null;
  try {
    Storage storage=new Storage(util,base,announce,null,false,null);
    MetaInfo meta=storage.getMetaInfo();
    file=new File(storage.getBaseName() + ".torrent");
    out=new FileOutputStream(file);
    out.write(meta.getTorrentData());
    String hex=DataHelper.toString(meta.getInfoHash());
    System.out.println("Created:     " + file);
    System.out.println("InfoHash:    " + hex);
    String basename=base.getName().replace(" ","%20");
    String magnet=MagnetURI.MAGNET_FULL + hex + "&dn="+ basename;
    if (announce != null)     magnet+="&tr=" + announce;
    System.out.println("Magnet:      " + magnet);
  }
 catch (  IOException ioe) {
    if (file != null)     file.delete();
    ioe.printStackTrace();
    System.exit(1);
  }
 finally {
    try {
      if (out != null)       out.close();
    }
 catch (    IOException ioe) {
    }
  }
}
