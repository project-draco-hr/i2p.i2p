{
  String announce=meta.getAnnounce();
  String infoHash=urlencode(meta.getInfoHash());
  String peerID=urlencode(coordinator.getID());
  _log.debug("Announce: [" + meta.getAnnounce() + "] infoHash: "+ infoHash+ " xmitAnnounce: ["+ announce+ "]");
  long uploaded=coordinator.getUploaded();
  long downloaded=coordinator.getDownloaded();
  long left=coordinator.getLeft();
  boolean completed=(left == 0);
  int sleptTime=0;
  try {
    if (!verifyConnected())     return;
    boolean started=false;
    while (!started) {
      sleptTime=0;
      try {
        TrackerInfo info=doRequest(announce,infoHash,peerID,uploaded,downloaded,left,STARTED_EVENT);
        Set peers=info.getPeers();
        coordinator.trackerSeenPeers=peers.size();
        coordinator.trackerProblems=null;
        if (!completed) {
          Iterator it=peers.iterator();
          while (it.hasNext()) {
            Peer cur=(Peer)it.next();
            coordinator.addPeer(cur);
            int delay=DELAY_MUL;
            delay*=((int)cur.getPeerID().getAddress().calculateHash().toBase64().charAt(0)) % 10;
            delay+=DELAY_MIN;
            sleptTime+=delay;
            try {
              Thread.sleep(delay);
            }
 catch (            InterruptedException ie) {
            }
          }
        }
        started=true;
      }
 catch (      IOException ioe) {
        Snark.debug("WARNING: Could not contact tracker at '" + announce + "': "+ ioe,Snark.WARNING);
        coordinator.trackerProblems=ioe.getMessage();
        if (coordinator.trackerProblems.toLowerCase().startsWith(NOT_REGISTERED)) {
          stop=true;
          coordinator.snark.stopTorrent();
        }
      }
      if (stop)       break;
      if (!started) {
        Snark.debug("         Retrying in one minute...",Snark.DEBUG);
        try {
          Thread.sleep(60 * 1000);
        }
 catch (        InterruptedException interrupt) {
        }
      }
    }
    Random r=new Random();
    while (!stop) {
      try {
        int delay;
        if (coordinator.trackerProblems != null && !completed) {
          delay=60 * 1000;
        }
 else         if (completed) {
          delay=3 * SLEEP * 60* 1000 + r.nextInt(120 * 1000);
        }
 else {
          delay=SLEEP * 60 * 1000 + r.nextInt(120 * 1000);
          delay-=sleptTime;
        }
        if (delay > 0)         Thread.sleep(delay);
      }
 catch (      InterruptedException interrupt) {
      }
      if (stop)       break;
      if (!verifyConnected())       return;
      uploaded=coordinator.getUploaded();
      downloaded=coordinator.getDownloaded();
      left=coordinator.getLeft();
      String event;
      if (!completed && left == 0) {
        completed=true;
        event=COMPLETED_EVENT;
      }
 else       event=NO_EVENT;
      sleptTime=0;
      if (event == COMPLETED_EVENT || coordinator.needPeers() || System.currentTimeMillis() > lastRequestTime + interval) {
        try {
          TrackerInfo info=doRequest(announce,infoHash,peerID,uploaded,downloaded,left,event);
          coordinator.trackerProblems=null;
          Set peers=info.getPeers();
          coordinator.trackerSeenPeers=peers.size();
          if ((left > 0) && (!completed)) {
            List ordered=new ArrayList(peers);
            Collections.shuffle(ordered);
            Iterator it=ordered.iterator();
            while (it.hasNext()) {
              Peer cur=(Peer)it.next();
              if (coordinator.addPeer(cur)) {
                int delay=DELAY_MUL;
                delay*=((int)cur.getPeerID().getAddress().calculateHash().toBase64().charAt(0)) % 10;
                delay+=DELAY_MIN;
                sleptTime+=delay;
                try {
                  Thread.sleep(delay);
                }
 catch (                InterruptedException ie) {
                }
              }
            }
          }
        }
 catch (        IOException ioe) {
          Snark.debug("WARNING: Could not contact tracker at '" + announce + "': "+ ioe,Snark.WARNING);
          coordinator.trackerProblems=ioe.getMessage();
          if (coordinator.trackerProblems.toLowerCase().startsWith(NOT_REGISTERED)) {
            stop=true;
            coordinator.snark.stopTorrent();
          }
        }
      }
    }
  }
 catch (  Throwable t) {
    I2PSnarkUtil.instance().debug("TrackerClient: " + t,Snark.ERROR,t);
    if (t instanceof OutOfMemoryError)     throw (OutOfMemoryError)t;
  }
 finally {
    try {
      if (!verifyConnected())       return;
      TrackerInfo info=doRequest(announce,infoHash,peerID,uploaded,downloaded,left,STOPPED_EVENT);
    }
 catch (    IOException ioe) {
    }
  }
}
