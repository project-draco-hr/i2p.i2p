{
  _context=ctx;
  _session=session;
  _log=ctx.logManager().getLog(KRPC.class);
  _tracker=new DHTTracker(ctx);
  _knownNodes=new DHTNodes(ctx);
  _sentQueries=new ConcurrentHashMap();
  _outgoingTokens=new ConcurrentHashMap();
  _incomingTokens=new ConcurrentHashMap();
  _qPort=30000 + ctx.random().nextInt(99);
  _rPort=_qPort + 1;
  byte[] myID=new byte[NID.HASH_LENGTH];
  ctx.random().nextBytes(myID);
  NID myNID=new NID(myID);
  _myNodeInfo=new NodeInfo(myNID,session.getMyDestination(),_qPort);
  session.addMuxedSessionListener(this,I2PSession.PROTO_DATAGRAM,_rPort);
  session.addMuxedSessionListener(this,I2PSession.PROTO_DATAGRAM,_qPort);
  SimpleScheduler.getInstance().addPeriodicEvent(new Cleaner(),CLEAN_TIME);
}
