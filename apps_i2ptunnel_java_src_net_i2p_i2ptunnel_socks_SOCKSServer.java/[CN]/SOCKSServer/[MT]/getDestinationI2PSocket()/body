{
  setupServer();
  if (connHostName == null) {
    _log.error("BUG: destination host name has not been initialized!");
    throw new SOCKSException("BUG! See the logs!");
  }
  if (connPort == 0) {
    _log.error("BUG: destination port has not been initialized!");
    throw new SOCKSException("BUG! See the logs!");
  }
  I2PSocket destSock;
  try {
    if (connHostName.toLowerCase().endsWith(".i2p")) {
      _log.debug("connecting to " + connHostName + "...");
      I2PSocketManager sm=I2PSocketManagerFactory.createManager();
      destSock=sm.connect(I2PTunnel.destFromName(connHostName),new I2PSocketOptions());
      confirmConnection();
      _log.debug("connection confirmed - exchanging data...");
    }
 else {
      _log.error("We don't support outproxies (yet)");
      throw new SOCKSException("Ouproxies not supported (yet)");
    }
  }
 catch (  DataFormatException e) {
    throw new SOCKSException("Error in destination format");
  }
catch (  SocketException e) {
    throw new SOCKSException("Error connecting (" + e.getMessage() + ")");
  }
catch (  IOException e) {
    throw new SOCKSException("Error connecting (" + e.getMessage() + ")");
  }
catch (  InterruptedException e) {
    throw new SOCKSException("Error connecting (" + e.getMessage() + ")");
  }
catch (  I2PException e) {
    throw new SOCKSException("Error connecting (" + e.getMessage() + ")");
  }
  return destSock;
}
