{
  SOCKSServer serv;
  try {
    DataInputStream in=new DataInputStream(s.getInputStream());
    int socksVer=in.readByte();
switch (socksVer) {
case 0x05:
      serv=new SOCKS5Server(s);
    break;
default :
  throw new SOCKSException("SOCKS protocol version not supported (" + Integer.toHexString(socksVer) + ")");
}
}
 catch (IOException e) {
_log.debug("error reading SOCKS protocol version");
throw new SOCKSException("Connection error (" + e.getMessage() + ")");
}
return serv;
}
