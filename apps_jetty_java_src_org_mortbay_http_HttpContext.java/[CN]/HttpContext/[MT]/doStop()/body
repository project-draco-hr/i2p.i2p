{
  if (_httpServer == null)   throw new InterruptedException("Destroy called");
synchronized (this) {
    Thread thread=Thread.currentThread();
    ClassLoader lastContextLoader=thread.getContextClassLoader();
    try {
      if (_loader != null)       thread.setContextClassLoader(_loader);
      Iterator handlers=_handlers.iterator();
      while (handlers.hasNext()) {
        HttpHandler handler=(HttpHandler)handlers.next();
        if (handler.isStarted()) {
          try {
            handler.stop();
          }
 catch (          Exception e) {
            log.warn(LogSupport.EXCEPTION,e);
          }
        }
      }
      if (_requestLog != null)       _requestLog.stop();
    }
  finally {
      thread.setContextClassLoader(lastContextLoader);
    }
    if (_loader instanceof ContextLoader) {
      ((ContextLoader)_loader).destroy();
      LogFactory.release(_loader);
    }
    _loader=null;
  }
  _resources.flushCache();
  _resources.stop();
}
