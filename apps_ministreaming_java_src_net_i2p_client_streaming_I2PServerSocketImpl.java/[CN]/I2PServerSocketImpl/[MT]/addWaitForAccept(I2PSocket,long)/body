{
  if (_log.shouldLog(Log.DEBUG))   _log.debug("addWaitForAccept [new socket arrived, pending: " + pendingSockets.size());
  if (closing) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Already closing the socket");
    return false;
  }
  Clock clock=I2PAppContext.getGlobalContext().clock();
  long start=clock.now();
  long end=start + timeoutMs;
  pendingSockets.add(s);
synchronized (socketAddedLock) {
    socketAddedLock.notifyAll();
  }
  while (pendingSockets.contains(s)) {
    long now=clock.now();
    if (now >= end) {
      if (_log.shouldLog(Log.INFO))       _log.info("Expired while waiting for accept (time elapsed =" + (now - start) + "ms");
      pendingSockets.remove(s);
      return false;
    }
    if (closing) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Server socket closed while waiting for accept");
      pendingSockets.remove(s);
      return false;
    }
    long remaining=end - now;
    try {
synchronized (socketAcceptedLock) {
        socketAcceptedLock.wait(remaining);
      }
    }
 catch (    InterruptedException ie) {
    }
  }
  long now=clock.now();
  if (_log.shouldLog(Log.DEBUG))   _log.info("Socket accepted after " + (now - start) + "ms");
  return true;
}
