{
  _log.debug("Read called: " + this.hashCode());
  if (len == 0)   return 0;
  long dieAfter=System.currentTimeMillis() + readTimeout;
  byte[] read=bc.startToByteArray(len);
  boolean timedOut=false;
  while (read.length == 0) {
synchronized (flagLock) {
      if (closed) {
        _log.debug("Closed is set, so closing stream: " + this.hashCode());
        return -1;
      }
    }
    try {
      if (readTimeout >= 0) {
        wait(readTimeout);
      }
 else {
        wait();
      }
    }
 catch (    InterruptedException ex) {
    }
    if ((readTimeout >= 0) && (System.currentTimeMillis() >= dieAfter)) {
      throw new InterruptedIOException("Timeout reading from I2PSocket (" + readTimeout + " msecs)");
    }
    read=bc.startToByteArray(len);
  }
  if (read.length > len)   throw new RuntimeException("BUG");
  System.arraycopy(read,0,b,off,read.length);
  if (_log.shouldLog(Log.DEBUG)) {
    _log.debug("Read from I2PInputStream " + this.hashCode() + " returned "+ read.length+ " bytes");
  }
  return read.length;
}
