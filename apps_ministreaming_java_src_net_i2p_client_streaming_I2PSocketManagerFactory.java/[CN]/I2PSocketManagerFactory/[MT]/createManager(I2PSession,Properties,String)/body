{
  if (false) {
    I2PSocketManagerImpl mgr=new I2PSocketManagerImpl();
    mgr.setSession(session);
    return mgr;
  }
 else {
    String classname=opts.getProperty(PROP_MANAGER,DEFAULT_MANAGER);
    if (classname != null) {
      try {
        Class cls=Class.forName(classname);
        Object obj=cls.newInstance();
        if (obj instanceof I2PSocketManager) {
          I2PSocketManager mgr=(I2PSocketManager)obj;
          I2PAppContext context=I2PAppContext.getGlobalContext();
          mgr.init(context,session,opts,name);
          return mgr;
        }
 else {
          throw new IllegalStateException("Invalid manager class [" + classname + "]");
        }
      }
 catch (      ClassNotFoundException cnfe) {
        _log.error("Error loading " + classname,cnfe);
        throw new IllegalStateException("Invalid manager class [" + classname + "] - not found");
      }
catch (      InstantiationException ie) {
        _log.error("Error loading " + classname,ie);
        throw new IllegalStateException("Invalid manager class [" + classname + "] - unable to instantiate");
      }
catch (      IllegalAccessException iae) {
        _log.error("Error loading " + classname,iae);
        throw new IllegalStateException("Invalid manager class [" + classname + "] - illegal access");
      }
    }
 else {
      throw new IllegalStateException("No manager class specified");
    }
  }
}
