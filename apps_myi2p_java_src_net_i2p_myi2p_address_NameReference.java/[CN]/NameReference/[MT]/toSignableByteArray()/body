{
  if (_sequenceNum < 0)   throw new IllegalStateException("Sequence number is invalid");
  if (_preferredName == null)   throw new IllegalStateException("Preferred name is invalid");
  if (_serviceType == null)   throw new IllegalStateException("Service type is invalid");
  if (_options == null)   throw new IllegalStateException("Options not constructed");
  if (_destination == null)   throw new IllegalStateException("Destination not specified");
  ByteArrayOutputStream baos=new ByteArrayOutputStream(512);
  try {
    baos.write(VERSION_PREFIX);
    _destination.writeBytes(baos);
    DataHelper.writeLong(baos,4,_sequenceNum);
    DataHelper.writeString(baos,_preferredName);
    DataHelper.writeString(baos,_serviceType);
    DataHelper.writeProperties(baos,_options);
    return baos.toByteArray();
  }
 catch (  DataFormatException dfe) {
    if (_log.shouldLog(Log.ERROR))     _log.error("Corrupted trying to write entry",dfe);
    return null;
  }
catch (  IOException ioe) {
    if (_log.shouldLog(Log.ERROR))     _log.error("IOError writing to memory?",ioe);
    return null;
  }
}
