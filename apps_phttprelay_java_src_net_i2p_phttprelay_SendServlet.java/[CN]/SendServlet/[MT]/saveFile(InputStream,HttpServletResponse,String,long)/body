{
  File identDir=getIdentDir(target);
  if (!identDir.exists())   return -1;
  try {
    LockManager.lockIdent(target);
    int i=0;
    while (true) {
      File curFile=new File(identDir,"msg" + i + ".dat");
      if (!curFile.exists()) {
        boolean ok=writeFile(curFile,in,len);
        if (ok)         return i;
 else         return -1;
      }
      i++;
      continue;
    }
  }
  finally {
    LockManager.unlockIdent(target);
  }
}
