{
  Set<String> unsetKeys=new HashSet(_context.router().getConfigSettings());
  if (_config != null) {
    Properties props=new Properties();
    try {
      DataHelper.loadProps(props,new ByteArrayInputStream(_config.getBytes()));
    }
 catch (    IOException ioe) {
      _log.error("Config error",ioe);
      addFormError(ioe.toString());
      addFormError(_("Error updating the configuration - please see the error logs"));
      return;
    }
    for (    Map.Entry e : props.entrySet()) {
      String key=(String)e.getKey();
      String val=(String)e.getValue();
      _context.router().setConfigSetting(key,val);
      unsetKeys.remove(key);
    }
    for (    String unsetKey : unsetKeys) {
      _context.router().removeConfigSetting(unsetKey);
    }
    boolean saved=_context.router().saveConfig();
    if (saved)     addFormNotice(_("Configuration saved successfully"));
 else     addFormError(_("Error saving the configuration (applied but not saved) - please see the error logs"));
  }
}
