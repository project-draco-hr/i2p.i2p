{
  if (_action == null)   return;
  if (_action.equals(_("Check for updates"))) {
    NewsFetcher fetcher=NewsFetcher.getInstance(I2PAppContext.getGlobalContext());
    fetcher.fetchNews();
    if (fetcher.shouldFetchUnsigned())     fetcher.fetchUnsignedHead();
    if (fetcher.updateAvailable() || fetcher.unsignedUpdateAvailable()) {
      if ((_updatePolicy == null) || (!_updatePolicy.equals("notify")))       addFormNotice(_("Update available, attempting to download now"));
 else       addFormNotice(_("Update available, click button on left to download"));
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException ie) {
      }
    }
 else     addFormNotice(_("No update available"));
    return;
  }
  if ((_newsURL != null) && (_newsURL.length() > 0)) {
    String oldURL=ConfigUpdateHelper.getNewsURL(_context);
    if ((oldURL == null) || (!_newsURL.equals(oldURL))) {
      _context.router().setConfigSetting(PROP_NEWS_URL,_newsURL);
      addFormNotice(_("Updating news URL to") + " " + _newsURL);
    }
  }
  if ((_proxyHost != null) && (_proxyHost.length() > 0)) {
    String oldHost=_context.router().getConfigSetting(PROP_PROXY_HOST);
    if ((oldHost == null) || (!_proxyHost.equals(oldHost))) {
      _context.router().setConfigSetting(PROP_PROXY_HOST,_proxyHost);
      addFormNotice(_("Updating proxy host to") + " " + _proxyHost);
    }
  }
  if ((_proxyPort != null) && (_proxyPort.length() > 0)) {
    String oldPort=_context.router().getConfigSetting(PROP_PROXY_PORT);
    if ((oldPort == null) || (!_proxyPort.equals(oldPort))) {
      _context.router().setConfigSetting(PROP_PROXY_PORT,_proxyPort);
      addFormNotice(_("Updating proxy port to") + " " + _proxyPort);
    }
  }
  _context.router().setConfigSetting(PROP_SHOULD_PROXY,"" + _updateThroughProxy);
  _context.router().setConfigSetting(PROP_UPDATE_UNSIGNED,"" + _updateUnsigned);
  String oldFreqStr=_context.router().getConfigSetting(PROP_REFRESH_FREQUENCY);
  long oldFreq=-1;
  if (oldFreqStr != null)   try {
    oldFreq=Long.parseLong(oldFreqStr);
  }
 catch (  NumberFormatException nfe) {
  }
  if (_refreshFrequency != oldFreq) {
    _context.router().setConfigSetting(PROP_REFRESH_FREQUENCY,"" + _refreshFrequency);
    addFormNotice(_("Updating refresh frequency to") + " " + DataHelper.formatDuration(_refreshFrequency));
  }
  if ((_updatePolicy != null) && (_updatePolicy.length() > 0)) {
    String oldPolicy=_context.router().getConfigSetting(PROP_UPDATE_POLICY);
    if ((oldPolicy == null) || (!_updatePolicy.equals(oldPolicy))) {
      _context.router().setConfigSetting(PROP_UPDATE_POLICY,_updatePolicy);
      addFormNotice(_("Updating update policy to") + " " + _updatePolicy);
    }
  }
  if ((_updateURL != null) && (_updateURL.length() > 0)) {
    _updateURL=_updateURL.replace("\r\n",",").replace("\n",",");
    String oldURL=_context.router().getConfigSetting(PROP_UPDATE_URL);
    if ((oldURL == null) || (!_updateURL.equals(oldURL))) {
      _context.router().setConfigSetting(PROP_UPDATE_URL,_updateURL);
      addFormNotice(_("Updating update URLs."));
    }
  }
  if ((_trustedKeys != null) && (_trustedKeys.length() > 0)) {
    _trustedKeys=_trustedKeys.replace("\r\n",",").replace("\n",",");
    String oldKeys=new TrustedUpdate(_context).getTrustedKeysString();
    if ((oldKeys == null) || (!_trustedKeys.equals(oldKeys))) {
      _context.router().setConfigSetting(PROP_TRUSTED_KEYS,_trustedKeys);
      addFormNotice(_("Updating trusted keys."));
    }
  }
  if ((_zipURL != null) && (_zipURL.length() > 0)) {
    String oldURL=_context.router().getConfigSetting(PROP_ZIP_URL);
    if ((oldURL == null) || (!_zipURL.equals(oldURL))) {
      _context.router().setConfigSetting(PROP_ZIP_URL,_zipURL);
      addFormNotice(_("Updating unsigned update URL to") + " " + _zipURL);
    }
  }
  _context.router().saveConfig();
}
