{
  ByteArrayOutputStream baos=new ByteArrayOutputStream(4 * 1024);
  String hostname=url.getHost();
  int port=url.getPort();
  if (port < 0)   port=80;
  Socket s=new Socket(hostname,port);
  OutputStream out=s.getOutputStream();
  InputStream in=s.getInputStream();
  String request=getRequest(url);
  out.write(request.getBytes());
  out.flush();
  int consecutiveNL=0;
  while (true) {
    int cur=in.read();
switch (cur) {
case -1:
      return null;
case '\n':
case '\r':
    consecutiveNL++;
  break;
default :
consecutiveNL=0;
}
if (consecutiveNL == 4) break;
}
byte buf[]=new byte[1024];
while (true) {
int read=in.read(buf);
if (read < 0) break;
baos.write(buf,0,read);
}
in.close();
s.close();
return baos.toByteArray();
}
