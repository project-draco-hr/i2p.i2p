{
  I2PAppContext ctx=I2PAppContext.getGlobalContext();
  byte[] rand=new byte[30];
  ctx.random().nextBytes(rand);
  String keyPassword=Base32.encode(rand);
  ctx.random().nextBytes(rand);
  String cname=Base32.encode(rand) + ".console.i2p.net";
  String keytool=(new File(System.getProperty("java.home"),"bin/keytool")).getAbsolutePath();
  String[] args=new String[]{keytool,"-genkey","-storetype","JKS","-keystore",ks.getAbsolutePath(),"-storepass",DEFAULT_KEYSTORE_PASSWORD,"-alias","console","-dname","CN=" + cname + ",OU=Console,O=I2P Anonymous Network,L=XX,ST=XX,C=XX","-validity","3652","-keyalg","DSA","-keysize","1024","-keypass",keyPassword};
  boolean success=(new ShellCommand()).executeSilentAndWaitTimed(args,30);
  if (success) {
    success=ks.exists();
    if (success) {
      SecureFileOutputStream.setPerms(ks);
      try {
        RouterContext rctx=(RouterContext)ctx;
        rctx.router().setConfigSetting(PROP_KEYSTORE_PASSWORD,DEFAULT_KEYSTORE_PASSWORD);
        rctx.router().setConfigSetting(PROP_KEY_PASSWORD,keyPassword);
        rctx.router().saveConfig();
      }
 catch (      Exception e) {
      }
    }
  }
  if (success) {
    System.err.println("Created self-signed certificate for " + cname + " in keystore: "+ ks.getAbsolutePath()+ "\n"+ "The certificate name was generated randomly, and is not associated with your "+ "IP address, host name, router identity, or destination keys.");
  }
 else {
    System.err.println("Failed to create console SSL keystore using command line:");
    StringBuilder buf=new StringBuilder(256);
    for (int i=0; i < args.length; i++) {
      buf.append('"').append(args[i]).append("\" ");
    }
    System.err.println(buf.toString());
    System.err.println("This is for the Sun/Oracle keytool, others may be incompatible.\n" + "If you create the keystore manually, you must add " + PROP_KEYSTORE_PASSWORD + " and "+ PROP_KEY_PASSWORD+ " to "+ (new File(ctx.getConfigDir(),"router.config")).getAbsolutePath());
  }
  return success;
}
