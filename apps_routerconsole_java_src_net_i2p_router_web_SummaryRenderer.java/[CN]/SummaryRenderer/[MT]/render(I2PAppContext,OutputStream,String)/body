{
  long end=ctx.clock().now() - 60 * 1000;
  long start=end - 60 * 1000 * SummaryListener.PERIODS;
  try {
    RrdGraphDefTemplate template=new RrdGraphDefTemplate(filename);
    RrdGraphDef def=template.getRrdGraphDef();
    def.setTimeSpan(start / 1000,end / 1000);
    int width=GraphHelper.DEFAULT_X;
    int height=GraphHelper.DEFAULT_Y;
    def.setWidth(width);
    def.setHeight(height);
    RrdGraph graph=new RrdGraph(def);
    int totalWidth=graph.getRrdGraphInfo().getWidth();
    int totalHeight=graph.getRrdGraphInfo().getHeight();
    BufferedImage img=new BufferedImage(totalWidth,totalHeight,BufferedImage.TYPE_USHORT_565_RGB);
    Graphics gfx=img.getGraphics();
    graph.render(gfx);
    ImageOutputStream ios=new MemoryCacheImageOutputStream(out);
    ImageIO.write(img,"png",ios);
  }
 catch (  RrdException re) {
    throw new IOException("Error plotting: " + re.getMessage());
  }
catch (  IOException ioe) {
    throw ioe;
  }
}
