{
  this.recv=recv;
  _log.debug("SAM STREAM session instantiated");
  Properties allprops=(Properties)System.getProperties().clone();
  allprops.putAll(props);
  String i2cpHost=allprops.getProperty(I2PClient.PROP_TCP_HOST,"127.0.0.1");
  int i2cpPort=7654;
  String port=allprops.getProperty(I2PClient.PROP_TCP_PORT,"7654");
  try {
    i2cpPort=Integer.parseInt(port);
  }
 catch (  NumberFormatException nfe) {
    throw new SAMException("Invalid I2CP port specified [" + port + "]");
  }
  _log.debug("Creating I2PSocketManager...");
  socketMgr=I2PSocketManagerFactory.createManager(destStream,i2cpHost,i2cpPort,allprops);
  if (socketMgr == null) {
    throw new SAMException("Error creating I2PSocketManager");
  }
  socketMgr.addDisconnectListener(new DisconnectListener());
  forceFlush=Boolean.valueOf(allprops.getProperty(PROP_FORCE_FLUSH,DEFAULT_FORCE_FLUSH)).booleanValue();
  boolean canReceive=false;
  if (dir.equals("BOTH")) {
    canCreate=true;
    canReceive=true;
  }
 else   if (dir.equals("CREATE")) {
    canCreate=true;
  }
 else   if (dir.equals("RECEIVE")) {
    canReceive=true;
  }
 else {
    _log.error("BUG! Wrong direction passed to SAMStreamSession: " + dir);
    throw new SAMException("BUG! Wrong direction specified!");
  }
  if (canReceive) {
    server=new SAMStreamSessionServer();
    Thread t=new I2PAppThread(server,"SAMStreamSessionServer");
    t.start();
  }
}
