def append(self, item, state=None, **kw):
    if isinstance(item, KPeerQueryRecord):
        self.log(5, ('adding a KPeerQueryRecord, state=%s' % state))
        if (state != None):
            item.state = state
        item.__dict__.update(kw)
        peerRec = item
    elif isinstance(item, KPeer):
        self.log(5, 'adding a KPeer')
        peerRec = KPeerQueryRecord(item, self, state, **kw)
    else:
        self.log(2, ('bad peer %s' % repr(item)))
        raise KBadPeer
    if (peerRec not in self):
        self.log(5, ('peerRec=%s list=%s' % (peerRec, self.peers)))
        self.peers.append(peerRec)
    else:
        self.log(5, 'trying to append duplicate peer???')
