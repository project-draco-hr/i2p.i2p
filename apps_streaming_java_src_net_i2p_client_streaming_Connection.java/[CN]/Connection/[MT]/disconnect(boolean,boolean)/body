{
  if (!_connected)   return;
  _connected=false;
synchronized (_connectLock) {
    _connectLock.notifyAll();
  }
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Disconnecting " + toString(),new Exception("discon"));
  if (cleanDisconnect) {
    _outputStream.closeInternal();
    _inputStream.close();
  }
 else {
    doClose();
synchronized (_outboundPackets) {
      for (Iterator iter=_outboundPackets.values().iterator(); iter.hasNext(); ) {
        PacketLocal pl=(PacketLocal)iter.next();
        pl.cancelled();
      }
      _outboundPackets.clear();
      _outboundPackets.notifyAll();
    }
    if (removeFromConMgr) {
      if (!_disconnectScheduled) {
        _disconnectScheduled=true;
        SimpleTimer.getInstance().addEvent(new DisconnectEvent(),DISCONNECT_TIMEOUT);
      }
    }
  }
}
