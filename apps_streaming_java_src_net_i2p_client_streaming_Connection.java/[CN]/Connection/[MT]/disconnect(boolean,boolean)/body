{
synchronized (_connectLock) {
    _connectLock.notifyAll();
  }
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Disconnecting " + toString(),new Exception("discon"));
  if (!cleanDisconnect) {
    _hardDisconnected=true;
    if (_log.shouldLog(Log.WARN))     _log.warn("Hard disconnecting and sending a reset on " + toString(),new Exception("cause"));
    sendReset();
  }
  if (cleanDisconnect && _connected) {
    _outputStream.closeInternal();
    _inputStream.close();
  }
 else {
    if (_connected)     doClose();
    killOutstandingPackets();
  }
  if (removeFromConMgr) {
    if (_disconnectScheduledOn < 0) {
      _disconnectScheduledOn=_context.clock().now();
      _context.simpleScheduler().addEvent(new DisconnectEvent(),DISCONNECT_TIMEOUT);
    }
  }
  _connected=false;
}
