{
  boolean doSend=true;
  if ((size <= 0) && (_connection.getLastSendId() >= 0)) {
    if (_connection.getOutputStream().getClosed()) {
      if (_connection.getCloseSentOn() < 0) {
        doSend=true;
      }
 else {
        doSend=false;
      }
    }
 else {
      doSend=false;
    }
  }
  if (_connection.getUnackedPacketsReceived() > 0)   doSend=true;
  if (_log.shouldLog(Log.INFO) && !doSend)   _log.info("writeData called: size=" + size + " doSend="+ doSend+ " unackedReceived: "+ _connection.getUnackedPacketsReceived()+ " con: "+ _connection,new Exception("write called by"));
  if (doSend) {
    PacketLocal packet=send(buf,off,size);
    if ((packet.getPayloadSize() > 0) || (packet.isFlagSet(Packet.FLAG_SYNCHRONIZE)))     return packet;
 else     return _dummyStatus;
  }
 else {
    return _dummyStatus;
  }
}
