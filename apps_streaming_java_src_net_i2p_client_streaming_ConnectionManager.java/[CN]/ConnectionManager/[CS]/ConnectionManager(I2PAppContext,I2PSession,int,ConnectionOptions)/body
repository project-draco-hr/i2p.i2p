{
  _context=context;
  _log=context.logManager().getLog(ConnectionManager.class);
  _connectionByInboundId=new HashMap(32);
  _pendingPings=new HashMap(4);
  _connectionLock=new Object();
  _messageHandler=new MessageHandler(context,this);
  _packetHandler=new PacketHandler(context,this);
  _connectionHandler=new ConnectionHandler(context,this);
  _schedulerChooser=new SchedulerChooser(context);
  _conPacketHandler=new ConnectionPacketHandler(context);
  _session=session;
  session.setSessionListener(_messageHandler);
  _outboundQueue=new PacketQueue(context,session,this);
  _allowIncoming=false;
  _maxConcurrentStreams=maxConcurrent;
  _defaultOptions=defaultOptions;
  _numWaiting=0;
  SoTimeout=-1;
  _context.statManager().createRateStat("stream.con.lifetimeMessagesSent","How many messages do we send on a stream?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.con.lifetimeMessagesReceived","How many messages do we receive on a stream?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.con.lifetimeBytesSent","How many bytes do we send on a stream?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.con.lifetimeBytesReceived","How many bytes do we receive on a stream?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.con.lifetimeDupMessagesSent","How many duplicate messages do we send on a stream?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.con.lifetimeDupMessagesReceived","How many duplicate messages do we receive on a stream?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.con.lifetimeRTT","What is the final RTT when a stream closes?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.con.lifetimeCongestionSeenAt","When was the last congestion seen at when a stream closes?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.con.lifetimeSendWindowSize","What is the final send window size when a stream closes?","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
  _context.statManager().createRateStat("stream.receiveActive","How many streams are active when a new one is received (period being not yet dropped)","Stream",new long[]{60 * 60 * 1000,24 * 60 * 60* 1000});
}
