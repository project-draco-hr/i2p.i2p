{
  PingRequest req=new PingRequest();
  byte id[]=new byte[4];
  _context.random().nextBytes(id);
  ByteArray ba=new ByteArray(id);
synchronized (_pendingPings) {
    _pendingPings.put(ba,req);
  }
  PacketLocal packet=new PacketLocal(_context,peer);
  packet.setSendStreamId(id);
  packet.setFlag(Packet.FLAG_ECHO);
  packet.setFlag(Packet.FLAG_SIGNATURE_INCLUDED);
  packet.setOptionalFrom(_session.getMyDestination());
  _outboundQueue.enqueue(packet);
synchronized (req) {
    if (!req.pongReceived())     try {
      req.wait(timeoutMs);
    }
 catch (    InterruptedException ie) {
    }
  }
synchronized (_pendingPings) {
    _pendingPings.remove(ba);
  }
  boolean ok=req.pongReceived();
  if (ok) {
    _context.sessionKeyManager().tagsDelivered(peer.getPublicKey(),packet.getKeyUsed(),packet.getTagsSent());
  }
  return ok;
}
