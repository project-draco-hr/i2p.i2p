{
  if (_connectionManager.getSession().isClosed())   throw new I2PException("Session is closed");
  if (options == null)   options=_defaultOptions;
  ConnectionOptions opts=null;
  if (options instanceof ConnectionOptions)   opts=(ConnectionOptions)options;
 else   opts=new ConnectionOptions(options);
  Connection con=_connectionManager.connect(peer,opts);
  if (con == null)   throw new TooManyStreamsException("Too many streams (max " + _maxStreams + ")");
  I2PSocketFull socket=new I2PSocketFull(con);
  con.setSocket(socket);
  if (con.getConnectionError() != null) {
    con.disconnect(false);
    throw new NoRouteToHostException(con.getConnectionError());
  }
  return socket;
}
