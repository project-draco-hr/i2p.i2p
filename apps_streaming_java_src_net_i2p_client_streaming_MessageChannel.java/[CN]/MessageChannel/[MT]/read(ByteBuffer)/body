{
  int amount=0;
  for (; ; ) {
    byte[] lbuf=new byte[buf.remaining()];
    int samount=in.read(lbuf);
    if (samount <= 0) {
      this.close();
    }
    if (samount == 0) {
      break;
    }
    amount+=samount;
    buf.put(lbuf,0,samount);
  }
  return amount;
}
