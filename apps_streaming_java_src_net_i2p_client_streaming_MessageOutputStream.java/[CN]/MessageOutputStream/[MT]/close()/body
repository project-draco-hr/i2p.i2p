{
  if (_closed)   return;
  _closed=true;
  flush();
  _log.debug("Output stream closed after writing " + _written);
  ByteArray ba=null;
synchronized (_dataLock) {
    if (_buf != null) {
      ba=new ByteArray(_buf);
      _buf=null;
      _valid=0;
      locked_updateBufferSize();
    }
  }
  if (ba != null) {
    _dataCache.release(ba);
  }
}
