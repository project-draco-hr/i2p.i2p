{
  WriteStatus ws=null;
synchronized (_dataLock) {
    if (_buf == null)     throw new IOException("closed (buffer went away)");
    if (_dataReceiver == null) {
      throwAnyError();
      return;
    }
    ws=_dataReceiver.writeData(_buf,0,_valid);
    _written+=_valid;
    _valid=0;
    _dataLock.notifyAll();
  }
  if (_log.shouldLog(Log.DEBUG))   _log.debug("before waiting " + _writeTimeout + "ms for completion of "+ ws);
  if (_closed && ((_writeTimeout > Connection.DISCONNECT_TIMEOUT) || (_writeTimeout <= 0)))   ws.waitForCompletion(Connection.DISCONNECT_TIMEOUT);
 else   ws.waitForCompletion(_writeTimeout);
  if (_log.shouldLog(Log.DEBUG))   _log.debug("after waiting " + _writeTimeout + "ms for completion of "+ ws);
  if (ws.writeFailed() && (_writeTimeout > 0))   throw new InterruptedIOException("Timed out during write");
 else   if (ws.writeFailed())   throw new IOException("Write failed");
  throwAnyError();
}
