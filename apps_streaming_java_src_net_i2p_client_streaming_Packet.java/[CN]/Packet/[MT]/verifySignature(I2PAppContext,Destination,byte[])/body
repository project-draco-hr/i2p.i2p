{
  if (!isFlagSet(FLAG_SIGNATURE_INCLUDED))   return false;
  if (_optionSignature == null)   return false;
  if (from == null)   return false;
  int size=writtenSize();
  if (buffer == null)   buffer=new byte[size];
  int written=writePacket(buffer,0,false);
  if (written != size) {
    ctx.logManager().getLog(Packet.class).error("Written " + written + " size "+ size+ " for "+ toString(),new Exception("moo"));
    return false;
  }
  boolean ok=ctx.dsa().verifySignature(_optionSignature,buffer,0,size,from.getSigningPublicKey());
  if (!ok) {
    Log l=ctx.logManager().getLog(Packet.class);
    if (l.shouldLog(Log.WARN))     l.warn("Signature failed on " + toString(),new Exception("moo"));
    if (false) {
      l.error(Base64.encode(buffer,0,size));
      l.error("Signature: " + Base64.encode(_optionSignature.getData()));
    }
  }
  return ok;
}
