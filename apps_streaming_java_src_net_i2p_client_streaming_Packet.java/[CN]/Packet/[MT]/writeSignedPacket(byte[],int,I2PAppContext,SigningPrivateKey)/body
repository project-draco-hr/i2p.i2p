{
  setFlag(FLAG_SIGNATURE_INCLUDED);
  int size=writePacket(buffer,offset,false);
  _optionSignature=ctx.dsa().sign(buffer,offset,size,key);
  int signatureOffset=offset + 4 + 4+ 4+ 4+ (_nacks != null ? 4 * _nacks.length + 1 : 1)+ 1+ 2+ 2+ (isFlagSet(FLAG_DELAY_REQUESTED) ? 2 : 0)+ (isFlagSet(FLAG_FROM_INCLUDED) ? _optionFrom.size() : 0)+ (isFlagSet(FLAG_MAX_PACKET_SIZE_INCLUDED) ? 2 : 0);
  System.arraycopy(_optionSignature.getData(),0,buffer,signatureOffset,_optionSignature.length());
  return size;
}
