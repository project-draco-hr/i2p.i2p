{
  Debug.debug(Debug.DEBUG,"connect()");
  if (Debug.getLevel() == Debug.DEBUG)   (new Exception("I did it")).printStackTrace();
  clear();
  if (socket != null && socket.isConnected())   close();
  try {
    socket=new Socket(host,port);
  }
 catch (  UnknownHostException e) {
    lastError=e.toString();
    return;
  }
catch (  IOException e) {
    lastError=e.toString();
    return;
  }
  if (socket != null) {
    try {
      lastError="";
      boolean ok=doHandshake();
      if (ok) {
        List<SendRecv> cmds=new ArrayList<SendRecv>(4);
        cmds.add(new SendRecv("USER " + user,Mode.A1));
        cmds.add(new SendRecv("PASS " + pass,Mode.A1));
        ok=sendCmds(cmds);
      }
      if (ok) {
        connected=true;
        List<SendRecv> cmds=new ArrayList<SendRecv>(4);
        SendRecv stat=new SendRecv("STAT",Mode.A1);
        cmds.add(stat);
        SendRecv uidl=new SendRecv("UIDL",Mode.LS);
        cmds.add(uidl);
        SendRecv list=new SendRecv("LIST",Mode.LS);
        cmds.add(list);
        sendCmds(cmds);
        if (stat.result)         updateMailCount(stat.response);
 else         Debug.debug(Debug.DEBUG,"STAT failed");
        if (uidl.result)         updateUIDLs(uidl.ls);
 else         Debug.debug(Debug.DEBUG,"UIDL failed");
        if (list.result)         updateSizes(list.ls);
 else         Debug.debug(Debug.DEBUG,"LIST failed");
      }
 else {
        if (lastError.equals(""))         lastError=_("Error connecting to server");
        close();
      }
    }
 catch (    NumberFormatException e1) {
      lastError=_("Error opening mailbox") + ": " + e1;
    }
catch (    IOException e1) {
      lastError=_("Error opening mailbox") + ": " + e1.getLocalizedMessage();
    }
  }
}
