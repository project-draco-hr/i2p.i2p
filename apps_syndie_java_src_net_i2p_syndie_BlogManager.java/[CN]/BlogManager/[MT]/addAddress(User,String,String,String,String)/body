{
  if (!user.getAuthenticated())   return "<span class=\"b_addrMsgErr\">Not logged in</span>";
  boolean ok=validateAddressName(name);
  if (!ok)   return "<span class=\"b_addrMsgErr\">Invalid name: " + HTMLRenderer.sanitizeString(name) + "</span>";
  ok=validateAddressLocation(location);
  if (!ok)   return "<span class=\"b_addrMsgErr\">Invalid location: " + HTMLRenderer.sanitizeString(location) + "</span>";
  if (!validateAddressSchema(schema))   return "<span class=\"b_addrMsgErr\">Unsupported schema: " + HTMLRenderer.sanitizeString(schema) + "</span>";
  PetNameDB names=user.getPetNameDB();
  if (names.exists(name))   return "<span class=\"b_addrMsgErr\">Name is already in use</span>";
  PetName pn=new PetName(name,schema,protocol,location);
  names.set(name,pn);
  try {
    names.store(user.getAddressbookLocation());
    return "<span class=\"b_addrMsgOk\">Address " + name + " written to your addressbook</span>";
  }
 catch (  IOException ioe) {
    return "<span class=\"b_addrMsgErr\">Error writing out the name: " + ioe.getMessage() + "</span>";
  }
}
