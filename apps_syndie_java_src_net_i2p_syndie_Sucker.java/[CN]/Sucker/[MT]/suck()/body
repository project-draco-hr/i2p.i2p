{
  SyndFeed feed;
  File fetched=null;
  tempFiles=new ArrayList();
  int idx=urlToLoad.lastIndexOf('/');
  if (idx > 0)   baseUrl=urlToLoad.substring(0,idx);
 else   baseUrl=urlToLoad;
  infoLog("Processing: " + urlToLoad);
  debugLog("Base url: " + baseUrl);
  try {
    File lastIdFile=null;
    if (!pushToSyndie) {
      lastIdFile=new File(historyPath + ".lastId");
      if (!lastIdFile.exists())       lastIdFile.createNewFile();
      FileInputStream fis=new FileInputStream(lastIdFile);
      String number=readLine(fis);
      try {
        messageNumber=Integer.parseInt(number);
      }
 catch (      NumberFormatException e) {
        messageNumber=0;
      }
      File f=new File(outputDir);
      f.mkdirs();
    }
 else {
      messageNumber=bm.getNextBlogEntry(user);
    }
    _log.debug("message number: " + messageNumber);
    historyFile=new File(historyPath);
    if (!historyFile.exists())     historyFile.createNewFile();
    shouldProxy=false;
    proxyPortNum=-1;
    if ((proxyHost != null) && (proxyPort != null)) {
      try {
        proxyPortNum=Integer.parseInt(proxyPort);
        if (proxyPortNum > 0)         shouldProxy=true;
      }
 catch (      NumberFormatException nfe) {
        nfe.printStackTrace();
      }
    }
    int numRetries=2;
    fetched=File.createTempFile("sucker",".fetch");
    EepGet get=new EepGet(I2PAppContext.getGlobalContext(),shouldProxy,proxyHost,proxyPortNum,numRetries,fetched.getAbsolutePath(),urlToLoad);
    SuckerFetchListener lsnr=new SuckerFetchListener();
    get.addStatusListener(lsnr);
    _log.debug("fetching [" + urlToLoad + "] / "+ shouldProxy+ "/"+ proxyHost+ "/"+ proxyHost);
    get.fetch();
    _log.debug("fetched: " + get.getNotModified() + "/"+ get.getETag());
    boolean ok=lsnr.waitForSuccess();
    if (!ok) {
      _log.debug("success? " + ok);
      System.err.println("Unable to retrieve the url after " + numRetries + " tries.");
      fetched.delete();
      return;
    }
    _log.debug("fetched successfully? " + ok);
    if (get.getNotModified()) {
      debugLog("not modified, saving network bytes from useless fetch");
      fetched.delete();
      return;
    }
    SyndFeedInput input=new SyndFeedInput();
    feed=input.build(new XmlReader(fetched));
    List entries=feed.getEntries();
    _log.debug("entries: " + entries.size());
    FileOutputStream hos=new FileOutputStream(historyFile,true);
    for (int i=entries.size() - 1; i >= 0; i--) {
      SyndEntry e=(SyndEntry)entries.get(i);
      attachmentCounter=0;
      if (_log.shouldLog(Log.DEBUG))       _log.debug("Syndicate entry: " + e.getLink());
      String messageId=convertToSml(e);
      if (messageId != null) {
        hos.write(messageId.getBytes());
        hos.write("\n".getBytes());
      }
    }
    if (!pushToSyndie) {
      FileOutputStream fos=new FileOutputStream(lastIdFile);
      fos.write(("" + messageNumber).getBytes());
    }
    _log.debug("done fetching");
  }
 catch (  MalformedURLException e) {
    e.printStackTrace();
  }
catch (  IllegalArgumentException e) {
    e.printStackTrace();
  }
catch (  FeedException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
  }
  if (fetched != null)   fetched.delete();
  debugLog("Done.");
}
