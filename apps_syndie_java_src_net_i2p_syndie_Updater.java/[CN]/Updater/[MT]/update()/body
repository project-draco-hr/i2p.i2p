{
  BlogManager bm=BlogManager.instance();
  if (_lastUpdate + bm.getUpdateDelay() * 60 * 60* 1000 > System.currentTimeMillis()) {
    return;
  }
  _lastUpdate=System.currentTimeMillis();
  _log.debug("Update started.");
  User user=new User();
  RemoteArchiveBean rab=new RemoteArchiveBean();
  String[] archives=bm.getUpdateArchives();
  for (int i=0; i < archives.length; i++) {
    _log.debug("Fetching " + archives[i]);
    rab.fetchIndex(user,"web",archives[i],bm.getDefaultProxyHost(),bm.getDefaultProxyPort());
    if (rab.getRemoteIndex() != null) {
      _log.debug("Index fetched, getting new entries.");
      HashMap parameters=new HashMap();
      parameters.put("action",new String[]{"Fetch all new entries"});
      rab.fetchSelectedBulk(user,parameters);
      _log.debug(rab.getStatus());
      _log.debug("Update finished.");
    }
 else {
      _log.debug("Index fetch failed.");
    }
  }
}
