{
  if (!user.getAuthenticated())   return false;
  boolean rv=false;
  String loc=req.getParameter(ThreadedHTMLRenderer.PARAM_ADD_TO_GROUP_LOCATION);
  String group=req.getParameter(ThreadedHTMLRenderer.PARAM_ADD_TO_GROUP_NAME);
  if ((loc != null) && (group != null) && (group.trim().length() > 0)) {
    try {
      Hash key=new Hash();
      key.fromBase64(loc);
      PetNameDB db=user.getPetNameDB();
      PetName pn=db.getByLocation(loc);
      boolean isNew=false;
      if (pn == null) {
        isNew=true;
        BlogInfo info=BlogManager.instance().getArchive().getBlogInfo(key);
        String name=null;
        if (info != null)         name=info.getProperty(BlogInfo.NAME);
 else         name=loc.substring(0,6);
        if (db.containsName(name)) {
          int i=0;
          while (db.containsName(name + i))           i++;
          name=name + i;
        }
        pn=new PetName(name,"syndie","syndieblog",loc);
      }
      pn.addGroup(group);
      if (isNew)       db.add(pn);
      BlogManager.instance().saveUser(user);
      if (FilteredThreadIndex.GROUP_IGNORE.equals(group))       rv=true;
    }
 catch (    DataFormatException dfe) {
    }
  }
  String name=req.getParameter(ThreadedHTMLRenderer.PARAM_REMOVE_FROM_GROUP_NAME);
  group=req.getParameter(ThreadedHTMLRenderer.PARAM_REMOVE_FROM_GROUP);
  if ((name != null) && (name.trim().length() > 0)) {
    PetNameDB db=user.getPetNameDB();
    PetName pn=db.getByName(name);
    boolean changed=false;
    if (pn != null) {
      if ((group != null) && (group.trim().length() > 0)) {
        changed=pn.isMember(group);
        pn.removeGroup(group);
        if ((changed) && (FilteredThreadIndex.GROUP_IGNORE.equals(group)))         rv=true;
      }
 else {
        if (pn.isMember(FilteredThreadIndex.GROUP_IGNORE))         rv=true;
        db.remove(pn);
        changed=true;
      }
    }
    if (changed)     BlogManager.instance().saveUser(user);
  }
  return rv;
}
