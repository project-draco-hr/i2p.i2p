{
  if (!user.getAuthenticated()) {
    out.write("<tr><td colspan=\"3\">You must be logged in to post</td></tr>\n");
  }
 else {
    PostBean post=getPostBean(user,req);
    String action=req.getParameter(PARAM_ACTION);
    if (!empty(action) && ACTION_CONFIRM.equals(action)) {
      postEntry(user,req,archive,post,out);
    }
 else {
      String contentType=req.getContentType();
      if (!empty(contentType) && (contentType.indexOf("boundary=") != -1)) {
        previewPostedData(user,req,archive,contentType,post,out);
      }
 else {
        displayNewForm(user,req,post,out);
      }
    }
  }
}
