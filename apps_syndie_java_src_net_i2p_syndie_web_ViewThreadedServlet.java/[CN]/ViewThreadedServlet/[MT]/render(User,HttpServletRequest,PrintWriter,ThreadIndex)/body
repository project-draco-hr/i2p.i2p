{
  Archive archive=BlogManager.instance().getArchive();
  int numThreads=10;
  int threadOffset=getOffset(req);
  if (threadOffset == -1) {
    threadOffset=index.getRootCount() - numThreads;
  }
  if (threadOffset < 0) {
    threadOffset=0;
  }
  BlogURI visibleEntry=getVisible(req);
  int offset=0;
  if (empty(req,PARAM_OFFSET) && (visibleEntry != null)) {
    threadOffset=index.getRoot(visibleEntry);
    if (threadOffset < 0)     threadOffset=0;
  }
  renderBegin(user,req,out,index);
  renderNavBar(user,req,out,index);
  renderControlBar(user,req,out,index);
  renderBody(user,req,out,index);
  renderThreadNav(user,req,out,threadOffset,index);
  renderThreadTree(user,req,out,threadOffset,visibleEntry,archive,index);
  renderThreadNav(user,req,out,threadOffset,index);
  renderEnd(user,req,out,index);
}
