{
  if ((visibleEntry != null) && (empty(req,ThreadedHTMLRenderer.PARAM_OFFSET))) {
    threadOffset=index.getRoot(visibleEntry);
  }
  if (threadOffset < 0)   threadOffset=0;
  out.write("<!-- threads begin -->\n");
  if (threadOffset + numThreads > index.getRootCount())   numThreads=index.getRootCount() - threadOffset;
  TreeRenderState state=new TreeRenderState(new ArrayList());
  for (int curRoot=threadOffset; curRoot < numThreads + threadOffset; curRoot++) {
    ThreadNode node=index.getRoot(curRoot);
    out.write("<!-- thread begin node=" + node + " curRoot="+ curRoot+ " threadOffset="+ threadOffset+ " -->\n");
    renderThread(user,out,index,archive,req,node,0,visibleEntry,state);
    out.write("<!-- thread end -->\n");
  }
  out.write("<!-- threads begin -->\n");
}
