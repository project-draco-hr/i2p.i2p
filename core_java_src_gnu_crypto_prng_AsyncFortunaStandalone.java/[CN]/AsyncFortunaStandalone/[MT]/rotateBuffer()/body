{
synchronized (asyncBuffers) {
    long before=System.currentTimeMillis();
    long waited=0;
    while (status[nextBuf] != STATUS_FILLED) {
      asyncBuffers.notifyAll();
      try {
        asyncBuffers.wait();
      }
 catch (      InterruptedException ie) {
      }
      waited=System.currentTimeMillis() - before;
    }
    _context.statManager().addRateData("prng.bufferWaitTime",waited,0);
    if (waited > 10 * 1000 && _log.shouldLog(Log.WARN))     _log.warn(Thread.currentThread().getName() + ": Took " + waited+ "ms for a full PRNG buffer to be found");
    buffer=asyncBuffers[nextBuf];
    status[nextBuf]=STATUS_LIVE;
    int prev=nextBuf - 1;
    if (prev < 0)     prev=_bufferCount - 1;
    if (status[prev] == STATUS_LIVE)     status[prev]=STATUS_NEED_FILL;
    nextBuf++;
    if (nextBuf >= _bufferCount)     nextBuf=0;
    asyncBuffers.notify();
  }
}
