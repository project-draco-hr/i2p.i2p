{
  while (true) {
    int toFill=-1;
    try {
synchronized (asyncBuffers) {
        for (int i=0; i < _bufferCount; i++) {
          if (status[i] == STATUS_NEED_FILL) {
            status[i]=STATUS_FILLING;
            toFill=i;
            break;
          }
        }
        if (toFill == -1) {
          asyncBuffers.wait();
        }
      }
    }
 catch (    InterruptedException ie) {
    }
    if (toFill != -1) {
      long before=System.currentTimeMillis();
      doFill(asyncBuffers[toFill]);
      long after=System.currentTimeMillis();
synchronized (asyncBuffers) {
        status[toFill]=STATUS_FILLED;
        asyncBuffers.notifyAll();
      }
      _context.statManager().addRateData("prng.bufferFillTime",after - before,0);
      Thread.yield();
      long waitTime=(after - before) * 5;
      if (waitTime <= 0)       waitTime=50;
      try {
        Thread.sleep(waitTime);
      }
 catch (      InterruptedException ie) {
      }
    }
  }
}
