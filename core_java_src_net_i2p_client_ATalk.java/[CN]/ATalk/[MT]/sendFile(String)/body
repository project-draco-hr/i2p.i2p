{
  _log.debug("Sending file [" + filename + "]");
  ByteArrayOutputStream baos=new ByteArrayOutputStream(4096);
  baos.write((FILE_COMMAND + filename + "\n").getBytes());
  FileInputStream fin=new FileInputStream(filename);
  byte buf[]=new byte[4096];
  try {
    while (true) {
      int len=fin.read(buf);
      if (len == -1)       break;
      baos.write(buf,0,len);
    }
  }
 catch (  IOException ioe) {
    _log.debug("Failed reading the file",ioe);
    return false;
  }
  baos.close();
  byte val[]=baos.toByteArray();
  _log.debug("Sending " + filename + " with a full payload of "+ val.length);
  try {
    boolean rv=_session.sendMessage(_peerDestination,val);
    _log.debug("Sending " + filename + " complete: rv = "+ rv);
    return rv;
  }
 catch (  Throwable t) {
    _log.error("Error sending file",t);
    return false;
  }
}
