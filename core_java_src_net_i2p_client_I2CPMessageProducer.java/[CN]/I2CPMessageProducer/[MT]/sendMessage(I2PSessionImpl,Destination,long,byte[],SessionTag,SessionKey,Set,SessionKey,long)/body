{
  if (!updateBps(payload.length,expires))   return;
  SendMessageMessage msg;
  if (expires > 0) {
    msg=new SendMessageExpiresMessage();
    ((SendMessageExpiresMessage)msg).setExpiration(new Date(expires));
  }
 else   msg=new SendMessageMessage();
  msg.setDestination(dest);
  msg.setSessionId(session.getSessionId());
  msg.setNonce(nonce);
  Payload data=createPayload(dest,payload,tag,key,tags,newKey);
  msg.setPayload(data);
  session.sendMessage(msg);
}
