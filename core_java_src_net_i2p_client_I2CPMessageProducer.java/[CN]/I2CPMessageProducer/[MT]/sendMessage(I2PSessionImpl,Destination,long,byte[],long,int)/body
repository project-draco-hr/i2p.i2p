{
  if (!updateBps(payload.length,expires))   return;
  SendMessageMessage msg;
  if (expires > 0 || flags > 0) {
    SendMessageExpiresMessage smsg=new SendMessageExpiresMessage();
    smsg.setExpiration(expires);
    smsg.setFlags(flags);
    msg=smsg;
  }
 else   msg=new SendMessageMessage();
  msg.setDestination(dest);
  SessionId sid=session.getSessionId();
  if (sid == null) {
    _log.error(session.toString() + " send message w/o session",new Exception());
    return;
  }
  msg.setSessionId(sid);
  msg.setNonce(nonce);
  Payload data=createPayload(dest,payload,null,null,null,null);
  msg.setPayload(data);
  session.sendMessage(msg);
}
