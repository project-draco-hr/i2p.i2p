{
synchronized (_stateLock) {
    if (_state == State.CLOSED)     throw new I2PSessionException("Already closed");
    if (_state == State.INIT)     throw new I2PSessionException("Not open, must call connect() first");
  }
  if (_queue != null) {
    try {
      if (!_queue.offer(message,MAX_SEND_WAIT))       throw new I2PSessionException("Timed out waiting while write queue was full");
    }
 catch (    InterruptedException ie) {
      throw new I2PSessionException("Interrupted",ie);
    }
  }
 else   if (_writer == null) {
    throw new I2PSessionException("Already closed or not open");
  }
 else {
    _writer.addMessage(message);
  }
}
