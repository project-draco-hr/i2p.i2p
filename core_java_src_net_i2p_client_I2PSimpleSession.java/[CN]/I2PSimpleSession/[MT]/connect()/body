{
  _closed=false;
  try {
    if (_context.isRouterContext()) {
      InternalClientManager mgr=_context.internalClientManager();
      if (mgr == null)       throw new I2PSessionException("Router is not ready for connections");
      _queue=mgr.connect();
      _reader=new QueuedI2CPMessageReader(_queue,this);
    }
 else {
      _socket=new Socket(_hostname,_portNum);
      _out=_socket.getOutputStream();
synchronized (_out) {
        _out.write(I2PClient.PROTOCOL_BYTE);
        _out.flush();
      }
      _writer=new ClientWriterRunner(_out,this);
      InputStream in=_socket.getInputStream();
      _reader=new I2CPMessageReader(in,this);
    }
    _reader.startReading();
  }
 catch (  UnknownHostException uhe) {
    _closed=true;
    throw new I2PSessionException(getPrefix() + "Cannot connect to the router on " + _hostname+ ':'+ _portNum,uhe);
  }
catch (  IOException ioe) {
    _closed=true;
    throw new I2PSessionException(getPrefix() + "Cannot connect to the router on " + _hostname+ ':'+ _portNum,ioe);
  }
}
