{
  if (_session.isClosed())   return;
  long now=_context.clock().now();
  long lastActivity=_session.lastActivity();
  if (_log.shouldLog(Log.INFO))   _log.info("Fire idle timer, last activity: " + DataHelper.formatDuration(now - lastActivity) + " ago ");
  if (_shutdownEnabled && now - lastActivity >= _shutdownTime) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Closing on idle " + _session);
    _session.destroySession();
  }
 else   if (_reduceEnabled && now - lastActivity >= _reduceTime) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Reducing quantity on idle " + _session);
    try {
      _session.getProducer().updateTunnels(_session,_reduceQuantity);
    }
 catch (    I2PSessionException ise) {
      _log.error("bork idle reduction " + ise);
    }
    _session.setReduced();
    if (_shutdownEnabled)     SimpleScheduler.getInstance().addEvent(this,_shutdownTime - (now - lastActivity));
  }
 else {
    SimpleScheduler.getInstance().addEvent(this,_minimumTime - (now - lastActivity));
  }
}
