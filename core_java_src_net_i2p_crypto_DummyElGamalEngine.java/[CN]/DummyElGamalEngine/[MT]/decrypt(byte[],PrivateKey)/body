{
  if ((encrypted == null) || (encrypted.length > 514))   throw new IllegalArgumentException("Data to decrypt must be <= 514 bytes at the moment");
  byte val[]=new byte[257];
  System.arraycopy(encrypted,0,val,0,val.length);
  int i=0;
  for (i=0; i < val.length; i++)   if (val[i] != (byte)0x00)   break;
  ByteArrayInputStream bais=new ByteArrayInputStream(val,i,val.length - i);
  Hash hash=new Hash();
  byte rv[]=null;
  try {
    bais.read();
    hash.readBytes(bais);
    rv=new byte[val.length - i - 1- 32];
    bais.read(rv);
  }
 catch (  Exception e) {
    _log.error("Internal error reading value",e);
    return null;
  }
  Hash calcHash=SHA256Generator.getInstance().calculateHash(rv);
  if (calcHash.equals(hash)) {
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Hash matches: " + DataHelper.toString(hash.getData(),hash.getData().length));
    return rv;
  }
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Doesn't match hash [calc=" + calcHash + " sent hash="+ hash+ "]\ndata = "+ new String(rv),new Exception("Doesn't match"));
  return null;
}
