{
  I2PAppContext ctx=new I2PAppContext();
  ElGamalAESEngine e=new ElGamalAESEngine(ctx);
  Object kp[]=ctx.keyGenerator().generatePKIKeypair();
  PublicKey pubKey=(PublicKey)kp[0];
  PrivateKey privKey=(PrivateKey)kp[1];
  SessionKey sessionKey=ctx.keyGenerator().generateSessionKey();
  for (int i=0; i < 10; i++) {
    try {
      Set tags=new HashSet(5);
      if (i == 0) {
        for (int j=0; j < 5; j++)         tags.add(new SessionTag(true));
      }
      byte encrypted[]=e.encrypt("blah".getBytes(),pubKey,sessionKey,tags,1024);
      byte decrypted[]=e.decrypt(encrypted,privKey);
      if ("blah".equals(new String(decrypted))) {
        System.out.println("equal on " + i);
      }
 else {
        System.out.println("NOT equal on " + i + ": "+ new String(decrypted));
        break;
      }
      ctx.sessionKeyManager().tagsDelivered(pubKey,sessionKey,tags);
    }
 catch (    Exception ee) {
      ee.printStackTrace();
      break;
    }
  }
}
