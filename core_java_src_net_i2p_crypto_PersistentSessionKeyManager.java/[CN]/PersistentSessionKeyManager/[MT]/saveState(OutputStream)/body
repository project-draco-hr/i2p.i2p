{
  Set tagSets=getInboundTagSets();
  Set sessions=getOutboundSessions();
  if (_log.shouldLog(Log.INFO))   _log.info("Saving state with " + tagSets.size() + " inbound tagSets and "+ sessions.size()+ " outbound sessions");
  DataHelper.writeLong(out,4,tagSets.size());
  for (Iterator iter=tagSets.iterator(); iter.hasNext(); ) {
    TagSet ts=(TagSet)iter.next();
    writeTagSet(out,ts);
  }
  DataHelper.writeLong(out,4,sessions.size());
  for (Iterator iter=sessions.iterator(); iter.hasNext(); ) {
    OutboundSession sess=(OutboundSession)iter.next();
    writeOutboundSession(out,sess);
  }
}
