{
  byte[] version={2,1,1};
  byte[] issuer=cert.getIssuerX500Principal().getEncoded();
  byte[] serial=cert.getSerialNumber().toByteArray();
  if (serial.length > 255)   throw new IllegalArgumentException();
  long now=System.currentTimeMillis();
  long then=now + (validDays * 24L * 60* 60* 1000);
  byte[] nowbytes=getDate(now);
  byte[] thenbytes=getDate(then);
  byte[] extbytes=getCRLExtensions(crlNum);
  int revlen=2 + serial.length + nowbytes.length;
  int revseqlen=spaceFor(revlen);
  int revsseqlen=spaceFor(revseqlen);
  int len=version.length + sigalg.length + issuer.length+ nowbytes.length+ thenbytes.length+ revsseqlen+ extbytes.length;
  int totlen=spaceFor(len);
  byte[] rv=new byte[totlen];
  int idx=0;
  rv[idx++]=0x30;
  idx=intToASN1(rv,idx,len);
  System.arraycopy(version,0,rv,idx,version.length);
  idx+=version.length;
  System.arraycopy(sigalg,0,rv,idx,sigalg.length);
  idx+=sigalg.length;
  System.arraycopy(issuer,0,rv,idx,issuer.length);
  idx+=issuer.length;
  System.arraycopy(nowbytes,0,rv,idx,nowbytes.length);
  idx+=nowbytes.length;
  System.arraycopy(thenbytes,0,rv,idx,thenbytes.length);
  idx+=thenbytes.length;
  rv[idx++]=0x30;
  idx=intToASN1(rv,idx,revseqlen);
  rv[idx++]=0x30;
  idx=intToASN1(rv,idx,revlen);
  rv[idx++]=0x02;
  rv[idx++]=(byte)serial.length;
  System.arraycopy(serial,0,rv,idx,serial.length);
  idx+=serial.length;
  System.arraycopy(nowbytes,0,rv,idx,nowbytes.length);
  idx+=nowbytes.length;
  System.arraycopy(extbytes,0,rv,idx,extbytes.length);
  if (DEBUG) {
    System.out.println("version");
    System.out.println(HexDump.dump(version));
    System.out.println("sigalg");
    System.out.println(HexDump.dump(sigalg));
    System.out.println("issuer");
    System.out.println(HexDump.dump(issuer));
    System.out.println("now");
    System.out.println(HexDump.dump(nowbytes));
    System.out.println("then");
    System.out.println(HexDump.dump(thenbytes));
    System.out.println("serial");
    System.out.println(HexDump.dump(serial));
    System.out.println("extensions");
    System.out.println(HexDump.dump(extbytes));
    System.out.println("TBS CRL");
    System.out.println(HexDump.dump(rv));
  }
  return rv;
}
