{
  if (_byteified != null)   return _byteified;
  if (_identity == null)   throw new DataFormatException("Router identity isn't set? wtf!");
  if (_addresses == null)   throw new DataFormatException("Router addressess isn't set? wtf!");
  if (_options == null)   throw new DataFormatException("Router options isn't set? wtf!");
  ByteArrayOutputStream out=new ByteArrayOutputStream(6 * 1024);
  try {
    _identity.writeBytes(out);
    DataHelper.writeDate(out,new Date(_published));
    int sz=_addresses.size();
    if (sz <= 0 || isHidden()) {
      DataHelper.writeLong(out,1,0);
    }
 else {
      DataHelper.writeLong(out,1,sz);
      Collection<RouterAddress> addresses=_addresses;
      if (sz > 1)       addresses=(Collection<RouterAddress>)DataHelper.sortStructures(addresses);
      for (      RouterAddress addr : addresses) {
        addr.writeBytes(out);
      }
    }
    int psz=_peers == null ? 0 : _peers.size();
    DataHelper.writeLong(out,1,psz);
    if (psz > 0) {
      Collection<Hash> peers=_peers;
      if (psz > 1)       peers=(Collection<Hash>)DataHelper.sortStructures(peers);
      for (      Hash peerHash : peers) {
        peerHash.writeBytes(out);
      }
    }
    DataHelper.writeProperties(out,_options);
  }
 catch (  IOException ioe) {
    throw new DataFormatException("IO Error getting bytes",ioe);
  }
  byte data[]=out.toByteArray();
  if (CACHE_ALL || _shouldCache)   _byteified=data;
  return data;
}
