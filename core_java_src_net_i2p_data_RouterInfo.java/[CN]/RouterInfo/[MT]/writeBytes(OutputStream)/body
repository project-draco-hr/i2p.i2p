{
  if (_identity == null)   throw new DataFormatException("Missing identity");
  if (_published <= 0)   throw new DataFormatException("Invalid published date: " + _published);
  if (_signature == null)   throw new DataFormatException("Signature is null");
  ByteArrayOutputStream baos=new ByteArrayOutputStream(512);
  _identity.writeBytes(baos);
  DataHelper.writeDate(baos,new Date(_published));
  DataHelper.writeLong(baos,1,_addresses.size());
  for (Iterator iter=_addresses.iterator(); iter.hasNext(); ) {
    RouterAddress addr=(RouterAddress)iter.next();
    addr.writeBytes(baos);
  }
  DataHelper.writeLong(baos,1,_peers.size());
  for (Iterator iter=_peers.iterator(); iter.hasNext(); ) {
    Hash peerHash=(Hash)iter.next();
    peerHash.writeBytes(baos);
  }
  DataHelper.writeProperties(baos,_options);
  _signature.writeBytes(baos);
  byte data[]=baos.toByteArray();
  out.write(data);
}
