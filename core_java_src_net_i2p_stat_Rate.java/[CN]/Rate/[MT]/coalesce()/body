{
synchronized (_lock) {
    long now=now();
    long measuredPeriod=now - _lastCoalesceDate;
    if (measuredPeriod < _period) {
      return;
    }
    double periodFactor=measuredPeriod / _period;
    _lastTotalValue=(_currentTotalValue == 0 ? 0.0D : _currentTotalValue / periodFactor);
    _lastEventCount=(_currentEventCount == 0 ? 0L : (long)(_currentEventCount / periodFactor));
    _lastTotalEventTime=(_currentTotalEventTime == 0 ? 0L : (long)(_currentTotalEventTime / periodFactor));
    _lastCoalesceDate=now;
    if (_lastTotalValue > _extremeTotalValue) {
      _extremeTotalValue=_lastTotalValue;
      _extremeEventCount=_lastEventCount;
      _extremeTotalEventTime=_lastTotalEventTime;
    }
    _currentTotalValue=0.0D;
    _currentEventCount=0;
    _currentTotalEventTime=0;
  }
}
