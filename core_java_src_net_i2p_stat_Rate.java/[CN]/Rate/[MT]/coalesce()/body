{
  long now=now();
synchronized (_lock) {
    long measuredPeriod=now - _lastCoalesceDate;
    if (measuredPeriod < _period - SLACK) {
      return;
    }
    double periodFactor=measuredPeriod / (double)_period;
    _lastTotalValue=_currentTotalValue / periodFactor;
    _lastEventCount=(long)((_currentEventCount + periodFactor - 1) / periodFactor);
    _lastTotalEventTime=(long)(_currentTotalEventTime / periodFactor);
    _lastCoalesceDate=now;
    if (_lastTotalValue > _extremeTotalValue) {
      _extremeTotalValue=_lastTotalValue;
      _extremeEventCount=_lastEventCount;
      _extremeTotalEventTime=_lastTotalEventTime;
    }
    _currentTotalValue=0.0D;
    _currentEventCount=0;
    _currentTotalEventTime=0;
  }
  if (_summaryListener != null)   _summaryListener.add(_lastTotalValue,_lastEventCount,_lastTotalEventTime,_period);
}
