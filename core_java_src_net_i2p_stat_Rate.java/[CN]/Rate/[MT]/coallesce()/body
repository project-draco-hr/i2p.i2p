{
synchronized (_lock) {
    long now=now();
    long measuredPeriod=now - _lastCoallesceDate;
    if (measuredPeriod < _period) {
      return;
    }
 else {
      double periodFactor=measuredPeriod / _period;
      _lastTotalValue=(_currentTotalValue == 0 ? 0.0d : _currentTotalValue / periodFactor);
      _lastEventCount=(_currentEventCount == 0 ? 0l : (long)(_currentEventCount / periodFactor));
      _lastTotalEventTime=(_currentTotalEventTime == 0 ? 0l : (long)(_currentTotalEventTime / periodFactor));
      _lastCoallesceDate=now;
      if (_lastTotalValue > _extremeTotalValue) {
        _extremeTotalValue=_lastTotalValue;
        _extremeEventCount=_lastEventCount;
        _extremeTotalEventTime=_lastTotalEventTime;
      }
      _currentTotalValue=0.0d;
      _currentEventCount=0;
      _currentTotalEventTime=0;
    }
  }
}
