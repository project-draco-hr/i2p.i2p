{
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException ie) {
  }
  _log=_context.logManager().getLog(Timestamper.class);
  if (_log.shouldLog(Log.INFO))   _log.info("Starting timestamper");
  boolean lastFailed=false;
  try {
    while (true) {
      updateConfig();
      if (!_disabled) {
        if (_priorityServers != null) {
          if (_log.shouldLog(Log.DEBUG))           _log.debug("Querying servers " + _priorityServers);
          try {
            lastFailed=!queryTime(_priorityServers.toArray(new String[_priorityServers.size()]));
          }
 catch (          IllegalArgumentException iae) {
            if ((!lastFailed) && (_log.shouldLog(Log.WARN)))             _log.warn("Unable to reach country-specific NTP servers");
            lastFailed=true;
          }
        }
        if (_priorityServers == null || lastFailed) {
          if (_log.shouldLog(Log.DEBUG))           _log.debug("Querying servers " + _servers);
          try {
            lastFailed=!queryTime(_servers.toArray(new String[_servers.size()]));
          }
 catch (          IllegalArgumentException iae) {
            if ((!lastFailed) && (_log.shouldLog(Log.ERROR)))             _log.error("Unable to reach any of the NTP servers - network disconnected?");
            lastFailed=true;
          }
        }
      }
      _initialized=true;
synchronized (this) {
        notifyAll();
      }
      long sleepTime;
      if (lastFailed) {
        sleepTime=30 * 1000;
      }
 else {
        sleepTime=_context.random().nextInt(_queryFrequency) + _queryFrequency;
        if (_wellSynced)         sleepTime*=3;
      }
      try {
        Thread.sleep(sleepTime);
      }
 catch (      InterruptedException ie) {
      }
    }
  }
 catch (  Throwable t) {
    _log.log(Log.CRIT,"Timestamper died!",t);
synchronized (this) {
      notifyAll();
    }
  }
}
