{
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException ie) {
  }
  _log=_context.logManager().getLog(Timestamper.class);
  if (_log.shouldLog(Log.INFO))   _log.info("Starting timestamper");
  if (_log.shouldLog(Log.INFO))   _log.info("Starting up timestamper");
  boolean lastFailed=false;
  try {
    while (true) {
      updateConfig();
      if (!_disabled) {
        String serverList[]=null;
synchronized (_servers) {
          serverList=new String[_servers.size()];
          for (int i=0; i < serverList.length; i++)           serverList[i]=(String)_servers.get(i);
        }
        if (_log.shouldLog(Log.DEBUG))         _log.debug("Querying servers " + _servers);
        try {
          lastFailed=!queryTime(serverList);
        }
 catch (        IllegalArgumentException iae) {
          if (!lastFailed)           _log.log(Log.CRIT,"Unable to reach any of the NTP servers - network disconnected?");
          lastFailed=true;
        }
      }
      _initialized=true;
synchronized (this) {
        notifyAll();
      }
      long sleepTime=_context.random().nextInt(_queryFrequency) + _queryFrequency;
      if (lastFailed)       sleepTime=30 * 1000;
      try {
        Thread.sleep(sleepTime);
      }
 catch (      InterruptedException ie) {
      }
    }
  }
 catch (  Throwable t) {
    _log.log(Log.CRIT,"Timestamper died!",t);
synchronized (this) {
      notifyAll();
    }
  }
}
