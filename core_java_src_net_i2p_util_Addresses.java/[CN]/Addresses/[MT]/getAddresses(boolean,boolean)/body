{
  SortedSet<String> rv=new TreeSet();
  try {
    InetAddress localhost=InetAddress.getLocalHost();
    InetAddress[] allMyIps=InetAddress.getAllByName(localhost.getCanonicalHostName());
    if (allMyIps != null) {
      for (int i=0; i < allMyIps.length; i++) {
        if (shouldInclude(allMyIps[i],includeLocal,includeIPv6))         rv.add(allMyIps[i].getHostAddress());
      }
    }
  }
 catch (  UnknownHostException e) {
  }
  try {
    for (Enumeration<NetworkInterface> ifcs=NetworkInterface.getNetworkInterfaces(); ifcs.hasMoreElements(); ) {
      NetworkInterface ifc=ifcs.nextElement();
      for (Enumeration<InetAddress> addrs=ifc.getInetAddresses(); addrs.hasMoreElements(); ) {
        InetAddress addr=addrs.nextElement();
        if (shouldInclude(addr,includeLocal,includeIPv6))         rv.add(addr.getHostAddress());
      }
    }
  }
 catch (  SocketException e) {
  }
  if (includeLocal)   rv.add("0.0.0.0");
  if (includeLocal && includeIPv6) {
    boolean ipv6=false;
    for (    String a : rv) {
      if (a.indexOf(':') >= 0) {
        ipv6=true;
        break;
      }
    }
    if (ipv6)     rv.add("0:0:0:0:0:0:0:0");
  }
  return rv;
}
