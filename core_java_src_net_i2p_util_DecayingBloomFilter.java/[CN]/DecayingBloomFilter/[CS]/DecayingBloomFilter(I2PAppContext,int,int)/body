{
  _context=context;
  _log=context.logManager().getLog(DecayingBloomFilter.class);
  _entryBytes=entryBytes;
  int m=context.getProperty("router.decayingBloomFilterM",DEFAULT_M);
  _current=new BloomSHA1(m,11);
  _previous=new BloomSHA1(m,11);
  _durationMs=durationMs;
  int numExtenders=(32 + (entryBytes - 1)) / entryBytes - 1;
  if (numExtenders < 0)   numExtenders=0;
  _extenders=new byte[numExtenders][entryBytes];
  for (int i=0; i < numExtenders; i++)   _context.random().nextBytes(_extenders[i]);
  if (numExtenders > 0) {
    _extended=new byte[32];
    _longToEntry=new byte[_entryBytes];
    _longToEntryMask=(1l << (_entryBytes * 8l)) - 1;
  }
  _currentDuplicates=0;
  _decayEvent=new DecayEvent();
  _keepDecaying=true;
  SimpleTimer.getInstance().addEvent(_decayEvent,_durationMs);
}
