{
  File outFile=new File(_outputFile);
  if (outFile.exists())   _alreadyTransferred=outFile.length();
  String req=getRequest();
  if (_shouldProxy) {
    _proxy=new Socket(_proxyHost,_proxyPort);
  }
 else {
    try {
      URL url=new URL(_url);
      String host=url.getHost();
      int port=url.getPort();
      if (port == -1)       port=80;
      _proxy=new Socket(host,port);
    }
 catch (    MalformedURLException mue) {
      throw new IOException("Request URL is invalid");
    }
  }
  _proxyIn=_proxy.getInputStream();
  _proxyOut=_proxy.getOutputStream();
  _proxyOut.write(req.toString().getBytes());
  _proxyOut.flush();
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Request flushed");
}
