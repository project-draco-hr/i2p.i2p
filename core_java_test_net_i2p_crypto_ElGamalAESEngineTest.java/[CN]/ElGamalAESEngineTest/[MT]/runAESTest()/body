{
  try {
    SessionKey sessionKey=KeyGenerator.getInstance().generateSessionKey();
    Hash h=SHA256Generator.getInstance().calculateHash(sessionKey.getData());
    byte iv[]=new byte[16];
    System.arraycopy(h.getData(),0,iv,0,16);
    String msg="Hello world";
    byte encrypted[]=ElGamalAESEngine.encryptAESBlock(msg.getBytes(),sessionKey,iv,null,null,64);
    _log.debug("** Encryption complete.  Beginning decryption");
    Set foundTags=new HashSet();
    SessionKey foundKey=new SessionKey();
    byte decrypted[]=ElGamalAESEngine.decryptAESBlock(encrypted,sessionKey,iv,null,foundTags,foundKey);
    if (decrypted == null)     throw new Exception("Decryption failed");
    String read=new String(decrypted);
    _log.debug("read: " + read);
    _log.debug("Match? " + msg.equals(read));
  }
 catch (  Exception e) {
    _log.error("Error",e);
    try {
      Thread.sleep(5000);
    }
 catch (    InterruptedException ie) {
    }
    System.exit(0);
  }
}
