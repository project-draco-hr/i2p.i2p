{
  if (type != MESSAGE_TYPE)   throw new I2NPMessageException("Message type is incorrect for this message");
  int curIndex=offset;
  byte keyData[]=new byte[Hash.HASH_LENGTH];
  System.arraycopy(data,curIndex,keyData,0,Hash.HASH_LENGTH);
  curIndex+=Hash.HASH_LENGTH;
  _key=new Hash(keyData);
  byte fromData[]=new byte[Hash.HASH_LENGTH];
  System.arraycopy(data,curIndex,fromData,0,Hash.HASH_LENGTH);
  curIndex+=Hash.HASH_LENGTH;
  _fromHash=new Hash(fromData);
  boolean tunnelSpecified=false;
switch (data[curIndex]) {
case DataHelper.BOOLEAN_TRUE:
    tunnelSpecified=true;
  break;
case DataHelper.BOOLEAN_FALSE:
tunnelSpecified=false;
break;
default :
throw new I2NPMessageException("Tunnel must be explicitly specified (or not)");
}
curIndex++;
if (tunnelSpecified) {
_replyTunnel=new TunnelId(DataHelper.fromLong(data,curIndex,4));
curIndex+=4;
}
int numPeers=(int)DataHelper.fromLong(data,curIndex,2);
curIndex+=2;
if ((numPeers < 0) || (numPeers > MAX_NUM_PEERS)) throw new I2NPMessageException("Invalid number of peers - " + numPeers);
Set<Hash> peers=new HashSet(numPeers);
for (int i=0; i < numPeers; i++) {
byte peer[]=new byte[Hash.HASH_LENGTH];
System.arraycopy(data,curIndex,peer,0,Hash.HASH_LENGTH);
curIndex+=Hash.HASH_LENGTH;
peers.add(new Hash(peer));
}
_dontIncludePeers=peers;
}
