{
  if (_key == null)   throw new I2NPMessageException("Key being searched for not specified");
  if (_fromHash == null)   throw new I2NPMessageException("From address not specified");
  System.arraycopy(_key.getData(),0,out,curIndex,Hash.HASH_LENGTH);
  curIndex+=Hash.HASH_LENGTH;
  System.arraycopy(_fromHash.getData(),0,out,curIndex,Hash.HASH_LENGTH);
  curIndex+=Hash.HASH_LENGTH;
  if (_replyTunnel != null) {
    out[curIndex++]=0x01;
    byte id[]=DataHelper.toLong(4,_replyTunnel.getTunnelId());
    System.arraycopy(id,0,out,curIndex,4);
    curIndex+=4;
  }
 else {
    out[curIndex++]=0x00;
  }
  if ((_dontIncludePeers == null) || (_dontIncludePeers.isEmpty())) {
    out[curIndex++]=0x0;
    out[curIndex++]=0x0;
  }
 else {
    int size=_dontIncludePeers.size();
    if (size > MAX_NUM_PEERS)     throw new I2NPMessageException("Too many peers: " + size);
    byte len[]=DataHelper.toLong(2,size);
    out[curIndex++]=len[0];
    out[curIndex++]=len[1];
    for (    Hash peer : _dontIncludePeers) {
      System.arraycopy(peer.getData(),0,out,curIndex,Hash.HASH_LENGTH);
      curIndex+=Hash.HASH_LENGTH;
    }
  }
  return curIndex;
}
