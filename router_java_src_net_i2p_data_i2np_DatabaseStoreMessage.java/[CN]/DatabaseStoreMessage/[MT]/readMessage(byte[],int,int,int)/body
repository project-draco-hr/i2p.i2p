{
  if (type != MESSAGE_TYPE)   throw new I2NPMessageException("Message type is incorrect for this message");
  int curIndex=offset;
  _key=Hash.create(data,curIndex);
  curIndex+=Hash.HASH_LENGTH;
  type=(int)DataHelper.fromLong(data,curIndex,1);
  curIndex++;
  _replyToken=DataHelper.fromLong(data,curIndex,4);
  curIndex+=4;
  if (_replyToken > 0) {
    long tunnel=DataHelper.fromLong(data,curIndex,4);
    if (tunnel > 0)     _replyTunnel=new TunnelId(tunnel);
    curIndex+=4;
    _replyGateway=Hash.create(data,curIndex);
    curIndex+=Hash.HASH_LENGTH;
  }
 else {
    _replyTunnel=null;
    _replyGateway=null;
  }
  if (type == DatabaseEntry.KEY_TYPE_LEASESET) {
    _dbEntry=new LeaseSet();
    try {
      _dbEntry.readBytes(new ByteArrayInputStream(data,curIndex,data.length - curIndex));
    }
 catch (    DataFormatException dfe) {
      throw new I2NPMessageException("Error reading the leaseSet",dfe);
    }
catch (    IOException ioe) {
      throw new I2NPMessageException("Error reading the leaseSet",ioe);
    }
  }
 else   if (type == DatabaseEntry.KEY_TYPE_ROUTERINFO) {
    _dbEntry=new RouterInfo();
    int compressedSize=(int)DataHelper.fromLong(data,curIndex,2);
    curIndex+=2;
    if (compressedSize <= 0 || curIndex + compressedSize > data.length || curIndex + compressedSize > dataSize + offset)     throw new I2NPMessageException("Compressed RI length: " + compressedSize + " but remaining bytes: "+ Math.min(data.length - curIndex,dataSize + offset - curIndex));
    try {
      byte decompressed[]=DataHelper.decompress(data,curIndex,compressedSize);
      _dbEntry.readBytes(new ByteArrayInputStream(decompressed));
    }
 catch (    DataFormatException dfe) {
      throw new I2NPMessageException("Error reading the routerInfo",dfe);
    }
catch (    IOException ioe) {
      throw new I2NPMessageException("Corrupt compressed routerInfo size = " + compressedSize,ioe);
    }
  }
 else {
    throw new I2NPMessageException("Invalid type of key read from the structure - " + type);
  }
}
