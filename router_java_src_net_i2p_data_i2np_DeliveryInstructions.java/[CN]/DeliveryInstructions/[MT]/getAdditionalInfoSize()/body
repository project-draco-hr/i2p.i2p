{
  int additionalSize=0;
  if (getEncrypted()) {
    if (_encryptionKey == null)     throw new IllegalStateException("Encryption key is not set");
    additionalSize+=SessionKey.KEYSIZE_BYTES;
  }
switch (getDeliveryMode()) {
case FLAG_MODE_LOCAL:
    if (_log.shouldLog(Log.DEBUG))     _log.debug("mode = local");
  break;
case FLAG_MODE_DESTINATION:
if (_destinationHash == null) throw new IllegalStateException("Destination hash is not set");
additionalSize+=Hash.HASH_LENGTH;
break;
case FLAG_MODE_ROUTER:
if (_routerHash == null) throw new IllegalStateException("Router hash is not set");
additionalSize+=Hash.HASH_LENGTH;
break;
case FLAG_MODE_TUNNEL:
if ((_routerHash == null) || (_tunnelId == null)) throw new IllegalStateException("Router hash or tunnel ID is not set");
additionalSize+=Hash.HASH_LENGTH;
additionalSize+=4;
break;
}
if (getDelayRequested()) {
additionalSize+=4;
}
return additionalSize;
}
