{
  if ((_deliveryMode < 0) || (_deliveryMode > FLAG_MODE_TUNNEL))   throw new DataFormatException("Invalid data: mode = " + _deliveryMode);
  long flags=getFlags();
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Write flags: " + flags + " mode: "+ getDeliveryMode()+ " =?= "+ flagMode(flags));
  byte additionalInfo[]=getAdditionalInfo();
  DataHelper.writeLong(out,1,flags);
  if (additionalInfo != null) {
    out.write(additionalInfo);
    out.flush();
  }
}
