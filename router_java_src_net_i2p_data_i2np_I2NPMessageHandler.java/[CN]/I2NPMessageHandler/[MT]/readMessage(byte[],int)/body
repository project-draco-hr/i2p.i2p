{
  int cur=offset;
  int type=(int)DataHelper.fromLong(data,cur,1);
  cur++;
  _lastReadBegin=System.currentTimeMillis();
  I2NPMessage msg=I2NPMessageImpl.createMessage(_context,type);
  if (msg == null) {
    int sz=data.length - offset;
    boolean allZero=false;
    for (int i=offset; i < data.length; i++) {
      if (data[i] != 0) {
        allZero=false;
        break;
      }
    }
    throw new I2NPMessageException("The type " + type + " is an unknown I2NP message (remaining sz="+ sz+ " all zeros? "+ allZero+ ")");
  }
  try {
    _lastSize=msg.readBytes(data,type,cur);
    cur+=_lastSize;
  }
 catch (  IOException ioe) {
    throw ioe;
  }
catch (  I2NPMessageException ime) {
    throw ime;
  }
catch (  Exception e) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Error reading the stream",e);
    throw new IOException("Unknown error reading the " + msg.getClass().getName() + ": "+ e.getMessage());
  }
  _lastReadEnd=System.currentTimeMillis();
  _lastRead=msg;
  return cur - offset;
}
