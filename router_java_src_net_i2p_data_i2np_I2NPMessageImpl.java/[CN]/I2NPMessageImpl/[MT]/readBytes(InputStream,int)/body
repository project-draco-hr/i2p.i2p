{
  try {
    long start=_context.clock().now();
    if (type < 0)     type=(int)DataHelper.readLong(in,1);
    _uniqueId=DataHelper.readLong(in,4);
    _expiration=DataHelper.readDate(in);
    int size=(int)DataHelper.readLong(in,2);
    Hash h=new Hash();
    h.readBytes(in);
    byte data[]=new byte[size];
    int read=DataHelper.read(in,data);
    if (read != size)     throw new I2NPMessageException("Payload is too short [" + read + ", wanted "+ size+ "]");
    Hash calc=_context.sha().calculateHash(data);
    if (!calc.equals(h))     throw new I2NPMessageException("Hash does not match");
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Reading bytes: type = " + type + " / uniqueId : "+ _uniqueId+ " / expiration : "+ _expiration);
    readMessage(new ByteArrayInputStream(data),type);
    long time=_context.clock().now() - start;
    if (time > 50)     _context.statManager().addRateData("i2np.readTime",time,time);
  }
 catch (  DataFormatException dfe) {
    throw new I2NPMessageException("Error reading the message header",dfe);
  }
}
