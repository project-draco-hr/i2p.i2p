{
  String file=_context.getProperty(PROP_BLOCKLIST_FILE,BLOCKLIST_FILE_DEFAULT);
  File BLFile=new File(file);
  if (!BLFile.isAbsolute())   BLFile=new File(_context.getConfigDir(),file);
  if (BLFile == null || (!BLFile.exists()) || BLFile.length() <= 0) {
    if (_log.shouldLog(Log.ERROR))     _log.error("Blocklist file not found: " + file);
    return;
  }
  List ips=getAddresses(peer);
  for (Iterator iter=ips.iterator(); iter.hasNext(); ) {
    byte ip[]=(byte[])iter.next();
    int ipint=toInt(ip);
    FileInputStream in=null;
    try {
      in=new FileInputStream(BLFile);
      StringBuilder buf=new StringBuilder(128);
      while (DataHelper.readLine(in,buf)) {
        Entry e=parse(buf,false);
        if (e == null || e.peer != null) {
          buf.setLength(0);
          continue;
        }
        if (match(ipint,toEntry(e.ip1,e.ip2))) {
          try {
            in.close();
          }
 catch (          IOException ioe) {
          }
          String reason="IP ";
          for (int i=0; i < 4; i++) {
            reason=reason + (ip[i] & 0xff);
            if (i != 3)             reason=reason + '.';
          }
          reason=reason + " banned by " + BLOCKLIST_FILE_DEFAULT+ " entry \""+ buf+ "\"";
          if (_log.shouldLog(Log.WARN))           _log.warn("Shitlisting " + peer + " "+ reason);
          _context.shitlist().shitlistRouterForever(peer,reason);
          return;
        }
        buf.setLength(0);
      }
    }
 catch (    IOException ioe) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Error reading the BLFile",ioe);
    }
 finally {
      if (in != null)       try {
        in.close();
      }
 catch (      IOException ioe) {
      }
    }
  }
}
