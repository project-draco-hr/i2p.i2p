{
  TunnelInfo inbound=null;
  TunnelInfo outbound=null;
  if (tunnel.getTunnel().isInbound()) {
    inbound=_context.tunnelManager().getTunnelInfo(tunnel.getReceiveTunnelId(0));
    if ((inbound == null) && (_log.shouldLog(Log.WARN)))     _log.warn("where are we?  inbound tunnel isn't known: " + tunnel,new Exception("source"));
    if (tunnel.getTunnel().getDestination() != null)     outbound=_context.tunnelManager().selectOutboundTunnel(tunnel.getTunnel().getDestination());
 else     outbound=_context.tunnelManager().selectOutboundTunnel();
  }
 else {
    outbound=_context.tunnelManager().getTunnelInfo(tunnel.getSendTunnelId(0));
    if ((outbound == null) && (_log.shouldLog(Log.WARN)))     _log.warn("where are we?  outbound tunnel isn't known: " + tunnel,new Exception("source"));
    if (tunnel.getTunnel().getDestination() != null)     inbound=_context.tunnelManager().selectInboundTunnel(tunnel.getTunnel().getDestination());
 else     inbound=_context.tunnelManager().selectInboundTunnel();
  }
  tunnel.setInbound(inbound);
  tunnel.setOutbound(outbound);
}
