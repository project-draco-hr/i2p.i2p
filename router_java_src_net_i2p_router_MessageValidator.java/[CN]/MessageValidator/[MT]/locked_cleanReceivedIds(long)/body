{
  Set toRemoveIds=null;
  Set toRemoveDates=null;
  for (Iterator iter=_receivedIdExpirations.keySet().iterator(); iter.hasNext(); ) {
    Long date=(Long)iter.next();
    if (date.longValue() <= now) {
      if (toRemoveIds == null) {
        toRemoveIds=new HashSet(2);
        toRemoveDates=new HashSet(2);
      }
      toRemoveDates.add(date);
      toRemoveIds.add(_receivedIdExpirations.get(date));
    }
 else {
      break;
    }
  }
  if (toRemoveIds != null) {
    for (Iterator iter=toRemoveDates.iterator(); iter.hasNext(); )     _receivedIdExpirations.remove(iter.next());
    for (Iterator iter=toRemoveIds.iterator(); iter.hasNext(); )     _receivedIds.remove(iter.next());
    if (_log.shouldLog(Log.INFO))     _log.info("Cleaned out " + toRemoveDates.size() + " expired messageIds, leaving "+ _receivedIds.size()+ " remaining");
  }
}
