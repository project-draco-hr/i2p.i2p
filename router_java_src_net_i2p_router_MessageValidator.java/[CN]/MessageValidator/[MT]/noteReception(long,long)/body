{
  Long id=new Long(messageId);
synchronized (_receivedIdLock) {
    locked_cleanReceivedIds(Clock.getInstance().now() - Router.CLOCK_FUDGE_FACTOR);
    if (_receivedIds.contains(id)) {
      return true;
    }
 else {
      long date=messageExpiration;
      while (_receivedIdExpirations.containsKey(new Long(date)))       date++;
      _receivedIdExpirations.put(new Long(date),id);
      _receivedIds.add(id);
      return false;
    }
  }
}
