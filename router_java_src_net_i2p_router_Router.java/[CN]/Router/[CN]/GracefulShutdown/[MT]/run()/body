{
  while (true) {
    boolean shutdown=(null != _config.get(PROP_SHUTDOWN_IN_PROGRESS));
    if (shutdown) {
      if (_gracefulExitCode == EXIT_HARD || _gracefulExitCode == EXIT_HARD_RESTART || _context.tunnelManager().getParticipatingCount() <= 0) {
        if (_gracefulExitCode == EXIT_HARD)         _log.log(Log.CRIT,"Shutting down after a brief delay");
 else         if (_gracefulExitCode == EXIT_HARD_RESTART)         _log.log(Log.CRIT,"Restarting after a brief delay");
 else         _log.log(Log.CRIT,"Graceful shutdown progress - no more tunnels, safe to die");
        try {
synchronized (Thread.currentThread()) {
            Thread.currentThread().wait(2 * 1000);
          }
        }
 catch (        InterruptedException ie) {
        }
        shutdown(_gracefulExitCode);
        return;
      }
 else {
        try {
synchronized (Thread.currentThread()) {
            Thread.currentThread().wait(10 * 1000);
          }
        }
 catch (        InterruptedException ie) {
        }
      }
    }
 else {
      try {
synchronized (Thread.currentThread()) {
          Thread.currentThread().wait();
        }
      }
 catch (      InterruptedException ie) {
      }
    }
  }
}
