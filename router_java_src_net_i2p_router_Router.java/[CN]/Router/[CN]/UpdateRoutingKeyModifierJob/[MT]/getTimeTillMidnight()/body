{
  long now=getContext().clock().now();
  _cal.setTime(new Date(now));
  _cal.set(Calendar.YEAR,_cal.get(Calendar.YEAR));
  _cal.set(Calendar.DAY_OF_YEAR,_cal.get(Calendar.DAY_OF_YEAR));
  _cal.add(Calendar.DATE,1);
  _cal.set(Calendar.HOUR_OF_DAY,0);
  _cal.set(Calendar.MINUTE,0);
  _cal.set(Calendar.SECOND,0);
  _cal.set(Calendar.MILLISECOND,0);
  long then=_cal.getTime().getTime();
  long howLong=then - now;
  if (howLong < 0)   howLong=24 * 60 * 60* 1000l + howLong;
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Time till midnight: " + howLong + "ms");
  return howLong;
}
