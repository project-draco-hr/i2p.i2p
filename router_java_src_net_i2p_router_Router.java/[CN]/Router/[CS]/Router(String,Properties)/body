{
  _config=new Properties();
  _context=new RouterContext(this,envProps);
  if (configFilename == null)   _configFilename=_context.getProperty(PROP_CONFIG_FILE,"router.config");
 else   _configFilename=configFilename;
  _routerInfo=null;
  _higherVersionSeen=false;
  _log=_context.logManager().getLog(Router.class);
  _log.info("New router created with config file " + _configFilename);
  _sessionKeyPersistenceHelper=new SessionKeyPersistenceHelper(_context);
  _killVMOnEnd=true;
  _oomListener=new I2PThread.OOMEventListener(){
    public void outOfMemory(    OutOfMemoryError oom){
      _log.log(Log.CRIT,"Thread ran out of memory",oom);
      for (int i=0; i < 5; i++) {
        try {
          _log.log(Log.CRIT,"free mem: " + Runtime.getRuntime().freeMemory() + " total mem: "+ Runtime.getRuntime().totalMemory());
          break;
        }
 catch (        OutOfMemoryError oome) {
        }
      }
      shutdown();
    }
  }
;
  _shutdownHook=new ShutdownHook();
}
