{
  if (_log.shouldLog(Log.INFO))   _log.info("Rebuilding new routerInfo");
  RouterInfo ri=null;
  if (_routerInfo != null)   ri=new RouterInfo(_routerInfo);
 else   ri=new RouterInfo();
  try {
    ri.setPublished(_context.clock().now());
    Properties stats=_context.statPublisher().publishStatistics();
    stats.setProperty(RouterInfo.PROP_NETWORK_ID,NETWORK_ID + "");
    ri.setOptions(stats);
    ri.setAddresses(_context.commSystem().createAddresses());
    if (FloodfillNetworkDatabaseFacade.floodfillEnabled(_context))     ri.addCapability(FloodfillNetworkDatabaseFacade.CAPACITY_FLOODFILL);
    SigningPrivateKey key=_context.keyManager().getSigningPrivateKey();
    if (key == null) {
      _log.log(Log.CRIT,"Internal error - signing private key not known?  wtf");
      return;
    }
    ri.sign(key);
    setRouterInfo(ri);
    try {
      _context.netDb().publish(ri);
    }
 catch (    IllegalArgumentException iae) {
      _log.log(Log.CRIT,"Local router info is invalid?  rebuilding a new identity",iae);
      rebuildNewIdentity();
    }
  }
 catch (  DataFormatException dfe) {
    _log.log(Log.CRIT,"Internal error - unable to sign our own address?!",dfe);
  }
}
