{
  FileOutputStream fos=null;
  try {
    fos=new FileOutputStream(_configFilename);
    StringBuilder buf=new StringBuilder(8 * 1024);
    buf.append("# NOTE: This I2P config file must use UTF-8 encoding\n");
synchronized (_config) {
      TreeSet ordered=new TreeSet(_config.keySet());
      for (Iterator iter=ordered.iterator(); iter.hasNext(); ) {
        String key=(String)iter.next();
        String val=_config.getProperty(key);
        val=val.replaceAll("\\r","\\\\r");
        val=val.replaceAll("\\n","\\\\n");
        buf.append(key).append('=').append(val).append('\n');
      }
    }
    fos.write(buf.toString().getBytes("UTF-8"));
  }
 catch (  IOException ioe) {
    if (_log.shouldLog(Log.ERROR))     _log.error("Error saving the config to " + _configFilename,ioe);
    return false;
  }
 finally {
    if (fos != null)     try {
      fos.close();
    }
 catch (    IOException ioe) {
    }
  }
  return true;
}
