{
synchronized (_configFileLock) {
    FileOutputStream fos=null;
    try {
      fos=new SecureFileOutputStream(_configFilename);
      StringBuilder buf=new StringBuilder(8 * 1024);
      buf.append("# NOTE: This I2P config file must use UTF-8 encoding\n");
      TreeSet ordered=new TreeSet(_config.keySet());
      for (Iterator iter=ordered.iterator(); iter.hasNext(); ) {
        String key=(String)iter.next();
        String val=_config.get(key);
        buf.append(key).append('=').append(val).append('\n');
      }
      fos.write(buf.toString().getBytes("UTF-8"));
    }
 catch (    IOException ioe) {
      if (_log != null)       _log.error("Error saving the config to " + _configFilename,ioe);
 else       System.err.println("Error saving the config to " + _configFilename + ": "+ ioe);
      return false;
    }
 finally {
      if (fos != null)       try {
        fos.close();
      }
 catch (      IOException ioe) {
      }
    }
    return true;
  }
}
