{
  if (peer == null)   return;
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Calling unshitlistRouter " + peer.toBase64() + (transport != null ? "/" + transport : ""));
  boolean fully=false;
  Entry e;
synchronized (_entries) {
    e=(Entry)_entries.remove(peer);
    if ((e == null) || (e.transports == null) || (transport == null)|| (e.transports.size() <= 1)) {
      fully=true;
    }
 else {
      e.transports.remove(transport);
      if (e.transports.size() <= 0)       fully=true;
 else       _entries.put(peer,e);
    }
  }
  if (fully) {
    if (realUnshitlist) {
      PeerProfile prof=_context.profileOrganizer().getProfile(peer);
      if (prof != null)       prof.unshitlist();
    }
    _context.messageHistory().unshitlist(peer);
    if (_log.shouldLog(Log.INFO) && e != null)     _log.info("Unshitlisting router " + peer.toBase64() + (transport != null ? "/" + transport : ""));
  }
}
