{
  while (!_dead) {
    I2CPMessage msg=null;
    long beforeCheckSync=_context.clock().now();
    long inCheckSync=0;
synchronized (_messagesToWrite) {
      inCheckSync=_context.clock().now();
      if (_messagesToWrite.size() > 0) {
        msg=(I2CPMessage)_messagesToWrite.remove(0);
      }
 else {
        try {
          _messagesToWrite.wait();
        }
 catch (        InterruptedException ie) {
          if (_messagesToWrite.size() > 0)           msg=(I2CPMessage)_messagesToWrite.remove(0);
        }
      }
    }
    long afterCheckSync=_context.clock().now();
    if (msg != null) {
      writeMessage(msg);
      long afterWriteMessage=_context.clock().now();
      if (_log.shouldLog(Log.DEBUG))       _log.debug("writeMessage: check sync took " + (inCheckSync - beforeCheckSync) + "ms, writemessage took "+ (afterWriteMessage - afterCheckSync)+ "ms,  time since addMessage(): "+ +(afterCheckSync - _lastAdded));
    }
  }
}
