{
  Payload payload=message.getPayload();
  Destination dest=message.getDestination();
  MessageId id=new MessageId();
  id.setMessageId(getNextMessageId());
  long expiration=0;
  int flags=0;
  if (message.getType() == SendMessageExpiresMessage.MESSAGE_TYPE) {
    SendMessageExpiresMessage msg=(SendMessageExpiresMessage)message;
    expiration=msg.getExpirationTime();
    flags=msg.getFlags();
  }
  if (message.getNonce() != 0 && !_dontSendMSM)   _acceptedPending.add(id);
  if (_log.shouldLog(Log.DEBUG))   _log.debug("** Receiving message " + id.getMessageId() + " with payload of size "+ payload.getSize()+ " for session "+ _sessionId.getSessionId());
  SessionConfig cfg=_config;
  if (cfg != null)   _manager.distributeMessage(cfg.getDestination(),dest,payload,id,expiration,flags);
  return id;
}
