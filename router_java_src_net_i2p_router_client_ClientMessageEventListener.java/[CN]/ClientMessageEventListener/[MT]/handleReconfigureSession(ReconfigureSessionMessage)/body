{
  SessionId id=message.getSessionId();
  SessionConfig config=_runner.getConfig(id);
  if (config == null) {
    _log.error("Unknown session");
    sendStatusMessage(id,SessionStatusMessage.STATUS_INVALID);
    return;
  }
  if (_log.shouldLog(Log.INFO))   _log.info("Updating options - old: " + _runner.getConfig(id) + " new: "+ message.getSessionConfig());
  if (!message.getSessionConfig().getDestination().equals(config.getDestination())) {
    _log.error("Dest mismatch");
    sendStatusMessage(id,SessionStatusMessage.STATUS_INVALID);
    _runner.stopRunning();
    return;
  }
  Hash dest=config.getDestination().calculateHash();
  config.getOptions().putAll(message.getSessionConfig().getOptions());
  ClientTunnelSettings settings=new ClientTunnelSettings(dest);
  Properties props=new Properties();
  props.putAll(config.getOptions());
  settings.readFromProperties(props);
  _context.tunnelManager().setInboundSettings(dest,settings.getInboundSettings());
  _context.tunnelManager().setOutboundSettings(dest,settings.getOutboundSettings());
  sendStatusMessage(id,SessionStatusMessage.STATUS_UPDATED);
}
