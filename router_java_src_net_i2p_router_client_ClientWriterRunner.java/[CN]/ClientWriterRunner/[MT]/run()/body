{
  while (!_runner.getIsDead()) {
    List messages=null;
    List messageTimes=null;
synchronized (_dataLock) {
      if (_messagesToWrite.size() > 0) {
        messages=new ArrayList(_messagesToWrite.size());
        messageTimes=new ArrayList(_messagesToWriteTimes.size());
        messages.addAll(_messagesToWrite);
        messageTimes.addAll(_messagesToWriteTimes);
        _messagesToWrite.clear();
        _messagesToWriteTimes.clear();
      }
    }
    if (messages == null) {
      try {
synchronized (_activityLock) {
          _activityLock.wait();
        }
      }
 catch (      InterruptedException ie) {
        if (_log.shouldLog(Log.WARN))         _log.warn("Interrupted while waiting for activity",ie);
      }
    }
 else {
      for (int i=0; i < messages.size(); i++) {
        I2CPMessage msg=(I2CPMessage)messages.get(i);
        Long when=(Long)messageTimes.get(i);
        _runner.writeMessage(msg);
        if (_log.shouldLog(Log.DEBUG))         _log.debug("[" + _id + "] writeMessage time since addMessage(): "+ (_context.clock().now() - when.longValue())+ " for "+ msg.getClass().getName());
      }
    }
  }
}
