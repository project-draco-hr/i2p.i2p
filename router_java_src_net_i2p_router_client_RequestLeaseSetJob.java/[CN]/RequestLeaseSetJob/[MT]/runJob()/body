{
  if (_runner.isDead())   return;
  RequestLeaseSetMessage msg=new RequestLeaseSetMessage();
  long endTime=_requestState.getRequested().getEarliestLeaseDate();
  long fudge=300 - ((endTime - getContext().clock().now()) / 2000);
  endTime+=fudge;
  Date end=new Date(endTime);
  msg.setEndDate(end);
  msg.setSessionId(_runner.getSessionId());
  for (int i=0; i < _requestState.getRequested().getLeaseCount(); i++) {
    msg.addEndpoint(_requestState.getRequested().getLease(i).getGateway(),_requestState.getRequested().getLease(i).getTunnelId());
  }
  try {
    _runner.doSend(msg);
    getContext().jobQueue().addJob(new CheckLeaseRequestStatus());
  }
 catch (  I2CPMessageException ime) {
    getContext().statManager().addRateData("client.requestLeaseSetDropped",1,0);
    _log.error("Error sending I2CP message requesting the lease set",ime);
    _requestState.setIsSuccessful(false);
    if (_requestState.getOnFailed() != null)     RequestLeaseSetJob.this.getContext().jobQueue().addJob(_requestState.getOnFailed());
    _runner.failLeaseRequest(_requestState);
  }
}
