{
  Log log=ctx.logManager().getLog(GarlicMessageBuilder.class);
  if (config == null)   throw new IllegalArgumentException("Null config specified");
  GarlicMessage msg=new GarlicMessage(ctx);
  noteWrap(ctx,msg,config);
  byte cloveSet[]=buildCloveSet(ctx,config);
  byte encData[]=ctx.elGamalAESEngine().encrypt(cloveSet,target,encryptKey,wrappedTags,encryptTag,128);
  msg.setData(encData);
  msg.setMessageExpiration(config.getExpiration());
  if (log.shouldLog(Log.WARN))   log.warn("CloveSet size for message " + msg.getUniqueId() + " is "+ cloveSet.length+ " and encrypted message data is "+ encData.length);
  return msg;
}
