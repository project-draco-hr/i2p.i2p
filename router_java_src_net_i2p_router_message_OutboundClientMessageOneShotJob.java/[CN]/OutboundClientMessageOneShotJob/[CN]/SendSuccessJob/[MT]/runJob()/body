{
  if (_finished)   return;
  _finished=true;
  long sendTime=getContext().clock().now() - _start;
  if (_log.shouldLog(Log.INFO))   _log.info(OutboundClientMessageOneShotJob.this.getJobId() + ": SUCCESS!  msg " + _clientMessageId+ " acked by DSM after "+ sendTime+ "ms");
  if (_key != null && _tags != null && _leaseSet != null) {
    SessionKeyManager skm=getContext().clientManager().getClientSessionKeyManager(_from.calculateHash());
    if (skm != null)     skm.tagsAcked(_leaseSet.getEncryptionKey(),_key,_tags);
  }
  long dataMsgId=_cloveId;
  getContext().messageHistory().sendPayloadMessage(dataMsgId,true,sendTime);
  getContext().clientManager().messageDeliveryStatusUpdate(_from,_clientMessageId,MessageStatusMessage.STATUS_SEND_GUARANTEED_SUCCESS);
  int size=_clientMessageSize;
  getContext().statManager().addRateData("client.sendAckTime",sendTime,0);
  getContext().statManager().addRateData("client.sendMessageSize",_clientMessageSize,sendTime);
  if (_outTunnel != null) {
    if (_outTunnel.getLength() > 0)     size=((size + 1023) / 1024) * 1024;
    for (int i=0; i < _outTunnel.getLength(); i++) {
      getContext().profileManager().tunnelTestSucceeded(_outTunnel.getPeer(i),sendTime);
      getContext().profileManager().tunnelDataPushed(_outTunnel.getPeer(i),sendTime,size);
    }
    _outTunnel.incrementVerifiedBytesTransferred(size);
  }
  if (_inTunnel != null)   for (int i=0; i < _inTunnel.getLength(); i++)   getContext().profileManager().tunnelTestSucceeded(_inTunnel.getPeer(i),sendTime);
}
