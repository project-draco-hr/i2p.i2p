{
  TunnelInfo tunnel;
  long now=getContext().clock().now();
synchronized (_tunnelCache) {
    if (now - _cleanTime > 5 * 60 * 1000) {
      cleanTunnelCache(_tunnelCache);
      cleanTunnelCache(_backloggedTunnelCache);
      _cleanTime=now;
    }
    tunnel=(TunnelInfo)_backloggedTunnelCache.get(to);
    if (tunnel != null) {
      if (getContext().tunnelManager().isValidTunnel(_from.calculateHash(),tunnel)) {
        if (!getContext().commSystem().isBacklogged(tunnel.getPeer(1))) {
          if (_log.shouldLog(Log.WARN))           _log.warn("Switching back to tunnel " + tunnel + " for "+ _toString);
          _backloggedTunnelCache.remove(to);
          _tunnelCache.put(to,tunnel);
          return tunnel;
        }
      }
 else       _backloggedTunnelCache.remove(to);
    }
    tunnel=(TunnelInfo)_tunnelCache.get(to);
    if (tunnel != null) {
      if (getContext().tunnelManager().isValidTunnel(_from.calculateHash(),tunnel)) {
        if (tunnel.getLength() <= 1 || !getContext().commSystem().isBacklogged(tunnel.getPeer(1)))         return tunnel;
        if (_log.shouldLog(Log.WARN))         _log.warn("Switching from backlogged " + tunnel + " for "+ _toString);
        _backloggedTunnelCache.put(to,tunnel);
      }
      _tunnelCache.remove(to);
    }
    tunnel=selectOutboundTunnel();
    if (tunnel != null)     _tunnelCache.put(to,tunnel);
  }
  return tunnel;
}
