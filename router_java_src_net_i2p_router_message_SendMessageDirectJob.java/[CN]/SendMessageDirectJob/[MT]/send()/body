{
  if (_sent) {
    _log.warn("Not resending!",new Exception("blah"));
    return;
  }
  _sent=true;
  if (Router.getInstance().getRouterInfo().getIdentity().getHash().equals(_router.getIdentity().getHash())) {
    if (_selector != null) {
      OutNetMessage outM=new OutNetMessage();
      outM.setExpiration(_expiration);
      outM.setMessage(_message);
      outM.setOnFailedReplyJob(_onFail);
      outM.setOnFailedSendJob(_onFail);
      outM.setOnReplyJob(_onSuccess);
      outM.setOnSendJob(_onSend);
      outM.setPriority(_priority);
      outM.setReplySelector(_selector);
      outM.setTarget(_router);
      OutboundMessageRegistry.getInstance().registerPending(outM);
    }
    if (_onSend != null)     JobQueue.getInstance().addJob(_onSend);
    InNetMessage msg=new InNetMessage();
    msg.setFromRouter(_router.getIdentity());
    msg.setMessage(_message);
    InNetMessagePool.getInstance().add(msg);
    _log.debug("Adding " + _message.getClass().getName() + " to inbound message pool as it was destined for ourselves");
  }
 else {
    OutNetMessage msg=new OutNetMessage();
    msg.setExpiration(_expiration);
    msg.setMessage(_message);
    msg.setOnFailedReplyJob(_onFail);
    msg.setOnFailedSendJob(_onFail);
    msg.setOnReplyJob(_onSuccess);
    msg.setOnSendJob(_onSend);
    msg.setPriority(_priority);
    msg.setReplySelector(_selector);
    msg.setTarget(_router);
    OutNetMessagePool.getInstance().add(msg);
    _log.debug("Adding " + _message.getClass().getName() + " to outbound message pool targeting "+ _router.getIdentity().getHash().toBase64());
  }
}
