{
  if (_sent) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Not resending!",new Exception("blah"));
    return;
  }
  _sent=true;
  Hash to=_router.getIdentity().getHash();
  Hash us=_context.router().getRouterInfo().getIdentity().getHash();
  if (us.equals(to)) {
    if (_selector != null) {
      OutNetMessage outM=new OutNetMessage(_context);
      outM.setExpiration(_expiration);
      outM.setMessage(_message);
      outM.setOnFailedReplyJob(_onFail);
      outM.setOnFailedSendJob(_onFail);
      outM.setOnReplyJob(_onSuccess);
      outM.setOnSendJob(_onSend);
      outM.setPriority(_priority);
      outM.setReplySelector(_selector);
      outM.setTarget(_router);
      _context.messageRegistry().registerPending(outM);
    }
    if (_onSend != null)     _context.jobQueue().addJob(_onSend);
    InNetMessage msg=new InNetMessage(_context);
    msg.setFromRouter(_router.getIdentity());
    msg.setMessage(_message);
    _context.inNetMessagePool().add(msg);
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Adding " + _message.getClass().getName() + " to inbound message pool as it was destined for ourselves");
  }
 else {
    OutNetMessage msg=new OutNetMessage(_context);
    msg.setExpiration(_expiration);
    msg.setMessage(_message);
    msg.setOnFailedReplyJob(_onFail);
    msg.setOnFailedSendJob(_onFail);
    msg.setOnReplyJob(_onSuccess);
    msg.setOnSendJob(_onSend);
    msg.setPriority(_priority);
    msg.setReplySelector(_selector);
    msg.setTarget(_router);
    _context.outNetMessagePool().add(msg);
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Adding " + _message.getClass().getName() + " to outbound message pool targeting "+ _router.getIdentity().getHash().toBase64());
  }
}
