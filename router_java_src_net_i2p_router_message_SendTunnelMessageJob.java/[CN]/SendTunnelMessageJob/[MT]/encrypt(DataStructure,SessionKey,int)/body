{
  try {
    ByteArrayOutputStream baos=new ByteArrayOutputStream(paddedSize);
    struct.writeBytes(baos);
    byte iv[]=new byte[16];
    Hash h=getContext().sha().calculateHash(key.getData());
    System.arraycopy(h.getData(),0,iv,0,iv.length);
    return getContext().AESEngine().safeEncrypt(baos.toByteArray(),key,iv,paddedSize);
  }
 catch (  IOException ioe) {
    if (_log.shouldLog(Log.ERROR))     _log.error("Error writing out data to encrypt",ioe);
  }
catch (  DataFormatException dfe) {
    if (_log.shouldLog(Log.ERROR))     _log.error("Error formatting data to encrypt",dfe);
  }
  return null;
}
