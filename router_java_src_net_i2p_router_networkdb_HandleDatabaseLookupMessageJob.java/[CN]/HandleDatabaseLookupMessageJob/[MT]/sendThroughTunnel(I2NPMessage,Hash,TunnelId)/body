{
  if (getContext().routerHash().equals(toPeer)) {
    TunnelGatewayMessage m=new TunnelGatewayMessage(getContext());
    m.setMessage(message);
    m.setTunnelId(replyTunnel);
    m.setMessageExpiration(message.getMessageExpiration());
    getContext().tunnelDispatcher().dispatch(m);
  }
 else {
    TunnelGatewayMessage m=new TunnelGatewayMessage(getContext());
    m.setMessage(message);
    m.setMessageExpiration(message.getMessageExpiration());
    m.setTunnelId(replyTunnel);
    SendMessageDirectJob j=new SendMessageDirectJob(getContext(),m,toPeer,10 * 1000,100);
    getContext().jobQueue().addJob(j);
  }
}
