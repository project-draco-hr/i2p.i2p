{
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Handling database store message");
  boolean wasNew=false;
  if (_message.getValueType() == DatabaseStoreMessage.KEY_TYPE_LEASESET) {
    Object match=_context.netDb().store(_message.getKey(),_message.getLeaseSet());
    wasNew=(null == match);
  }
 else   if (_message.getValueType() == DatabaseStoreMessage.KEY_TYPE_ROUTERINFO) {
    if (_log.shouldLog(Log.INFO))     _log.info("Handling dbStore of router " + _message.getKey() + " with publishDate of "+ new Date(_message.getRouterInfo().getPublished()));
    Object match=_context.netDb().store(_message.getKey(),_message.getRouterInfo());
    wasNew=(null == match);
    _context.profileManager().heardAbout(_message.getKey());
  }
 else {
    if (_log.shouldLog(Log.ERROR))     _log.error("Invalid DatabaseStoreMessage data type - " + _message.getValueType() + ": "+ _message);
  }
  if (_from != null)   _fromHash=_from.getHash();
  if (_fromHash != null)   _context.profileManager().dbStoreReceived(_fromHash,wasNew);
  _context.statManager().addRateData("netDb.storeHandled",1,0);
}
