{
  DatabaseLookupMessage msg=new DatabaseLookupMessage(getContext(),true);
  msg.setSearchKey(getState().getTarget());
  msg.setFrom(replyGateway.getIdentity().getHash());
  msg.setDontIncludePeers(getState().getAttempted());
  msg.setMessageExpiration(new Date(expiration));
  msg.setReplyTunnel(replyTunnelId);
  Set attempted=getState().getAttempted();
  List peers=_peerSelector.selectNearestExplicit(getState().getTarget(),NUM_CLOSEST_TO_IGNORE,attempted,getFacade().getKBuckets());
  Set toSkip=new HashSet(64);
  toSkip.addAll(attempted);
  toSkip.addAll(peers);
  msg.setDontIncludePeers(toSkip);
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Peers we don't want to hear about: " + toSkip);
  return msg;
}
