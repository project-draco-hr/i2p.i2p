{
  FloodfillPeerSelector sel=(FloodfillPeerSelector)getPeerSelector();
  List peers=sel.selectFloodfillParticipants(getKBuckets());
  int flooded=0;
  for (int i=0; i < peers.size(); i++) {
    Hash peer=(Hash)peers.get(i);
    RouterInfo target=lookupRouterInfoLocally(peer);
    if ((target == null) || (_context.shitlist().isShitlisted(peer)))     continue;
    if (peer.equals(_context.routerHash()))     continue;
    DatabaseStoreMessage msg=new DatabaseStoreMessage(_context);
    if (ds instanceof LeaseSet) {
      msg.setKey(((LeaseSet)ds).getDestination().calculateHash());
      msg.setLeaseSet((LeaseSet)ds);
    }
 else {
      msg.setKey(((RouterInfo)ds).getIdentity().calculateHash());
      msg.setRouterInfo((RouterInfo)ds);
    }
    msg.setReplyGateway(null);
    msg.setReplyToken(0);
    msg.setReplyTunnel(null);
    OutNetMessage m=new OutNetMessage(_context);
    m.setMessage(msg);
    m.setOnFailedReplyJob(null);
    m.setPriority(FLOOD_PRIORITY);
    m.setTarget(target);
    m.setExpiration(_context.clock().now() + FLOOD_TIMEOUT);
    _context.commSystem().processMessage(m);
    flooded++;
    if (_log.shouldLog(Log.INFO))     _log.info("Flooding the entry for " + msg.getKey().toBase64() + " to "+ peer.toBase64());
  }
  if (_log.shouldLog(Log.INFO))   _log.info("Flooded the to " + flooded + " peers");
}
