{
  long delay=getContext().clock().now() - _sendTime;
  if (_wrappedMessage != null)   _wrappedMessage.acked();
  _facade.verifyFinished(_key);
  if (_message instanceof DatabaseStoreMessage) {
    boolean success=false;
    DatabaseStoreMessage dsm=(DatabaseStoreMessage)_message;
    if (_isRouterInfo && dsm.getValueType() == DatabaseStoreMessage.KEY_TYPE_ROUTERINFO)     success=dsm.getRouterInfo().getPublished() >= _published;
 else     if ((!_isRouterInfo) && dsm.getValueType() == DatabaseStoreMessage.KEY_TYPE_LEASESET)     success=dsm.getLeaseSet().getEarliestLeaseDate() >= _published;
    if (success) {
      getContext().profileManager().dbLookupSuccessful(_target,delay);
      if (_sentTo != null)       getContext().profileManager().dbStoreSuccessful(_sentTo);
      getContext().statManager().addRateData("netDb.floodfillVerifyOK",delay,0);
      if (_log.shouldLog(Log.INFO))       _log.info("Verify success for " + _key);
      return;
    }
    if (_log.shouldLog(Log.WARN))     _log.warn("Verify failed (older) for " + _key);
    if (_log.shouldLog(Log.INFO))     _log.info("Rcvd older lease: " + dsm.getLeaseSet());
  }
 else   if (_message instanceof DatabaseSearchReplyMessage) {
    getContext().profileManager().dbLookupReply(_target,0,((DatabaseSearchReplyMessage)_message).getNumReplies(),0,0,delay);
    if (_log.shouldLog(Log.WARN))     _log.warn("Verify failed (DSRM) for " + _key);
  }
  if (_sentTo != null)   getContext().profileManager().dbStoreFailed(_sentTo);
  getContext().statManager().addRateData("netDb.floodfillVerifyFail",delay,0);
  resend();
}
