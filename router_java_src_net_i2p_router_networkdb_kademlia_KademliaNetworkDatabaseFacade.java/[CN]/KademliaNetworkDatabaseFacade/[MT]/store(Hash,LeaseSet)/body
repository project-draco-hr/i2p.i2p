{
  if (!_initialized)   return null;
  boolean valid=validate(key,leaseSet);
  if (!valid)   throw new IllegalArgumentException("LeaseSet is not valid");
  LeaseSet rv=null;
  if (_ds.isKnown(key))   rv=(LeaseSet)_ds.get(key);
  _ds.put(key,leaseSet);
synchronized (_lastSent) {
    if (!_lastSent.containsKey(key))     _lastSent.put(key,new Long(0));
  }
  if (rv != null) {
    for (int i=0; i < rv.getLeaseCount(); i++) {
      Lease old=rv.getLease(i);
      for (int j=0; j < leaseSet.getLeaseCount(); j++) {
        Lease cur=leaseSet.getLease(j);
        if (cur.getTunnelId().getTunnelId() == old.getTunnelId().getTunnelId()) {
          cur.setNumFailure(old.getNumFailure());
          cur.setNumSuccess(old.getNumSuccess());
          break;
        }
      }
    }
  }
  return rv;
}
