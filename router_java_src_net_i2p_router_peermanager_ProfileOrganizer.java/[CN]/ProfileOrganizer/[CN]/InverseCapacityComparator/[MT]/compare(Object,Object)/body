{
  if ((lhs == null) || (rhs == null) || (!(lhs instanceof PeerProfile))|| (!(rhs instanceof PeerProfile)))   throw new ClassCastException("Only profiles can be compared - lhs = " + lhs + " rhs = "+ rhs);
  PeerProfile left=(PeerProfile)lhs;
  PeerProfile right=(PeerProfile)rhs;
  double rval=right.getCapacityValue();
  double lval=left.getCapacityValue();
  if (lval == rval)   return DataHelper.compareTo(right.getPeer().getData(),left.getPeer().getData());
  boolean rightBigger=rval > lval;
  if (_log.shouldLog(Log.DEBUG))   _log.debug("The capacity of " + right.getPeer().toBase64() + " and "+ left.getPeer().toBase64()+ " marks "+ (rightBigger ? "right" : "left")+ " as larger: r="+ right.getCapacityValue()+ " l="+ left.getCapacityValue());
  if (rightBigger)   return 1;
 else   return -1;
}
