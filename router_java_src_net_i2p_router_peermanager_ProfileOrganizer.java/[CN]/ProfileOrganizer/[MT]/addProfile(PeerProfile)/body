{
  if ((profile == null) || (profile.getPeer() == null))   return null;
  if (_log.shouldLog(Log.DEBUG))   _log.debug("New profile created for " + profile.getPeer().toBase64());
  PeerProfile old=getProfile(profile.getPeer());
  profile.coalesceStats();
  if (!getWriteLock())   return old;
  try {
    locked_placeProfile(profile);
    _strictCapacityOrder.add(profile);
  }
  finally {
    releaseWriteLock();
  }
  return old;
}
