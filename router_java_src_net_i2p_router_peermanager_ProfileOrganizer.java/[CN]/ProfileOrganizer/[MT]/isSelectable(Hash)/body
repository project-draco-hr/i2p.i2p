{
  NetworkDatabaseFacade netDb=_context.netDb();
  if (netDb == null)   return true;
  if (_context.router() == null)   return true;
  if ((_context.shitlist() != null) && (_context.shitlist().isShitlisted(peer))) {
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Peer " + peer.toBase64() + " is shitlisted, dont select it");
    return false;
  }
  RouterInfo info=netDb.lookupRouterInfoLocally(peer);
  if (null != info) {
    if (info.getIdentity().isHidden()) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Peer " + peer.toBase64() + " is marked as hidden, disallowing its use");
      return false;
    }
 else {
      boolean exclude=TunnelPeerSelector.shouldExclude(_context,info);
      if (exclude) {
        if (_log.shouldLog(Log.WARN))         _log.warn("Peer " + peer.toBase64() + " has capabilities or other stats suggesting we avoid it");
        return false;
      }
 else {
        if (_log.shouldLog(Log.INFO))         _log.info("Peer " + peer.toBase64() + " is locally known, allowing its use");
        return true;
      }
    }
  }
 else {
    if (_log.shouldLog(Log.WARN))     _log.warn("Peer " + peer.toBase64() + " is NOT locally known, disallowing its use");
    return false;
  }
}
