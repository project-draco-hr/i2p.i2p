{
  Hash peer=getHash(file.getName());
  try {
    if (peer == null) {
      _log.error("The file " + file.getName() + " is not a valid hash");
      return null;
    }
    PeerProfile profile=new PeerProfile(_context,peer);
    Properties props=new Properties();
    loadProps(props,file);
    long lastSentToSuccessfully=getLong(props,"lastSentToSuccessfully");
    if (isExpired(lastSentToSuccessfully)) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Dropping old profile for " + file.getName() + ", since we haven't heard from them in a long time");
      file.delete();
      return null;
    }
    profile.setCapacityBonus(getLong(props,"capacityBonus"));
    profile.setIntegrationBonus(getLong(props,"integrationBonus"));
    profile.setSpeedBonus(getLong(props,"speedBonus"));
    profile.setLastHeardAbout(getLong(props,"lastHeardAbout"));
    profile.setFirstHeardAbout(getLong(props,"firstHeardAbout"));
    profile.setLastSendSuccessful(getLong(props,"lastSentToSuccessfully"));
    profile.setLastSendFailed(getLong(props,"lastFailedSend"));
    profile.setLastHeardFrom(getLong(props,"lastHeardFrom"));
    profile.setTunnelTestTimeAverage(getDouble(props,"tunnelTestTimeAverage"));
    profile.setPeakThroughputKBps(getDouble(props,"tunnelPeakThroughput"));
    profile.setPeakTunnelThroughputKBps(getDouble(props,"tunnelPeakTunnelThroughput"));
    profile.setPeakTunnel1mThroughputKBps(getDouble(props,"tunnelPeakTunnel1mThroughput"));
    profile.getTunnelHistory().load(props);
    profile.getDBHistory().load(props);
    profile.getCommError().load(props,"commError",true);
    profile.getDbIntroduction().load(props,"dbIntroduction",true);
    profile.getDbResponseTime().load(props,"dbResponseTime",true);
    profile.getReceiveSize().load(props,"receiveSize",true);
    profile.getSendFailureSize().load(props,"sendFailureSize",true);
    profile.getSendSuccessSize().load(props,"sendSuccessSize",true);
    profile.getTunnelCreateResponseTime().load(props,"tunnelCreateResponseTime",true);
    profile.getTunnelTestResponseTime().load(props,"tunnelTestResponseTime",true);
    profile.getTunnelTestResponseTimeSlow().load(props,"tunnelTestResponseTimeSlow",true);
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Loaded the profile for " + peer.toBase64() + " from "+ file.getName());
    return profile;
  }
 catch (  IllegalArgumentException iae) {
    _log.error("Error loading profile from " + file.getName(),iae);
    file.delete();
    return null;
  }
}
