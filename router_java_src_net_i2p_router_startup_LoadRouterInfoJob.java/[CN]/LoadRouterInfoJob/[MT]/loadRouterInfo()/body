{
  String routerInfoFile=getContext().getProperty(Router.PROP_INFO_FILENAME,Router.PROP_INFO_FILENAME_DEFAULT);
  RouterInfo info=null;
  String keyFilename=getContext().getProperty(Router.PROP_KEYS_FILENAME,Router.PROP_KEYS_FILENAME_DEFAULT);
  File rif=new File(getContext().getRouterDir(),routerInfoFile);
  if (rif.exists())   _infoExists=true;
  File rkf=new File(getContext().getRouterDir(),keyFilename);
  if (rkf.exists())   _keysExist=true;
  InputStream fis1=null;
  InputStream fis2=null;
  try {
    if (_infoExists && _keysExist) {
      fis1=new BufferedInputStream(new FileInputStream(rif));
      info=new RouterInfo();
      info.readBytes(fis1);
      if (!info.isValid())       throw new DataFormatException("Our RouterInfo has a bad signature");
      if (_log.shouldLog(Log.DEBUG))       _log.debug("Reading in routerInfo from " + rif.getAbsolutePath() + " and it has "+ info.getAddresses().size()+ " addresses");
      _us=info;
    }
    if (_keysExist) {
      fis2=new BufferedInputStream(new FileInputStream(rkf));
      PrivateKey privkey=new PrivateKey();
      privkey.readBytes(fis2);
      SigningPrivateKey signingPrivKey=new SigningPrivateKey();
      signingPrivKey.readBytes(fis2);
      PublicKey pubkey=new PublicKey();
      pubkey.readBytes(fis2);
      SigningPublicKey signingPubKey=new SigningPublicKey();
      signingPubKey.readBytes(fis2);
      getContext().keyManager().setKeys(pubkey,privkey,signingPubKey,signingPrivKey);
    }
  }
 catch (  IOException ioe) {
    _log.log(Log.CRIT,"Error reading the router info from " + rif.getAbsolutePath() + " and the keys from "+ rkf.getAbsolutePath(),ioe);
    _us=null;
    rif.delete();
    rkf.delete();
    _infoExists=false;
    _keysExist=false;
  }
catch (  DataFormatException dfe) {
    _log.log(Log.CRIT,"Corrupt router info or keys at " + rif.getAbsolutePath() + " / "+ rkf.getAbsolutePath(),dfe);
    _us=null;
    rif.delete();
    rkf.delete();
    _infoExists=false;
    _keysExist=false;
  }
 finally {
    if (fis1 != null)     try {
      fis1.close();
    }
 catch (    IOException ioe) {
    }
    if (fis2 != null)     try {
      fis2.close();
    }
 catch (    IOException ioe) {
    }
  }
}
