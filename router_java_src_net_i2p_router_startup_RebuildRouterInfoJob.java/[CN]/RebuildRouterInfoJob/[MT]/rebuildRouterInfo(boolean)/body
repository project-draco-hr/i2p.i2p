{
  _log.debug("Rebuilding the new router info");
  boolean fullRebuild=false;
  RouterInfo info=null;
  String infoFilename=Router.getInstance().getConfigSetting(Router.PROP_INFO_FILENAME);
  if (infoFilename == null)   infoFilename=Router.PROP_INFO_FILENAME_DEFAULT;
  String keyFilename=Router.getInstance().getConfigSetting(Router.PROP_KEYS_FILENAME);
  if (keyFilename == null)   keyFilename=Router.PROP_KEYS_FILENAME_DEFAULT;
  File keyFile=new File(keyFilename);
  if (keyFile.exists()) {
    info=Router.getInstance().getRouterInfo();
    if (info == null) {
      info=new RouterInfo();
      FileInputStream fis=null;
      try {
        fis=new FileInputStream(keyFile);
        PrivateKey privkey=new PrivateKey();
        privkey.readBytes(fis);
        SigningPrivateKey signingPrivKey=new SigningPrivateKey();
        signingPrivKey.readBytes(fis);
        PublicKey pubkey=new PublicKey();
        pubkey.readBytes(fis);
        SigningPublicKey signingPubKey=new SigningPublicKey();
        signingPubKey.readBytes(fis);
        RouterIdentity ident=new RouterIdentity();
        ident.setCertificate(new Certificate(Certificate.CERTIFICATE_TYPE_NULL,null));
        ident.setPublicKey(pubkey);
        ident.setSigningPublicKey(signingPubKey);
        info.setIdentity(ident);
      }
 catch (      Exception e) {
        _log.error("Error reading in the key data from " + keyFile.getAbsolutePath(),e);
        if (fis != null)         try {
          fis.close();
        }
 catch (        IOException ioe) {
        }
        fis=null;
        keyFile.delete();
        rebuildRouterInfo(alreadyRunning);
        return;
      }
 finally {
        if (fis != null)         try {
          fis.close();
        }
 catch (        IOException ioe) {
        }
      }
    }
    try {
      info.setAddresses(CommSystemFacade.getInstance().createAddresses());
      info.setOptions(StatisticsManager.getInstance().publishStatistics());
      info.setPublished(CreateRouterInfoJob.getCurrentPublishDate());
      info.sign(KeyManager.getInstance().getSigningPrivateKey());
    }
 catch (    DataFormatException dfe) {
      _log.error("Error rebuilding the new router info",dfe);
      return;
    }
    FileOutputStream fos=null;
    try {
      fos=new FileOutputStream(infoFilename);
      info.writeBytes(fos);
    }
 catch (    DataFormatException dfe) {
      _log.error("Error rebuilding the router information",dfe);
    }
catch (    IOException ioe) {
      _log.error("Error writing out the rebuilt router information",ioe);
    }
 finally {
      if (fos != null)       try {
        fos.close();
      }
 catch (      IOException ioe) {
      }
    }
  }
 else {
    _log.warn("Private key file " + keyFile.getAbsolutePath() + " deleted!  Rebuilding a brand new router identity!");
    info=CreateRouterInfoJob.createRouterInfo();
    fullRebuild=true;
  }
  Router.getInstance().setRouterInfo(info);
  _log.info("Router info rebuilt and stored at " + infoFilename + " ["+ info+ "]");
}
