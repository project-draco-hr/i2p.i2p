{
  DatagramSocket socket=null;
  try {
    socket=new DatagramSocket();
    InetAddress address=InetAddress.getByName(serverName);
    byte[] buf=new NtpMessage().toByteArray();
    DatagramPacket packet=new DatagramPacket(buf,buf.length,address,NTP_PORT);
    NtpMessage.encodeTimestamp(packet.getData(),40,(System.currentTimeMillis() / 1000.0) + SECONDS_1900_TO_EPOCH);
    socket.send(packet);
    packet=new DatagramPacket(buf,buf.length);
    socket.setSoTimeout(timeout);
    socket.receive(packet);
    double destinationTimestamp=(System.currentTimeMillis() / 1000.0) + SECONDS_1900_TO_EPOCH;
    NtpMessage msg=new NtpMessage(packet.getData());
    double localClockOffset=((msg.receiveTimestamp - msg.originateTimestamp) + (msg.transmitTimestamp - destinationTimestamp)) / 2;
    if ((msg.stratum < 1) || (msg.stratum > 15)) {
      return null;
    }
    long[] rv=new long[2];
    rv[0]=(long)(System.currentTimeMillis() + localClockOffset * 1000);
    rv[1]=msg.stratum;
    return rv;
  }
 catch (  IOException ioe) {
    return null;
  }
 finally {
    if (socket != null)     socket.close();
  }
}
