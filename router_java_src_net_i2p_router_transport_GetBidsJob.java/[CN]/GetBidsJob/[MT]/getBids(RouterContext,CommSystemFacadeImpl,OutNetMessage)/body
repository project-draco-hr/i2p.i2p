{
  Log log=context.logManager().getLog(GetBidsJob.class);
  Hash to=msg.getTarget().getIdentity().getHash();
  if (context.shitlist().isShitlisted(to)) {
    if (log.shouldLog(Log.WARN))     log.warn("Attempt to send a message to a shitlisted peer - " + to);
    context.messageRegistry().peerFailed(to);
    fail(context,msg);
    return;
  }
  Hash us=context.routerHash();
  if (to.equals(us)) {
    if (log.shouldLog(Log.ERROR))     log.error("wtf, send a message to ourselves?  nuh uh. msg = " + msg);
    fail(context,msg);
    return;
  }
  List bids=facade.getBids(msg);
  if ((bids == null) || (bids.size() <= 0)) {
    context.shitlist().shitlistRouter(to,"No bids after " + (bids != null ? bids.size() + " tries" : "0 tries"));
    context.netDb().fail(to);
    fail(context,msg);
  }
 else {
    int lowestCost=-1;
    TransportBid winner=null;
    for (int i=0; i < bids.size(); i++) {
      TransportBid bid=(TransportBid)bids.get(i);
      if ((lowestCost < 0) || (bid.getLatencyMs() < lowestCost)) {
        winner=bid;
        lowestCost=bid.getLatencyMs();
      }
    }
    if (winner != null) {
      if (log.shouldLog(Log.INFO))       log.info("Winning bid: " + winner + " out of "+ bids);
      winner.getTransport().send(msg);
    }
  }
}
