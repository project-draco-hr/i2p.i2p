{
synchronized (lock) {
    if (isDisabled) {
      _log.warn("Plugin has been disabled previously, ignoring new device.");
      return;
    }
  }
  if (!ROUTER_DEVICE.equals(dev.getDeviceType()) || !dev.isRootDevice())   return;
 else   if (isNATPresent()) {
    _log.error("We got a second IGD on the network! the plugin doesn't handle that: let's disable it.");
    isDisabled=true;
synchronized (lock) {
      _router=null;
      _service=null;
    }
    stop();
    return;
  }
  _log.warn("UP&P IGD found : " + dev.getFriendlyName());
synchronized (lock) {
    _router=dev;
  }
  discoverService();
  stop();
synchronized (lock) {
    if (_service == null) {
      _log.error("The IGD device we got isn't suiting our needs, let's disable the plugin");
      isDisabled=true;
      _router=null;
      return;
    }
  }
  registerPortMappings();
}
