{
  final StringBuilder sb=new StringBuilder();
  sb.append("<h3><a name=\"upnp\"></a>").append(_("UPnP Status")).append("</h3>");
synchronized (_otherUDNs) {
    if (!_otherUDNs.isEmpty()) {
      sb.append(_("Disabled UPnP Devices"));
      sb.append("<ul>");
      for (      Map.Entry<String,String> e : _otherUDNs.entrySet()) {
        String udn=e.getKey();
        String name=e.getValue();
        sb.append("<li>").append(name).append("<br>UDN: ").append(udn).append("</li>");
      }
      sb.append("</ul>");
    }
  }
  if (isDisabled) {
    sb.append(_("UPnP has been disabled; Do you have more than one UPnP Internet Gateway Device on your LAN ?"));
    return sb.toString();
  }
 else   if (!isNATPresent()) {
    sb.append(_("UPnP has not found any UPnP-aware, compatible device on your LAN."));
    return sb.toString();
  }
  listSubDev(null,_router,sb);
  String addr=getNATAddress();
  sb.append("<p>");
  if (addr != null)   sb.append(_("The current external IP address reported by UPnP is {0}",addr));
 else   sb.append(_("The current external IP address is not available."));
  int downstreamMaxBitRate=getDownstreamMaxBitRate();
  int upstreamMaxBitRate=getUpstreamMaxBitRate();
  if (downstreamMaxBitRate > 0)   sb.append("<br>").append(_("UPnP reports the maximum downstream bit rate is {0}bits/sec",DataHelper.formatSize2(downstreamMaxBitRate)));
  if (upstreamMaxBitRate > 0)   sb.append("<br>").append(_("UPnP reports the maximum upstream bit rate is {0}bits/sec",DataHelper.formatSize2(upstreamMaxBitRate)));
synchronized (lock) {
    for (    ForwardPort port : portsToForward) {
      sb.append("<br>");
      if (portsForwarded.contains(port))       sb.append(_("{0} port {1,number,#####} was successfully forwarded by UPnP.",protoToString(port.protocol),port.portNumber));
 else       sb.append(_("{0} port {1,number,#####} was not forwarded by UPnP.",protoToString(port.protocol),port.portNumber));
    }
  }
  sb.append("</p>");
  return sb.toString();
}
