{
  if (_log.shouldLog(Log.DEBUG))   _log.debug("UPnP Update:");
  if (!_isRunning)   return;
  Set<ForwardPort> forwards=new HashSet(addresses.size());
  for (  String style : addresses.keySet()) {
    RouterAddress ra=addresses.get(style);
    if (ra == null)     continue;
    Properties opts=ra.getOptions();
    if (opts == null)     continue;
    String s=opts.getProperty("port");
    if (s == null)     continue;
    int port=-1;
    try {
      port=Integer.parseInt(s);
    }
 catch (    NumberFormatException nfe) {
      continue;
    }
    int protocol=-1;
    if ("SSU".equals(style))     protocol=ForwardPort.PROTOCOL_UDP_IPV4;
 else     if ("NTCP".equals(style))     protocol=ForwardPort.PROTOCOL_TCP_IPV4;
 else     continue;
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Adding: " + style + " "+ port);
    ForwardPort fp=new ForwardPort(style,false,protocol,port);
    forwards.add(fp);
  }
  _upnp.onChangePublicPorts(forwards,_upnpCallback);
}
