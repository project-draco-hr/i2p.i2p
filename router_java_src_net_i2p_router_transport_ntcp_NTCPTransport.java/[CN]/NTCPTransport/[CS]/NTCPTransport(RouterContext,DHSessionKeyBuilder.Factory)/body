{
  super(ctx);
  _dhFactory=dh;
  _log=ctx.logManager().getLog(getClass());
  _context.statManager().createRateStat("ntcp.sendTime","Total message lifetime when sent completely","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.sendQueueSize","How many messages were ahead of the current one on the connection's queue when it was first added","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.receiveTime","How long it takes to receive an inbound message","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.receiveSize","How large the received message was","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.sendBacklogTime","How long the head of the send queue has been waiting when we fail to add a new one to the queue (period is the number of messages queued)","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.failsafeWrites","How many times do we need to proactively add in an extra nio write to a peer at any given failsafe pass?","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.failsafeCloses","How many times do we need to proactively close an idle connection to a peer at any given failsafe pass?","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.failsafeInvalid","How many times do we close a connection to a peer to work around a JVM bug?","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.accept","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.attemptBanlistedPeer","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.attemptUnreachablePeer","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.closeOnBacklog","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.connectFailedIOE","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.connectFailedTimeout","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.connectFailedTimeoutIOE","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.connectFailedUnresolved","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.connectSuccessful","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.corruptDecryptedI2NP","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.corruptI2NPCRC","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.corruptI2NPIME","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.corruptI2NPIOE","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.corruptMetaCRC","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.corruptSkew","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.corruptTooLargeI2NP","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.dontSendOnBacklog","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.inboundCheckConnection","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.inboundEstablished","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.inboundEstablishedDuplicate","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.infoMessageEnqueued","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.floodInfoMessageEnqueued","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidDH","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidHXY","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidHXxorBIH","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidInboundDFE","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidInboundIOE","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidInboundSignature","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidInboundSize","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidInboundSkew","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidSignature","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.multipleCloseOnRemove","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.outboundEstablishFailed","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.outboundFailedIOEImmediate","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.invalidOutboundSkew","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.noBidTooLargeI2NP","send size","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.queuedRecv","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.read","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.readError","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.receiveCorruptEstablishment","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.receiveMeta","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.registerConnect","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.throttledReadComplete","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.throttledWriteComplete","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.wantsQueuedWrite","","ntcp",RATES);
  _context.statManager().createRateStat("ntcp.writeError","","ntcp",RATES);
  _endpoints=new HashSet(4);
  _establishing=new ConcurrentHashSet(16);
  _conLock=new Object();
  _conByIdent=new ConcurrentHashMap(64);
  _finisher=new NTCPSendFinisher(ctx,this);
  _pumper=new EventPumper(ctx,this);
  _reader=new Reader(ctx);
  _writer=new net.i2p.router.transport.ntcp.Writer(ctx);
  _fastBid=new SharedBid(25);
  _slowBid=new SharedBid(70);
  _slowCostBid=new SharedBid(85);
  _nearCapacityBid=new SharedBid(90);
  _nearCapacityCostBid=new SharedBid(105);
  _transientFail=new SharedBid(TransportBid.TRANSIENT_FAIL);
}
