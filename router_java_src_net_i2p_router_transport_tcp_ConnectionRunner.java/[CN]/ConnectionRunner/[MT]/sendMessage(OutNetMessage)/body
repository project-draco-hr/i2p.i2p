{
  byte data[]=msg.getMessageData();
  if (data == null) {
    if (_log.shouldLog(Log.WARN))     _log.warn("message " + msg.getMessageType() + "/"+ msg.getMessageId()+ " expired before it could be sent");
    _con.sent(msg,false,0);
    return;
  }
  OutputStream out=_con.getOutputStream();
  boolean ok=false;
  long before=-1;
  long after=-1;
  try {
synchronized (out) {
      before=_context.clock().now();
      out.write(data);
      out.flush();
      after=_context.clock().now();
    }
    ok=true;
  }
 catch (  IOException ioe) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Error writing out the message",ioe);
  }
  _con.sent(msg,ok,after - before);
}
