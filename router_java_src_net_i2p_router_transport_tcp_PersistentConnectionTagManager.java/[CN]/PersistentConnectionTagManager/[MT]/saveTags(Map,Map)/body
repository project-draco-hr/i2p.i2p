{
  byte data[]=prepareData(keyByPeer,tagByPeer);
  if (data == null)   return;
synchronized (_ioLock) {
    File tagFile=getFile();
    if (tagFile == null)     return;
    FileOutputStream fos=null;
    try {
      fos=new FileOutputStream(tagFile);
      fos.write(data);
      fos.flush();
      if (_log.shouldLog(Log.INFO))       _log.info("Wrote connection tags for " + keyByPeer.size() + " peers");
    }
 catch (    IOException ioe) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Error writing out the tags",ioe);
    }
 finally {
      if (fos != null)       try {
        fos.close();
      }
 catch (      IOException ioe) {
      }
    }
  }
}
