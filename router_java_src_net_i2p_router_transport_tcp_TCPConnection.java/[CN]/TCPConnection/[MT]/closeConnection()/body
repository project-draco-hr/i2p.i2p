{
  if (_log.shouldLog(Log.INFO))   _log.info("Connection closed",new Exception("Closed by"));
  if (_closed)   return;
  _closed=true;
  if (_runner != null)   _runner.stopRunning();
  if (_reader != null)   _reader.stopReading();
  if (_in != null)   try {
    _in.close();
  }
 catch (  IOException ioe) {
  }
  if (_out != null)   try {
    _out.close();
  }
 catch (  IOException ioe) {
  }
  if (_socket != null)   try {
    _socket.close();
  }
 catch (  IOException ioe) {
  }
  List msgs=clearPendingMessages();
  for (int i=0; i < msgs.size(); i++) {
    OutNetMessage msg=(OutNetMessage)msgs.get(0);
    _transport.afterSend(msg,false,true,-1);
  }
  _context.profileManager().commErrorOccurred(_ident.getHash());
  _transport.addConnectionErrorMessage("Connection closed with " + _ident.getHash().toBase64().substring(0,6) + " after "+ DataHelper.formatDuration(getLifetime()));
  _transport.connectionClosed(this);
}
