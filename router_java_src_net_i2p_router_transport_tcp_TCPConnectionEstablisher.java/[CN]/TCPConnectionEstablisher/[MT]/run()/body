{
  while (true) {
    RouterInfo info=_transport.getNextPeer();
    ConnectionBuilder cb=new ConnectionBuilder(_context,_transport,info);
    TCPConnection con=null;
    try {
      con=cb.establishConnection();
    }
 catch (    Exception e) {
      _log.log(Log.CRIT,"Unhandled exception establishing a connection to " + info.getIdentity().getHash().toBase64(),e);
    }
    if (con != null) {
      _transport.connectionEstablished(con);
    }
 else {
      _transport.addConnectionErrorMessage(cb.getError());
      Hash peer=info.getIdentity().getHash();
      _context.profileManager().commErrorOccurred(peer);
      _context.shitlist().shitlistRouter(peer,"Unable to contact");
      _context.netDb().fail(peer);
    }
    _transport.establishmentComplete(info);
  }
}
