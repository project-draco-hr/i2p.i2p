{
  super(context);
  _log=context.logManager().getLog(TCPTransport.class);
  if (_context == null)   throw new RuntimeException("Context is null");
  if (_context.statManager() == null)   throw new RuntimeException("Stat manager is null");
  _context.statManager().createFrequencyStat("tcp.attemptFailureFrequency","How often do we attempt to contact someone, and fail?","TCP Transport",new long[]{60 * 1000l,60 * 60 * 1000l,24 * 60 * 60* 1000l});
  _context.statManager().createFrequencyStat("tcp.attemptSuccessFrequency","How often do we attempt to contact someone, and succeed?","TCP Transport",new long[]{60 * 1000l,60 * 60 * 1000l,24 * 60 * 60* 1000l});
  _context.statManager().createFrequencyStat("tcp.acceptFailureFrequency","How often do we reject someone who contacts us?","TCP Transport",new long[]{60 * 1000l,60 * 60 * 1000l,24 * 60 * 60* 1000l});
  _context.statManager().createFrequencyStat("tcp.acceptSuccessFrequency","How often do we accept someone who contacts us?","TCP Transport",new long[]{60 * 1000l,60 * 60 * 1000l,24 * 60 * 60* 1000l});
  _context.statManager().createRateStat("tcp.connectionLifetime","How long do connections last (measured when they close)?","TCP Transport",new long[]{60 * 1000l,60 * 60 * 1000l,24 * 60 * 60* 1000l});
  _listeners=new ArrayList();
  _connections=new HashMap();
  _msgs=new HashMap();
  _address=address;
  if (address != null) {
    _listenHost=address.getOptions().getProperty(TCPAddress.PROP_HOST);
    String portStr=address.getOptions().getProperty(TCPAddress.PROP_PORT);
    try {
      _listenPort=Integer.parseInt(portStr);
    }
 catch (    NumberFormatException nfe) {
      _log.error("Invalid port: " + portStr + " Address: \n"+ address,nfe);
    }
  }
  _listenAddressIsValid=false;
  try {
    String setting=_context.router().getConfigSetting(PROP_LISTEN_IS_VALID);
    _listenAddressIsValid=Boolean.TRUE.toString().equalsIgnoreCase(setting);
  }
 catch (  Throwable t) {
    _listenAddressIsValid=false;
    if (_log.shouldLog(Log.WARN))     _log.warn("Unable to determine whether TCP listening address is valid, so we're assuming it isn't.  Set " + PROP_LISTEN_IS_VALID + " otherwise");
  }
  _running=false;
}
