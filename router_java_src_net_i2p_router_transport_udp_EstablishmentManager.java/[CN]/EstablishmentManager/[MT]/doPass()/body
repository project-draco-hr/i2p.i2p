{
  _activity=0;
  long now=_context.clock().now();
  long nextSendTime=-1;
  long nextSendInbound=handleInbound();
  long nextSendOutbound=handleOutbound();
  if (nextSendInbound > 0)   nextSendTime=nextSendInbound;
  if ((nextSendTime < 0) || (nextSendOutbound < nextSendTime))   nextSendTime=nextSendOutbound;
  long delay=nextSendTime - now;
  if ((nextSendTime == -1) || (delay > 0)) {
    if (delay > 1000)     delay=1000;
    boolean interrupted=false;
    try {
synchronized (_activityLock) {
        if (_activity > 0)         return;
        if (nextSendTime == -1)         _activityLock.wait(1000);
 else         _activityLock.wait(delay);
      }
    }
 catch (    InterruptedException ie) {
      interrupted=true;
    }
    if (_log.shouldLog(Log.DEBUG))     _log.debug("After waiting w/ nextSend=" + nextSendTime + " and delay="+ delay+ " and interrupted="+ interrupted);
  }
}
