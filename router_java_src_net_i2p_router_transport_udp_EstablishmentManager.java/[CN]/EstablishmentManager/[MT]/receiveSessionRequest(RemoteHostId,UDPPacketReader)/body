{
  if (!_transport.isValid(from.getIP())) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Receive session request from invalid IP: " + from);
    return;
  }
  boolean isNew=false;
  InboundEstablishState state=_inboundStates.get(from);
  if (state == null) {
    if (!shouldAllowInboundEstablishment()) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Dropping inbound establish, increase " + PROP_MAX_CONCURRENT_ESTABLISH);
      _context.statManager().addRateData("udp.establishDropped",1);
      return;
    }
    if (_context.blocklist().isBlocklisted(from.getIP())) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Receive session request from blocklisted IP: " + from);
      return;
    }
    if (!_transport.allowConnection())     return;
    state=new InboundEstablishState(_context,from.getIP(),from.getPort(),_transport.getExternalPort(),_transport.getDHBuilder());
    state.receiveSessionRequest(reader.getSessionRequestReader());
    InboundEstablishState oldState=_inboundStates.putIfAbsent(from,state);
    isNew=oldState == null;
    if (!isNew)     state=oldState;
  }
  if (isNew) {
    if (_transport.canIntroduce() && state.getSentPort() >= 1024) {
      long tag=1 + _context.random().nextLong(MAX_TAG_VALUE);
      state.setSentRelayTag(tag);
    }
 else {
    }
    if (_log.shouldLog(Log.INFO))     _log.info("Received NEW session request " + state);
  }
 else {
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Receive DUP session request from: " + state);
  }
  notifyActivity();
}
