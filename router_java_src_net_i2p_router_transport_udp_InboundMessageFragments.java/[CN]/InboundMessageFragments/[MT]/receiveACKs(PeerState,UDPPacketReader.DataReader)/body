{
  int rv=0;
  if (data.readACKsIncluded()) {
    int fragments=0;
    int ackCount=data.readACKCount();
    if (ackCount > 0) {
      rv+=ackCount;
      _context.statManager().addRateData("udp.receivedACKs",ackCount,0);
      for (int i=0; i < ackCount; i++) {
        long id=data.readACK(i);
        if (_log.shouldLog(Log.INFO))         _log.info("Full ACK of message " + id + " received!");
        fragments+=_outbound.acked(id,from.getRemotePeer());
      }
    }
 else {
      _log.error("Received ACKs with no acks?! " + data);
    }
  }
  if (data.readACKBitfieldsIncluded()) {
    ACKBitfield bitfields[]=data.readACKBitfields();
    if (bitfields != null) {
      rv+=bitfields.length;
      for (int i=0; i < bitfields.length; i++) {
        if (_log.shouldLog(Log.INFO))         _log.info("Partial ACK received: " + bitfields[i]);
        _outbound.acked(bitfields[i],from.getRemotePeer());
      }
    }
  }
  if (data.readECN())   from.ECNReceived();
 else   from.dataReceived();
  return rv;
}
