{
  if (size > MAX_FRAGMENTS)   throw new IllegalArgumentException();
  _bitfieldMessageId=messageId;
  int ackCount=0;
  long acks=0;
  for (int i=0; i < size; i++) {
    if (data[i] != null) {
      acks|=mask(i);
      ackCount++;
    }
  }
  _fragmentAcks=acks;
  _fragmentCount=size;
  _ackCount=ackCount;
}
