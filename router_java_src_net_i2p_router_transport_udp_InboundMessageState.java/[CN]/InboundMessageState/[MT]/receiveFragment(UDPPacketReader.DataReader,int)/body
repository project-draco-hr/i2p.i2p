{
  int fragmentNum=data.readMessageFragmentNum(dataFragment);
  if ((fragmentNum < 0) || (fragmentNum > _fragments.length)) {
    _log.error("Invalid fragment " + fragmentNum + "/"+ _fragments.length);
    return false;
  }
  if (_fragments[fragmentNum] == null) {
    ByteArray message=_fragmentCache.acquire();
    try {
      data.readMessageFragment(dataFragment,message.getData(),0);
      int size=data.readMessageFragmentSize(dataFragment);
      message.setValid(size);
      _fragments[fragmentNum]=message;
      boolean isLast=data.readMessageIsLast(dataFragment);
      if (isLast)       _lastFragment=fragmentNum;
      if (_log.shouldLog(Log.DEBUG))       _log.debug("New fragment " + fragmentNum + " for message "+ _messageId+ ", size="+ size+ ", isLast="+ isLast+ ", data="+ Base64.encode(message.getData(),0,size));
    }
 catch (    ArrayIndexOutOfBoundsException aioobe) {
      _log.error("Corrupt SSU fragment " + fragmentNum,aioobe);
      return false;
    }
  }
 else {
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Received fragment " + fragmentNum + " for message "+ _messageId+ " again, old size="+ _fragments[fragmentNum].getValid()+ " and new size="+ data.readMessageFragmentSize(dataFragment));
  }
  return true;
}
