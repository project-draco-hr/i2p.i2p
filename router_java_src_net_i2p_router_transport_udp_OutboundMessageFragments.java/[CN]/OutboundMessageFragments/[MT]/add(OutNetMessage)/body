{
  I2NPMessage msgBody=msg.getMessage();
  RouterInfo target=msg.getTarget();
  if ((msgBody == null) || (target == null)) {
synchronized (_activeMessages) {
      _activeMessages.notifyAll();
    }
    return;
  }
  OutboundMessageState state=new OutboundMessageState(_context);
  boolean ok=state.initialize(msg,msgBody);
  state.setPeer(_transport.getPeerState(target.getIdentity().calculateHash()));
  finishMessages();
  int active=0;
synchronized (_activeMessages) {
    if (ok)     _activeMessages.add(state);
    active=_activeMessages.size();
    _activeMessages.notifyAll();
  }
  msg.timestamp("made active along with: " + active);
  _context.statManager().addRateData("udp.outboundActiveCount",active,0);
}
