{
  PeerState peer=state.getPeer();
  if (peer == null)   throw new RuntimeException("wtf, null peer for " + state);
  int active=peer.add(state);
synchronized (_activePeers) {
    if (!_activePeers.contains(peer)) {
      if (_log.shouldLog(Log.DEBUG))       _log.debug("Add a new message to a new peer " + peer.getRemotePeer().toBase64());
      _activePeers.add(peer);
    }
 else {
      if (_log.shouldLog(Log.DEBUG))       _log.debug("Add a new message to an existing peer " + peer.getRemotePeer().toBase64());
    }
    if (_activePeers.size() == 1)     _lastCycleTime=System.currentTimeMillis();
    _activePeers.notifyAll();
  }
  _context.statManager().addRateData("udp.outboundActiveCount",active,0);
}
