{
  if (state != null) {
    int fragments=state.getFragmentCount();
    if (fragments < 0)     return null;
    if (_log.shouldLog(Log.INFO))     _log.info("Building packet for " + state + " to "+ peer);
    UDPPacket rv[]=new UDPPacket[fragments];
    for (int i=0; i < fragments; i++) {
      if (state.needsSending(i))       rv[i]=_builder.buildPacket(state,i,peer);
    }
    return rv;
  }
 else {
    return null;
  }
}
