{
  if (msg == null || peer == null)   throw new IllegalArgumentException();
  _context=context;
  _log=_context.logManager().getLog(OutboundMessageState.class);
  _message=m;
  _peer=peer;
  int size=msg.getRawMessageSize();
  acquireBuf(size);
  _totalSize=msg.toRawByteArray(_messageBuf.getData());
  _messageBuf.setValid(_totalSize);
  _messageId=msg.getUniqueId();
  _startedOn=_context.clock().now();
  _nextSendTime=_startedOn;
  _expiration=_startedOn + EXPIRATION;
}
