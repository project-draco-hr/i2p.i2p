{
  int totalSize=_messageBuf.getValid();
  int numFragments=totalSize / fragmentSize;
  if (numFragments * fragmentSize < totalSize)   numFragments++;
  if (numFragments > InboundMessageState.MAX_FRAGMENTS)   throw new IllegalArgumentException("Fragmenting a " + totalSize + " message into "+ numFragments+ " fragments - too many!");
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Fragmenting a " + totalSize + " message into "+ numFragments+ " fragments");
  _fragmentSends=new short[numFragments];
  _fragmentSize=fragmentSize;
}
