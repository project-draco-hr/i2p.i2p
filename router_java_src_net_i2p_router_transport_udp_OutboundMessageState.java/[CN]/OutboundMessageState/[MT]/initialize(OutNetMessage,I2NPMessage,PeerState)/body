{
  _message=m;
  _peer=peer;
  if (_messageBuf != null) {
    _cache.release(_messageBuf);
    _messageBuf=null;
  }
  _messageBuf=_cache.acquire();
  int size=msg.getRawMessageSize();
  if (size > _messageBuf.getData().length)   throw new IllegalArgumentException("Size too large!  " + size + " in "+ msg);
  try {
    int len=msg.toRawByteArray(_messageBuf.getData());
    _messageBuf.setValid(len);
    _messageId=msg.getUniqueId();
    _startedOn=_context.clock().now();
    _nextSendTime=_startedOn;
    _expiration=_startedOn + EXPIRATION;
    return true;
  }
 catch (  IllegalStateException ise) {
    _cache.release(_messageBuf);
    _messageBuf=null;
    _released=true;
    return false;
  }
}
