{
  _message=m;
  _peer=peer;
  int size=msg.getRawMessageSize();
  acquireBuf(size);
  try {
    int len=msg.toRawByteArray(_messageBuf.getData());
    _messageBuf.setValid(len);
    _messageId=msg.getUniqueId();
    _startedOn=_context.clock().now();
    _nextSendTime=_startedOn;
    _expiration=_startedOn + EXPIRATION;
    return true;
  }
 catch (  IllegalStateException ise) {
    releaseBuf();
    return false;
  }
}
