{
  UDPPacket packet=UDPPacket.acquire(_context);
  InetAddress to=null;
  try {
    to=InetAddress.getByAddress(state.getSentIP());
  }
 catch (  UnknownHostException uhe) {
    if (_log.shouldLog(Log.ERROR))     _log.error("How did we think this was a valid IP?  " + state.getRemoteHostId().toString());
    return null;
  }
  byte data[]=packet.getPacket().getData();
  Arrays.fill(data,0,data.length,(byte)0x0);
  int off=UDPPacket.MAC_SIZE + UDPPacket.IV_SIZE;
  data[off]=SESSION_REQUEST_FLAG_BYTE;
  off++;
  long now=_context.clock().now() / 1000;
  DataHelper.toLong(data,off,4,now);
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Sending request with time = " + new Date(now * 1000));
  off+=4;
  System.arraycopy(state.getSentX(),0,data,off,state.getSentX().length);
  off+=state.getSentX().length;
  DataHelper.toLong(data,off,1,state.getSentIP().length);
  off+=1;
  System.arraycopy(state.getSentIP(),0,data,off,state.getSentIP().length);
  off+=state.getSentIP().length;
  DataHelper.toLong(data,off,2,state.getSentPort());
  off+=2;
  if ((off % 16) != 0)   off+=16 - (off % 16);
  packet.getPacket().setLength(off);
  authenticate(packet,state.getIntroKey(),state.getIntroKey());
  setTo(packet,to,state.getSentPort());
  return packet;
}
