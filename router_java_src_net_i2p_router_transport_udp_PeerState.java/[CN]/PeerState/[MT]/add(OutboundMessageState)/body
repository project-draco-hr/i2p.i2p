{
  state.setPeer(this);
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Adding to " + _remotePeer.toBase64() + ": "+ state.getMessageId());
  Map msgs=_outboundMessages;
  if (msgs == null)   return 0;
synchronized (msgs) {
    msgs.put(new Long(state.getMessageId()),state);
    return msgs.size();
  }
}
