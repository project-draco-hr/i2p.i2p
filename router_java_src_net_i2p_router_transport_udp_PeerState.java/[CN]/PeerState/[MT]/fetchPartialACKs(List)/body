{
  InboundMessageState states[]=null;
  int curState=0;
synchronized (_inboundMessages) {
    int numMessages=_inboundMessages.size();
    if (numMessages <= 0)     return;
    int remaining=_inboundMessages.size();
    for (Iterator iter=_inboundMessages.values().iterator(); remaining > 0; remaining--) {
      InboundMessageState state=(InboundMessageState)iter.next();
      if (state.isExpired()) {
        iter.remove();
      }
 else {
        if (!state.isComplete()) {
          if (states == null)           states=new InboundMessageState[numMessages];
          states[curState++]=state;
        }
      }
    }
  }
  if (states != null) {
    for (int i=curState - 1; i >= 0; i--) {
      if (states[i] != null)       rv.add(states[i].createACKBitfield());
    }
  }
}
