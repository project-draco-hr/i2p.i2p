{
  PeerState charlie=_transport.getPeerState(UDPAddress.CAPACITY_TESTING);
  InetAddress aliceIP=null;
  SessionKey aliceIntroKey=null;
  try {
    aliceIP=InetAddress.getByAddress(from.getIP());
    aliceIntroKey=new SessionKey();
    testInfo.readIntroKey(aliceIntroKey.getData(),0);
    RouterInfo info=_context.netDb().lookupRouterInfoLocally(charlie.getRemotePeer());
    if (info == null) {
      if (_log.shouldLog(Log.WARN))       _log.warn("No info for charlie: " + charlie);
      return;
    }
    UDPAddress addr=new UDPAddress(info.getTargetAddress(UDPTransport.STYLE));
    SessionKey charlieIntroKey=new SessionKey(addr.getIntroKey());
    UDPPacket packet=_packetBuilder.buildPeerTestToAlice(aliceIP,from.getPort(),aliceIntroKey,charlieIntroKey,nonce);
    _transport.send(packet);
    packet=_packetBuilder.buildPeerTestToCharlie(aliceIP,from.getPort(),aliceIntroKey,nonce,charlie.getRemoteIPAddress(),charlie.getRemotePort(),charlie.getCurrentCipherKey(),charlie.getCurrentMACKey());
    _transport.send(packet);
  }
 catch (  UnknownHostException uhe) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Unable to build the aliceIP from " + from,uhe);
  }
}
