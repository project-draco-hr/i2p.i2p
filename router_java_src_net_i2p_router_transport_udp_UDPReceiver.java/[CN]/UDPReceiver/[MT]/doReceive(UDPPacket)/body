{
  if (_log.shouldLog(Log.INFO))   _log.info("Received: " + packet);
  RemoteHostId from=packet.getRemoteHost();
  if (_transport.isInDropList(from)) {
    if (_log.shouldLog(Log.INFO))     _log.info("Ignoring packet from the drop-listed peer: " + from);
    _context.statManager().addRateData("udp.ignorePacketFromDroplist",packet.getLifetime(),0);
    packet.release();
    return 0;
  }
  packet.enqueue();
  boolean rejected=false;
  int queueSize=0;
  long headPeriod=0;
synchronized (_inboundQueue) {
    queueSize=_inboundQueue.size();
    if (queueSize > 0) {
      headPeriod=((UDPPacket)_inboundQueue.get(0)).getLifetime();
      if (headPeriod > MAX_QUEUE_PERIOD) {
        rejected=true;
        _inboundQueue.notifyAll();
      }
    }
    if (!rejected) {
      _inboundQueue.add(packet);
      _inboundQueue.notifyAll();
      return queueSize + 1;
    }
  }
  packet.release();
  _context.statManager().addRateData("udp.droppedInbound",queueSize,headPeriod);
  if (_log.shouldLog(Log.WARN)) {
    StringBuffer msg=new StringBuffer();
    msg.append("Dropping inbound packet with ");
    msg.append(queueSize);
    msg.append(" queued for ");
    msg.append(headPeriod);
    if (_transport != null)     msg.append(" packet handlers: ").append(_transport.getPacketHandlerStatus());
    _log.warn(msg.toString());
  }
  return queueSize;
}
