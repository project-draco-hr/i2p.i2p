{
  long expiration=_context.clock().now() + blockTime;
  int remaining=-1;
  while ((_keepRunning) && (remaining < 0)) {
    try {
synchronized (_outboundQueue) {
        if (_outboundQueue.size() < MAX_QUEUED) {
          _outboundQueue.add(packet);
          remaining=_outboundQueue.size();
          _outboundQueue.notifyAll();
        }
 else {
          long remainingTime=expiration - _context.clock().now();
          if (remainingTime > 0) {
            _outboundQueue.wait(remainingTime);
          }
 else {
            remaining=_outboundQueue.size();
            _outboundQueue.notifyAll();
          }
        }
      }
    }
 catch (    InterruptedException ie) {
    }
  }
  _context.statManager().addRateData("udp.sendQueueSize",remaining,packet.getLifetime());
  return remaining;
}
