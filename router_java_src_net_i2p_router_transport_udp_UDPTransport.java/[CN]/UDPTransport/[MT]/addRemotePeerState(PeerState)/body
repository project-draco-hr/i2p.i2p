{
  if (_log.shouldLog(Log.INFO))   _log.info("Add remote peer state: " + peer);
  PeerState oldPeer=null;
  if (peer.getRemotePeer() != null) {
synchronized (_peersByIdent) {
      oldPeer=(PeerState)_peersByIdent.put(peer.getRemotePeer(),peer);
      if ((oldPeer != null) && (oldPeer != peer)) {
      }
    }
  }
  if ((oldPeer != null) && (_log.shouldLog(Log.WARN)))   _log.warn("Peer already connected: old=" + oldPeer + " new="+ peer,new Exception("dup"));
  oldPeer=null;
  RemoteHostId remoteId=peer.getRemoteHostId();
  if (remoteId == null)   return false;
synchronized (_peersByRemoteHost) {
    oldPeer=(PeerState)_peersByRemoteHost.put(remoteId,peer);
    if ((oldPeer != null) && (oldPeer != peer)) {
    }
  }
  if ((oldPeer != null) && (_log.shouldLog(Log.WARN)))   _log.warn("Peer already connected: old=" + oldPeer + " new="+ peer,new Exception("dup"));
  _activeThrottle.unchoke(peer.getRemotePeer());
  _context.shitlist().unshitlistRouter(peer.getRemotePeer());
  if (SHOULD_FLOOD_PEERS)   _flooder.addPeer(peer);
  _expireEvent.add(peer);
  return true;
}
