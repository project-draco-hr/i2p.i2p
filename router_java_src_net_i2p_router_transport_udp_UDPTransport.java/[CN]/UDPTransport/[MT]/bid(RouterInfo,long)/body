{
  if (dataSize > OutboundMessageState.MAX_MSG_SIZE) {
    return null;
  }
  Hash to=toAddress.getIdentity().calculateHash();
  PeerState peer=getPeerState(to);
  if (peer != null) {
    if (_log.shouldLog(Log.DEBUG))     _log.debug("bidding on a message to an established peer: " + peer);
    if (preferUDP())     return _fastPreferredBid;
 else     return _fastBid;
  }
 else {
    if (_reachabilityStatus == CommSystemFacade.STATUS_HOSED) {
      markUnreachable(to);
      return null;
    }
    RouterAddress addr=toAddress.getTargetAddress(STYLE);
    if (addr == null) {
      markUnreachable(to);
      return null;
    }
    UDPAddress ua=new UDPAddress(addr);
    if (ua == null) {
      markUnreachable(to);
      return null;
    }
    if (ua.getIntroducerCount() <= 0) {
      InetAddress ia=ua.getHostAddress();
      if (ua.getPort() <= 0 || ia == null || !isPubliclyRoutable(ia.getAddress())) {
        markUnreachable(to);
        return null;
      }
    }
    if (!allowConnection())     return _transientFail;
    if (_log.shouldLog(Log.DEBUG))     _log.debug("bidding on a message to an unestablished peer: " + to.toBase64());
    int count;
synchronized (_peersByIdent) {
      count=_peersByIdent.size();
    }
    if (alwaysPreferUDP() || count < 3)     return _slowPreferredBid;
 else     if (preferUDP())     return _slowBid;
 else     if (haveCapacity())     return _slowestBid;
 else     return _nearCapacityBid;
  }
}
