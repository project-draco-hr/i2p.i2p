{
  if (_log.shouldLog(Log.INFO))   _log.info("External address received: " + RemoteHostId.toString(ourIP) + ":"+ ourPort);
  if (explicitAddressSpecified())   return;
  boolean fixedPort=getIsPortFixed();
  boolean updated=false;
  boolean fireTest=false;
synchronized (this) {
    if ((_externalListenHost == null) || (!eq(_externalListenHost.getAddress(),_externalListenPort,ourIP,ourPort))) {
      if ((_reachabilityStatus == CommSystemFacade.STATUS_UNKNOWN) || (_context.clock().now() - _reachabilityStatusLastUpdated > 2 * TEST_FREQUENCY)) {
        try {
          _externalListenHost=InetAddress.getByAddress(ourIP);
          if (!fixedPort)           _externalListenPort=ourPort;
          rebuildExternalAddress();
          replaceAddress(_externalAddress);
          updated=true;
        }
 catch (        UnknownHostException uhe) {
          _externalListenHost=null;
        }
      }
 else {
        fireTest=true;
      }
    }
 else {
    }
  }
  if (fireTest) {
    _context.statManager().addRateData("udp.addressTestInsteadOfUpdate",1,0);
    _testEvent.forceRun();
    SimpleTimer.getInstance().addEvent(_testEvent,5 * 1000);
  }
 else   if (updated) {
    _context.statManager().addRateData("udp.addressUpdated",1,0);
    if (!fixedPort)     _context.router().setConfigSetting(PROP_EXTERNAL_PORT,ourPort + "");
    _context.router().saveConfig();
    _context.router().rebuildRouterInfo();
    _testEvent.forceRun();
    SimpleTimer.getInstance().addEvent(_testEvent,5 * 1000);
  }
}
