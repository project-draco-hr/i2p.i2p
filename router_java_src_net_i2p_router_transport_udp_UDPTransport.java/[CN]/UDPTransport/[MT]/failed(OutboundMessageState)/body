{
  if (msg == null)   return;
  int consecutive=0;
  if ((msg.getPeer() != null) && ((msg.getMaxSends() >= OutboundMessageFragments.MAX_VOLLEYS) || (msg.isExpired()))) {
    OutNetMessage m=msg.getMessage();
    if (m != null)     m.timestamp("message failure - volleys = " + msg.getMaxSends() + " lastReceived: "+ (_context.clock().now() - msg.getPeer().getLastReceiveTime())+ " lastSentFully: "+ (_context.clock().now() - msg.getPeer().getLastSendFullyTime())+ " expired? "+ msg.isExpired());
    consecutive=msg.getPeer().incrementConsecutiveFailedSends();
    if (_log.shouldLog(Log.WARN))     _log.warn("Consecutive failure #" + consecutive + " sending to "+ msg.getPeer());
    if ((consecutive > MAX_CONSECUTIVE_FAILED) && (msg.getPeer().getInactivityTime() > DROP_INACTIVITY_TIME))     dropPeer(msg.getPeer(),false);
  }
  failed(msg.getMessage());
}
