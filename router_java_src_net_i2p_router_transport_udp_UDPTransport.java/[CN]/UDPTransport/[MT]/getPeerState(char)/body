{
  long now=_context.clock().now();
  int index=_context.random().nextInt(1024);
  int cap=capacity - 'A';
  if ((cap < 0) || (cap >= _peersByCapacity.length))   return null;
  List peers=_peersByCapacity[cap];
  int size=0;
  int off=0;
  PeerState rv=null;
  while (rv == null) {
synchronized (peers) {
      size=peers.size();
      if (size > 0) {
        index=(index + off) % size;
        rv=(PeerState)peers.get(index);
      }
    }
    if (rv == null)     break;
    if (_context.shitlist().isShitlisted(rv.getRemotePeer()))     rv=null;
 else     if (now - rv.getLastReceiveTime() > MAX_INACTIVITY_FOR_CAPACITY)     rv=null;
 else     break;
    off++;
    if (off >= size)     break;
  }
  _context.statManager().addRateData("udp.peersByCapacity",size,capacity);
  return rv;
}
