{
  short old=_reachabilityStatus;
  long now=_context.clock().now();
switch (status) {
case CommSystemFacade.STATUS_OK:
    _context.statManager().addRateData("udp.statusOK",1);
  _reachabilityStatus=status;
_reachabilityStatusLastUpdated=now;
break;
case CommSystemFacade.STATUS_DIFFERENT:
_context.statManager().addRateData("udp.statusDifferent",1);
_reachabilityStatus=status;
_reachabilityStatusLastUpdated=now;
break;
case CommSystemFacade.STATUS_REJECT_UNSOLICITED:
_context.statManager().addRateData("udp.statusReject",1);
case CommSystemFacade.STATUS_DISCONNECTED:
case CommSystemFacade.STATUS_HOSED:
_reachabilityStatus=status;
_reachabilityStatusLastUpdated=now;
break;
case CommSystemFacade.STATUS_UNKNOWN:
default :
_context.statManager().addRateData("udp.statusUnknown",1);
break;
}
_testEvent.setLastTested();
if (status != CommSystemFacade.STATUS_UNKNOWN) {
if (status != old) _reachabilityStatusUnchanged=0;
 else _reachabilityStatusUnchanged++;
}
if ((status != old) && (status != CommSystemFacade.STATUS_UNKNOWN)) {
if (_log.shouldLog(Log.WARN)) _log.warn("Old status: " + old + " New status: "+ status+ " from: ",new Exception("traceback"));
rebuildExternalAddress();
}
 else {
if (_log.shouldLog(Log.INFO)) _log.info("Status unchanged: " + _reachabilityStatus + " ("+ _reachabilityStatusUnchanged+ " consecutive times), last updated "+ DataHelper.formatDuration(_context.clock().now() - _reachabilityStatusLastUpdated)+ " ago");
}
}
