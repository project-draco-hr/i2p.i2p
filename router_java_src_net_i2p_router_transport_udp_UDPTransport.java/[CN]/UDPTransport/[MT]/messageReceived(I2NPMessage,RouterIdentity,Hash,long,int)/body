{
  if (inMsg instanceof DatabaseStoreMessage) {
    DatabaseStoreMessage dsm=(DatabaseStoreMessage)inMsg;
    if (dsm.getType() == DatabaseStoreMessage.KEY_TYPE_ROUTERINFO) {
      Hash from=remoteIdentHash;
      if (from == null)       from=remoteIdent.getHash();
      if (from.equals(dsm.getKey())) {
        RouterInfo info=dsm.getRouterInfo();
        Properties opts=info.getOptions();
        if ((opts != null) && (info.isValid())) {
          String capacities=opts.getProperty(UDPAddress.PROP_CAPACITY);
          if (capacities != null) {
            PeerState peer=getPeerState(from);
            for (int i=0; i < capacities.length(); i++) {
              char capacity=capacities.charAt(i);
              List peers=_peersByCapacity[capacity];
synchronized (peers) {
                if ((peers.size() < MAX_PEERS_PER_CAPACITY) && (!peers.contains(peer)))                 peers.add(peer);
              }
            }
          }
        }
      }
    }
  }
  super.messageReceived(inMsg,remoteIdent,remoteIdentHash,msToReceive,bytesReceived);
}
