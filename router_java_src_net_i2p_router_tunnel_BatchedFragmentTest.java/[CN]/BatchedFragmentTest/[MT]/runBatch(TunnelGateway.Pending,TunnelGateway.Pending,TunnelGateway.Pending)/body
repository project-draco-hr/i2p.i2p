{
  ArrayList messages=new ArrayList();
  messages.add(pending1);
  TunnelGateway.QueuePreprocessor pre=createPreprocessor(_context);
  SenderImpl sender=new SenderImpl();
  DefragmentedReceiverImpl handleReceiver=new DefragmentedReceiverImpl(pending1.getData(),pending2.getData(),pending3.getData());
  FragmentHandler handler=new FragmentHandler(_context,handleReceiver);
  ReceiverImpl receiver=new ReceiverImpl(handler,0);
  byte msg[]=pending1.getData();
  _log.debug("SEND(" + msg.length + "): "+ Base64.encode(msg)+ " "+ _context.sha().calculateHash(msg).toBase64());
  boolean keepGoing=true;
  int added=0;
  while (keepGoing) {
    keepGoing=pre.preprocessQueue(messages,new SenderImpl(),receiver);
    if ((keepGoing) || ((messages.size() == 0) && (added < 2))) {
      try {
        Thread.sleep(150);
      }
 catch (      InterruptedException ie) {
      }
      if (added == 0) {
        _log.debug("Adding pending2");
        messages.add(pending2);
        added++;
        keepGoing=true;
      }
 else       if (added == 1) {
        _log.debug("Adding pending3");
        messages.add(pending3);
        added++;
        keepGoing=true;
      }
    }
  }
  return handleReceiver.receivedOk();
}
