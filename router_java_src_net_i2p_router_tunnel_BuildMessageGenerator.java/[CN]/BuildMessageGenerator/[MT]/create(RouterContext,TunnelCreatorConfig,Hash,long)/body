{
  TunnelBuildMessage msg=new TunnelBuildMessage(ctx);
  List order=new ArrayList(ORDER.length);
  for (int i=0; i < ORDER.length; i++)   order.add(ORDER[i]);
  Collections.shuffle(order,ctx.random());
  for (int i=0; i < ORDER.length; i++) {
    int hop=((Integer)order.get(i)).intValue();
    Hash peer=cfg.getPeer(hop);
    RouterInfo ri=ctx.netDb().lookupRouterInfoLocally(peer);
    if (ri == null)     return null;
    createRecord(i,hop,msg,cfg,replyRouter,replyTunnel,ctx,ri.getIdentity().getPublicKey());
  }
  layeredEncrypt(ctx,msg,cfg,order);
  return msg;
}
