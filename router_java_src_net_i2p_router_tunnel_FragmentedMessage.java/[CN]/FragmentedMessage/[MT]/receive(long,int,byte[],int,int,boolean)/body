{
  if (fragmentNum < 0)   throw new RuntimeException("Fragment # == " + fragmentNum + " for messageId "+ messageId);
  if (payload == null)   throw new RuntimeException("Payload is null for messageId " + messageId);
  if (length <= 0)   throw new RuntimeException("Length is impossible (" + length + ") for messageId "+ messageId);
  if (offset + length > payload.length)   throw new RuntimeException("Length is impossible (" + length + "/"+ offset+ " out of "+ payload.length+ ") for messageId "+ messageId);
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Receive message " + messageId + " fragment "+ fragmentNum+ " with "+ length+ " bytes (last? "+ isLast+ ") offset = "+ offset);
  _messageId=messageId;
  ByteArray ba=_cache.acquire();
  System.arraycopy(payload,offset,ba.getData(),0,length);
  ba.setValid(length);
  ba.setOffset(0);
  if (_log.shouldLog(Log.DEBUG))   _log.debug("fragment[" + fragmentNum + "/"+ offset+ "/"+ length+ "]: "+ Base64.encode(ba.getData(),ba.getOffset(),ba.getValid()));
  _fragments[fragmentNum]=ba;
  _lastReceived=isLast;
  if (fragmentNum > _highFragmentNum)   _highFragmentNum=fragmentNum;
  if (isLast && fragmentNum <= 0)   throw new RuntimeException("hmm, isLast and fragmentNum=" + fragmentNum + " for message "+ messageId);
}
