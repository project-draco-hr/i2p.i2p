{
  if (!alreadySearched)   _config.incrementProcessedMessages();
  if (_target == null) {
    _target=_context.netDb().lookupRouterInfoLocally(_config.getSendTo());
    if (_target == null) {
      ReceiveJob j=null;
      if (!alreadySearched)       j=new ReceiveJob(_context,encrypted);
      _context.netDb().lookupRouterInfo(_config.getSendTo(),j,j,5 * 1000);
      return -1;
    }
  }
  _config.incrementSentMessages();
  TunnelDataMessage msg=new TunnelDataMessage(_context);
  msg.setData(encrypted);
  msg.setTunnelId(_config.getSendTunnel());
  OutNetMessage out=new OutNetMessage(_context);
  out.setMessage(msg);
  out.setTarget(_target);
  out.setExpiration(msg.getMessageExpiration());
  out.setPriority(200);
  _context.outNetMessagePool().add(out);
  return msg.getUniqueId();
}
