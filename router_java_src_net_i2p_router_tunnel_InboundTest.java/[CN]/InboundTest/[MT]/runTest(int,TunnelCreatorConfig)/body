{
  byte orig[]=new byte[1024];
  byte message[]=new byte[1024];
  _context.random().nextBytes(orig);
  System.arraycopy(orig,0,message,0,message.length);
  InboundGatewayProcessor p=new InboundGatewayProcessor(_context,config.getConfig(0));
  p.process(message,0,message.length,null);
  for (int i=1; i < numHops; i++) {
    HopProcessor hop=new HopProcessor(_context,config.getConfig(i));
    Hash prev=config.getConfig(i).getReceiveFrom();
    boolean ok=hop.process(message,0,message.length,prev);
    if (!ok)     _log.error("Error processing at hop " + i);
  }
  InboundEndpointProcessor end=new InboundEndpointProcessor(_context,config);
  boolean ok=end.retrievePreprocessedData(message,0,message.length,config.getPeer(numHops - 1));
  if (!ok)   _log.error("Error retrieving cleartext at the endpoint");
  boolean eq=DataHelper.eq(orig,16,message,16,orig.length - 16);
  _log.info("equal? " + eq);
}
