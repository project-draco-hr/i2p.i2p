{
  while (pending.size() > 0) {
    TunnelGateway.Pending msg=(TunnelGateway.Pending)pending.remove(0);
    byte preprocessed[][]=preprocess(msg);
    for (int i=0; i < preprocessed.length; i++) {
      if (_log.shouldLog(Log.DEBUG))       _log.debug("Preprocessed: fragment " + i + "/"+ (preprocessed.length - 1)+ " in "+ msg.getMessageId()+ ": "+ Base64.encode(preprocessed[i]));
      sender.sendPreprocessed(preprocessed[i],rec);
    }
    notePreprocessing(msg.getMessageId(),preprocessed.length);
  }
  return false;
}
