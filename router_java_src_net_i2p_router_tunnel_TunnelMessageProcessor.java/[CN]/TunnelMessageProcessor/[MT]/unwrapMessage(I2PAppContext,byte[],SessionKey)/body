{
  Log log=getLog(ctx);
  int payloadLength=data.length - IV_SIZE - HOPS * Hash.HASH_LENGTH - Hash.HASH_LENGTH;
  Hash recvPayloadHash=ctx.sha().calculateHash(data,IV_SIZE,payloadLength);
  if (log.shouldLog(Log.DEBUG))   log.debug("H(recvPayload) = " + recvPayloadHash.toBase64());
  decryptMessage(ctx,data,layerKey);
  Hash payloadHash=ctx.sha().calculateHash(data,IV_SIZE,payloadLength);
  if (log.shouldLog(Log.DEBUG))   log.debug("H(payload) = " + payloadHash.toBase64());
  boolean ok=verifyMessage(ctx,data,payloadHash);
  if (ok) {
    return true;
  }
 else {
    if (log.shouldLog(Log.DEBUG))     log.debug("No hashes match");
    return false;
  }
}
