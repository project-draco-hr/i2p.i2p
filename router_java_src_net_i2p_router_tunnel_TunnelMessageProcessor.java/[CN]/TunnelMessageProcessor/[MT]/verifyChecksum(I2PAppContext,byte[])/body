{
  int checksumSize=GatewayMessage.HOPS * Hash.HASH_LENGTH;
  int offset=message.length - (checksumSize + Hash.HASH_LENGTH);
  Hash checksumHash=ctx.sha().calculateHash(message,offset,checksumSize);
  getLog(ctx).debug("Measured checksum: " + checksumHash.toBase64());
  byte expected[]=new byte[Hash.HASH_LENGTH];
  System.arraycopy(message,message.length - Hash.HASH_LENGTH,expected,0,Hash.HASH_LENGTH);
  getLog(ctx).debug("Expected checksum: " + Base64.encode(expected));
  return DataHelper.eq(checksumHash.getData(),0,message,message.length - Hash.HASH_LENGTH,Hash.HASH_LENGTH);
}
