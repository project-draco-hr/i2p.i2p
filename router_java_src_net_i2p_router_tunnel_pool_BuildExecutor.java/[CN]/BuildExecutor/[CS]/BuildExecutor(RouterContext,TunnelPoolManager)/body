{
  _context=ctx;
  _log=ctx.logManager().getLog(getClass());
  _manager=mgr;
  _currentlyBuilding=new ArrayList(10);
  _context.statManager().createRateStat("tunnel.concurrentBuilds","How many builds are going at once","Tunnels",new long[]{60 * 1000,5 * 60 * 1000,60 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.concurrentBuildsLagged","How many builds are going at once when we reject further builds, due to job lag (period is lag)","Tunnels",new long[]{60 * 1000,5 * 60 * 1000,60 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.buildExploratoryExpire","How often an exploratory tunnel times out during creation","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.buildClientExpire","How often a client tunnel times out during creation","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.buildExploratorySuccess","Response time for success","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.buildClientSuccess","Response time for success","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.buildExploratoryReject","Response time for rejection","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.buildClientReject","Response time for rejection","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.buildRequestTime","How long it takes to build a tunnel request","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.buildRequestZeroHopTime","How long it takes to build a zero hop tunnel","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _context.statManager().createRateStat("tunnel.pendingRemaining","How many inbound requests are pending after a pass (period is how long the pass takes)?","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  StatManager statMgr=_context.statManager();
  String bwTiers=_context.router().getRouterInfo().BW_CAPABILITY_CHARS;
  for (int i=0; i < bwTiers.length(); i++) {
    String bwTier=String.valueOf(bwTiers.charAt(i));
    statMgr.createRateStat("tunnel.tierAgree" + bwTier,"Agreed joins from " + bwTier,"Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
    statMgr.createRateStat("tunnel.tierReject" + bwTier,"Rejected joins from " + bwTier,"Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
    statMgr.createRateStat("tunnel.tierExpire" + bwTier,"Expired joins from " + bwTier,"Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  }
  statMgr.createRateStat("tunnel.tierAgreeUnknown","Agreed joins from unknown","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  statMgr.createRateStat("tunnel.tierRejectUnknown","Rejected joins from unknown","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  statMgr.createRateStat("tunnel.tierExpireUnknown","Expired joins from unknown","Tunnels",new long[]{60 * 1000,10 * 60 * 1000});
  _repoll=false;
  _handler=new BuildHandler(ctx,this);
}
