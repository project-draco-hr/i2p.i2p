{
  for (int i=0; i < MAX_HANDLE_AT_ONCE; ) {
    BuildMessageState state=_inboundBuildMessages.poll();
    if (state == null)     return 0;
    long dropBefore=System.currentTimeMillis() - (BuildRequestor.REQUEST_TIMEOUT / 4);
    if (state.recvTime <= dropBefore) {
      if (_log.shouldLog(Log.WARN))       _log.warn("Not even trying to handle/decrypt the request " + state.msg.getUniqueId() + ", since we received it a long time ago: "+ (System.currentTimeMillis() - state.recvTime));
      _context.statManager().addRateData("tunnel.dropLoadDelay",System.currentTimeMillis() - state.recvTime,0);
      _context.throttle().setTunnelStatus(_x("Dropping tunnel requests: Too slow"));
      continue;
    }
    i++;
    long beforeHandle=System.currentTimeMillis();
    long actualTime=handleRequest(state);
    if (_log.shouldLog(Log.DEBUG))     _log.debug("Handle took " + (System.currentTimeMillis() - beforeHandle) + "/"+ actualTime+ " ("+ i+ " with "+ _inboundBuildMessages.size()+ " remaining)");
  }
  int remaining=_inboundBuildMessages.size();
  if (remaining > 0)   _context.statManager().addRateData("tunnel.handleRemaining",remaining,0);
  return remaining;
}
