{
  if (false && filterUnreachable(ctx,isInbound,isExploratory)) {
    List caps=ctx.peerManager().getPeersByCapability(Router.CAPABILITY_UNREACHABLE);
    if (caps == null)     return new HashSet(0);
    HashSet rv=new HashSet(caps);
    return rv;
  }
 else   if (filterSlow(ctx,isInbound,isExploratory)) {
    Log log=ctx.logManager().getLog(TunnelPeerSelector.class);
    char excl[]=getExcludeCaps(ctx);
    Set peers=new HashSet(1);
    if (excl != null) {
      FloodfillNetworkDatabaseFacade fac=(FloodfillNetworkDatabaseFacade)ctx.netDb();
      List known=fac.getKnownRouterData();
      if (known != null) {
        for (int i=0; i < known.size(); i++) {
          RouterInfo peer=(RouterInfo)known.get(i);
          boolean shouldExclude=shouldExclude(ctx,log,peer,excl);
          if (shouldExclude) {
            peers.add(peer.getIdentity().calculateHash());
            continue;
          }
        }
      }
    }
    return peers;
  }
 else {
    return new HashSet(1);
  }
}
