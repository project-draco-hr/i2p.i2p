{
  int howMany=0;
  if (allowZeroHop)   howMany=standardAmount - usable;
 else   howMany=standardAmount - (usable - fallback);
  int concurrentBuildWeight=1;
  if (howMany > 0) {
    long now=_context.clock().now();
    if (earliestExpire - now < 60 * 1000)     concurrentBuildWeight=4;
 else     if (earliestExpire - now < 120 * 1000)     concurrentBuildWeight=3;
 else     if (earliestExpire - now < 180 * 1000)     concurrentBuildWeight=2;
    howMany=(howMany * concurrentBuildWeight) - inProgress;
  }
  int rv=howMany;
  if ((usable + inProgress + fallback > 2 * standardAmount) && (howMany > 0))   rv=0;
  if (allowZeroHop && (rv > standardAmount))   rv=standardAmount;
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Count: rv: " + rv + " howMany "+ howMany+ " concurrentWeight "+ concurrentBuildWeight+ " allow? "+ allowZeroHop+ " usable "+ usable+ " std "+ standardAmount+ " inProgress "+ inProgress+ " fallback "+ fallback+ " for "+ toString());
  if (rv < 0)   return 0;
  return rv;
}
