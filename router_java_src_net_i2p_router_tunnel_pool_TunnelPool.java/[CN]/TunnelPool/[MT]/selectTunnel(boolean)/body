{
synchronized (_tunnels) {
    if (_tunnels.size() <= 0) {
      if (_log.shouldLog(Log.WARN))       _log.warn(toString() + ": No tunnels to select from");
    }
 else {
      Collections.shuffle(_tunnels,_context.random());
      for (int i=0; i < _tunnels.size(); i++) {
        TunnelInfo info=(TunnelInfo)_tunnels.get(i);
        if (info.getExpiration() > _context.clock().now()) {
          return info;
        }
      }
      if (_log.shouldLog(Log.WARN))       _log.warn(toString() + ": after " + _tunnels.size()+ " tries, no unexpired ones were found: "+ _tunnels);
    }
  }
  if (_alive && _settings.getAllowZeroHop())   buildFake();
  if (allowRecurseOnFail)   return selectTunnel(false);
 else   return null;
}
