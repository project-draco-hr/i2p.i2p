{
  boolean shouldThrottle=shouldThrottleTunnels();
  if (!shouldThrottle)   return wanted;
synchronized (this) {
    if (_outstandingBuilds >= _maxOutstandingBuilds) {
      return 0;
    }
    if (_outstandingBuilds + wanted < _maxOutstandingBuilds) {
      _outstandingBuilds+=wanted;
      return wanted;
    }
 else {
      int allowed=_maxOutstandingBuilds - _outstandingBuilds;
      _outstandingBuilds=_maxOutstandingBuilds;
      return allowed;
    }
  }
}
