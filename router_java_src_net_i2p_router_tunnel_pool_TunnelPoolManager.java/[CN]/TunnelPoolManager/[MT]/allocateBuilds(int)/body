{
synchronized (this) {
    if (_outstandingBuilds >= _maxOutstandingBuilds) {
      _outstandingBuilds++;
      return 1;
    }
    if (_outstandingBuilds + wanted < _maxOutstandingBuilds) {
      _outstandingBuilds+=wanted;
      return wanted;
    }
 else {
      int allowed=_maxOutstandingBuilds - _outstandingBuilds;
      _outstandingBuilds=_maxOutstandingBuilds;
      return allowed;
    }
  }
}
