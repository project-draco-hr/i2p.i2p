{
  if (_log.shouldLog(Log.DEBUG))   _log.debug("Building tunnels for the client " + client.calculateHash().toBase64() + ": "+ settings);
  Hash dest=client.calculateHash();
  settings.getInboundSettings().setDestination(dest);
  settings.getOutboundSettings().setDestination(dest);
  TunnelPool inbound=null;
  TunnelPool outbound=null;
synchronized (_clientInboundPools) {
    inbound=_clientInboundPools.get(dest);
    if (inbound == null) {
      inbound=new TunnelPool(_context,this,settings.getInboundSettings(),new ClientPeerSelector());
      _clientInboundPools.put(dest,inbound);
    }
 else {
      inbound.setSettings(settings.getInboundSettings());
    }
  }
synchronized (_clientOutboundPools) {
    outbound=_clientOutboundPools.get(dest);
    if (outbound == null) {
      outbound=new TunnelPool(_context,this,settings.getOutboundSettings(),new ClientPeerSelector());
      _clientOutboundPools.put(dest,outbound);
    }
 else {
      outbound.setSettings(settings.getOutboundSettings());
    }
  }
  inbound.startup();
  try {
    Thread.sleep(3 * 1000);
  }
 catch (  InterruptedException ie) {
  }
  outbound.startup();
}
