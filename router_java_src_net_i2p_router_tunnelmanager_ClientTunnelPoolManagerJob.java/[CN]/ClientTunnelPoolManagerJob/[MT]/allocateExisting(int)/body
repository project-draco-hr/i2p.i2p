{
  int allocated=0;
  Iterator iter=selectGoodEnough(numTunnels).iterator();
  while (iter.hasNext() && allocated < numTunnels) {
    TunnelId id=(TunnelId)iter.next();
    TunnelInfo info=_tunnelPool.getTunnelInfo(id);
    if (info.getLength() < _clientPool.getClientSettings().getDepthInbound()) {
      continue;
    }
    boolean ok=_tunnelPool.allocateTunnel(id,_clientPool.getDestination());
    if (ok) {
      allocated++;
    }
  }
  return allocated;
}
