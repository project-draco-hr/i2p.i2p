{
  TreeMap rv=new TreeMap();
  int maxLength=_tunnelPool.getLongestTunnelLength();
  Iterator iter=_tunnelPool.getFreeTunnels().iterator();
  while (iter.hasNext() && rv.size() < numTunnels) {
    TunnelId id=(TunnelId)iter.next();
    TunnelInfo info=_tunnelPool.getFreeTunnel(id);
    if (info != null) {
      if (isGoodEnough(info,maxLength)) {
        rv.put(new Long(0 - info.getSettings().getExpiration()),id);
      }
    }
  }
  return new ArrayList(rv.values());
}
