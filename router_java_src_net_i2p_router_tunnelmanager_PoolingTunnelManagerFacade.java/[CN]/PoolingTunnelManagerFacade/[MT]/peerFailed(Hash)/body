{
  if (_pool == null)   return;
  int numFailed=0;
  boolean shouldKill=false;
  for (Iterator iter=_pool.getManagedTunnelIds().iterator(); iter.hasNext(); ) {
    TunnelId id=(TunnelId)iter.next();
    TunnelInfo info=(TunnelInfo)_pool.getTunnelInfo(id);
    if (isParticipant(info,peer)) {
      _log.info("Peer " + peer.toBase64() + " failed and they participate in tunnel "+ id.getTunnelId()+ ".  Marking the tunnel as not ready!");
      if (shouldKill) {
        info.setIsReady(false);
        long lifetime=_context.clock().now() - info.getCreated();
        _context.statManager().addRateData("tunnel.failAfterTime",lifetime,lifetime);
      }
      numFailed++;
    }
  }
  if (_log.shouldLog(Log.INFO))   _log.info("On peer " + peer.toBase64() + " failure, "+ numFailed+ " tunnels were "+ (shouldKill ? "" : "NOT ")+ "killed");
}
