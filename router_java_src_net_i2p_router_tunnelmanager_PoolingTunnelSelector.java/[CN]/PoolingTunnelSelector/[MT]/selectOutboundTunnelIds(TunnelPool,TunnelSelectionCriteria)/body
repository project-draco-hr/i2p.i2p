{
  List tunnelIds=new LinkedList();
  for (int i=pool.getOutboundTunnelCount(); i < criteria.getMinimumTunnelsRequired(); i++) {
    if (_log.shouldLog(Log.WARN))     _log.warn("Building fake tunnels because the outbound tunnels weren't sufficient");
    pool.buildFakeTunnels();
  }
  Set outIds=pool.getOutboundTunnels();
  for (Iterator iter=outIds.iterator(); iter.hasNext(); ) {
    TunnelId id=(TunnelId)iter.next();
    TunnelInfo info=pool.getOutboundTunnel(id);
    if ((info != null) && (info.getIsReady())) {
      tunnelIds.add(id);
    }
 else {
      if (info == null) {
        if (_log.shouldLog(Log.WARN))         _log.warn("Outbound tunnel " + id + " was not found?!  expire race perhaps?");
      }
 else {
        if (_log.shouldLog(Log.DEBUG))         _log.debug("Outbound tunnel " + id + " was not ready?! "+ new Date(info.getSettings().getExpiration()));
      }
    }
  }
  List ordered=randomize(pool,tunnelIds);
  List rv=new ArrayList(criteria.getMinimumTunnelsRequired());
  for (Iterator iter=ordered.iterator(); iter.hasNext() && (rv.size() < criteria.getMinimumTunnelsRequired()); ) {
    rv.add(iter.next());
  }
  _log.info("Selecting outbound tunnelIds [all outbound tunnels: " + outIds.size() + ", tunnelIds ready: "+ ordered.size()+ ", rv: "+ rv+ "]");
  return rv;
}
