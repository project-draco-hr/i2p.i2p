{
  RouterInfo target=getContext().netDb().lookupRouterInfoLocally(participant.getThisHop());
  if (target == null) {
    if (_log.shouldLog(Log.ERROR))     _log.error("Error - no db info known for participant " + participant.getThisHop());
    fail();
    return;
  }
  if (target.getIdentity().getHash().equals(getContext().routerHash())) {
    okLocalParticipation(participant);
    return;
  }
  TunnelId outboundTunnel=selectOutboundTunnel();
  if (outboundTunnel == null) {
    if (_log.shouldLog(Log.WARN))     _log.warn("No outbound tunnels!  unable to request a new tunnel!");
    fail();
    return;
  }
  TunnelGateway inboundGateway=selectInboundGateway(participant);
  if (inboundGateway == null) {
    if (_log.shouldLog(Log.ERROR))     _log.error("Unable to find an inbound gateway");
    fail();
    return;
  }
  SessionKey wrappedKey=new SessionKey();
  Set wrappedTags=new HashSet(64);
  PublicKey wrappedTo=new PublicKey();
  RequestState state=new RequestState(wrappedKey,wrappedTags,wrappedTo,participant,inboundGateway,outboundTunnel,target);
  Request r=new Request(getContext(),state);
  getContext().jobQueue().addJob(r);
}
