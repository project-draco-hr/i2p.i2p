{
  int found=0;
  Set ids=getFreeTunnels();
  long mustExpireAfter=_context.clock().now();
  for (Iterator iter=ids.iterator(); iter.hasNext(); ) {
    TunnelId id=(TunnelId)iter.next();
    TunnelInfo info=getFreeTunnel(id);
    if ((info != null) && (info.getIsReady())) {
      if (info.getSettings().getExpiration() > mustExpireAfter) {
        if (info.getDestination() == null) {
          found++;
        }
      }
    }
  }
  return found;
}
