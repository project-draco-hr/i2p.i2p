{
  if (!_isLive)   return;
  if (_log.shouldLog(Log.INFO))   _log.info("Tunnel " + id + " marked as not ready, since it /failed/",new Exception("Failed tunnel"));
  TunnelInfo info=getTunnelInfo(id);
  if (info == null)   return;
  _context.messageHistory().tunnelFailed(info.getTunnelId());
  info.setIsReady(false);
  Hash us=_context.routerHash();
  long lifetime=_context.clock().now() - info.getCreated();
  while (info != null) {
    if (!info.getThisHop().equals(us)) {
      _context.profileManager().tunnelFailed(info.getThisHop());
    }
    info=info.getNextHopInfo();
  }
  _context.statManager().addRateData("tunnel.failAfterTime",lifetime,lifetime);
  _context.statManager().updateFrequency("tunnel.failFrequency");
  buildFakeTunnels();
}
