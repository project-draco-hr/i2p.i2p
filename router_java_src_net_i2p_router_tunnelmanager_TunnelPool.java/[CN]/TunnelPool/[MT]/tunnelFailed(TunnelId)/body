{
  if (!_isLive)   return;
  TunnelInfo info=getTunnelInfo(id);
  if (info == null)   return;
  int failures=info.incrementFailures();
  if (failures <= getMaxTunnelFailures()) {
    if (_log.shouldLog(Log.INFO))     _log.info("Tunnel " + id + " failure "+ failures+ ", but not fatal yet");
    return;
  }
  if (_log.shouldLog(Log.WARN))   _log.warn("Tunnel " + id + " marked as not ready, since it /failed/",new Exception("Failed tunnel"));
  _context.messageHistory().tunnelFailed(info.getTunnelId());
  info.setIsReady(false);
  Hash us=_context.routerHash();
  long lifetime=_context.clock().now() - info.getCreated();
  while (info != null) {
    if (!info.getThisHop().equals(us)) {
      _context.profileManager().tunnelFailed(info.getThisHop());
    }
    info=info.getNextHopInfo();
  }
  _context.statManager().addRateData("tunnel.failAfterTime",lifetime,lifetime);
  _context.statManager().updateFrequency("tunnel.failFrequency");
  buildFakeTunnels();
}
