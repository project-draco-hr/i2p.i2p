{
  while (!_beginTest) {
    try {
      Thread.sleep(2000);
    }
 catch (    InterruptedException ie) {
    }
  }
  try {
    Thread.sleep(2000);
  }
 catch (  InterruptedException ie) {
  }
  PacketBuilder builder=new PacketBuilder(_context,null);
  InetAddress localhost=null;
  try {
    localhost=InetAddress.getLocalHost();
  }
 catch (  UnknownHostException uhe) {
    _log.error("die",uhe);
    System.exit(0);
  }
  _log.debug("Beginning to write");
  for (int curPacket=0; curPacket < 2000; curPacket++) {
    byte data[]=new byte[1024];
    _context.random().nextBytes(data);
    int curPeer=(curPacket % _endpoints.length);
    if (_endpoints[curPeer] == _endpoint)     curPeer++;
    if (curPeer >= _endpoints.length)     curPeer=0;
    UDPPacket packet=builder.buildPacket(data,localhost,_endpoints[curPeer].getListenPort());
    int outstanding=_sentNotReceived.size() + 1;
    _sentNotReceived.add(new ByteArray(data,0,1024));
    _log.debug("Sending packet " + curPacket + " with outstanding "+ outstanding);
    try {
      _endpoint.send(packet);
    }
 catch (    Exception e) {
      _log.error("die",e);
      break;
    }
    try {
      Thread.sleep(3);
    }
 catch (    InterruptedException ie) {
    }
  }
  _log.debug("Done sending packets");
  try {
    Thread.sleep(10 * 1000);
  }
 catch (  InterruptedException e) {
  }
  System.exit(0);
}
